import{r as p,j as e,B as u,t as b}from"./index-_xd8OyP8.js";import{S as g}from"./separator-lX8UNwTG.js";import{z as r,t as f}from"./zod-x_8lkCGK.js";import{u as C,F as y,a,b as n,c as i,f as c,d as t,e as o}from"./form-DIzSOdtk.js";import{I as d}from"./input-d0vtE30O.js";import{S as m}from"./switch-w5WyeRwk.js";import{T as w}from"./textarea-Bmd-AJpD.js";import{u as v}from"./useQuery-mr7Ep0hT.js";import{e as N,s as k}from"./index-BycJudEO.js";import"./index-CX6PQ3zO.js";import"./index-BwSRHYe4.js";import"./index-CRh0M8qI.js";import"./index-BlMNiBlp.js";import"./clipboard-YH5zrf5X.js";const S=r.object({email_verify:r.boolean().nullable(),safe_mode_enable:r.boolean().nullable(),secure_path:r.string().nullable(),email_whitelist_enable:r.boolean().nullable(),email_whitelist_suffix:r.array(r.string().nullable()).nullable(),email_gmail_limit_enable:r.boolean().nullable(),recaptcha_enable:r.boolean().nullable(),recaptcha_key:r.string().nullable(),recaptcha_site_key:r.string().nullable(),register_limit_by_ip_enable:r.boolean().nullable(),register_limit_count:r.coerce.string().transform(l=>l===""?null:l).nullable(),register_limit_expire:r.coerce.string().transform(l=>l===""?null:l).nullable(),password_limit_enable:r.boolean().nullable(),password_limit_count:r.coerce.string().transform(l=>l===""?null:l).nullable(),password_limit_expire:r.coerce.string().transform(l=>l===""?null:l).nullable()}),F={email_verify:!1,safe_mode_enable:!1,secure_path:"",email_whitelist_enable:!1,email_whitelist_suffix:[],email_gmail_limit_enable:!1,recaptcha_enable:!1,recaptcha_key:"",recaptcha_site_key:"",register_limit_by_ip_enable:!1,register_limit_count:"",register_limit_expire:"",password_limit_enable:!1,password_limit_count:"",password_limit_expire:""};function I(){const l=C({resolver:f(S),defaultValues:F,mode:"onChange"}),{data:x}=v({queryKey:["settings","safe"],queryFn:()=>N("safe")});p.useEffect(()=>{if(x?.data.safe){const s=x.data.safe;Object.entries(s).forEach(([h,j])=>{typeof j=="number"?l.setValue(h,String(j)):l.setValue(h,j)})}},[x,l]);function _(s){k(s).then(({data:h})=>{h&&b.success("保存成功")})}return e.jsx(y,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(_),className:"space-y-8",children:[e.jsx(a,{control:l.control,name:"email_verify",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"邮箱验证"}),e.jsx(c,{children:"开启后将会强制要求用户进行邮箱验证。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(a,{control:l.control,name:"email_gmail_limit_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"禁止使用Gmail多别名"}),e.jsx(c,{children:"开启后Gmail多别名将无法注册。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(a,{control:l.control,name:"safe_mode_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"安全模式"}),e.jsx(c,{children:"开启后除了站点URL以外的绑定本站点的域名访问都将会被403。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(a,{control:l.control,name:"secure_path",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"后台路径"}),e.jsx(t,{children:e.jsx(d,{placeholder:"admin",...s})}),e.jsx(c,{children:"后台管理路径，修改后将会改变原有的admin路径"}),e.jsx(o,{})]})}),e.jsx(a,{control:l.control,name:"email_whitelist_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"邮箱后缀白名单"}),e.jsx(c,{children:"开启后在名单中的邮箱后缀才允许进行注册。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),l.watch("email_whitelist_enable")&&e.jsx(a,{control:l.control,name:"email_whitelist_suffix",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"白名单后缀"}),e.jsx(t,{children:e.jsx(w,{placeholder:"请输入后缀域名，逗号分割 如：qq.com,gmail.com",value:s.value?.length&&s.value.join(","),onChange:h=>{h.target.value&&s.onChange(h.target.value.split(","))}})}),e.jsx(c,{children:"请使用逗号进行分割，如：qq.com,gmail.com。"}),e.jsx(o,{})]})}),e.jsx(a,{control:l.control,name:"recaptcha_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"防机器人"}),e.jsx(c,{children:"开启后将会使用Google reCAPTCHA防止机器人。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),l.watch("recaptcha_enable")&&e.jsx(a,{control:l.control,name:"recaptcha_key",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"密钥"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"在Google reCAPTCHA申请的密钥。"}),e.jsx(o,{})]})}),l.watch("recaptcha_enable")&&e.jsx(a,{control:l.control,name:"recaptcha_site_key",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"网站密钥"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"在Google reCAPTCH申请的网站密钥。"}),e.jsx(o,{})]})}),e.jsx(a,{control:l.control,name:"register_limit_by_ip_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"IP注册限制"}),e.jsx(c,{children:"开启后如果IP注册账户达到规则要求将会被限制注册，请注意IP判断可能因为CDN或前置代理导致问题。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),l.watch("register_limit_by_ip_enable")&&e.jsx(a,{control:l.control,name:"register_limit_count",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"次数"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"达到注册次数后开启惩罚。"}),e.jsx(o,{})]})}),l.watch("register_limit_by_ip_enable")&&e.jsx(a,{control:l.control,name:"register_limit_expire",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"惩罚时间(分钟)"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"需要等待惩罚时间过后才可以再次注册。"}),e.jsx(o,{})]})}),e.jsx(a,{control:l.control,name:"password_limit_enable",render:({field:s})=>e.jsxs(n,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"IP注册限制"}),e.jsx(c,{children:"开启后如果IP注册账户达到规则要求将会被限制注册，请注意IP判断可能因为CDN或前置代理导致问题。"})]}),e.jsx(t,{children:e.jsx(m,{checked:s.value,onCheckedChange:s.onChange})})]})}),l.watch("password_limit_enable")&&e.jsx(a,{control:l.control,name:"password_limit_count",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"次数"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"达到注册次数后开启惩罚。"}),e.jsx(o,{})]})}),l.watch("password_limit_enable")&&e.jsx(a,{control:l.control,name:"password_limit_expire",render:({field:s})=>e.jsxs(n,{children:[e.jsx(i,{children:"惩罚时间(分钟)"}),e.jsx(t,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"需要等待惩罚时间过后才可以再次登陆。"}),e.jsx(o,{})]})}),e.jsx(u,{type:"submit",children:"保存配置"})]})})}function M(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"安全设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统安全相关选项，包括登录验证、密码策略、API访问等安全设置。"})]}),e.jsx(g,{}),e.jsx(I,{})]})}export{M as default};
