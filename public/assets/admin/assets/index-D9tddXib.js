import{r as v,j as e,a as O,t as P,B as z}from"./index-_xd8OyP8.js";import{c as le,C as Ce,a as Se,b as ke,d as _e,e as ne,f as te,g as Ve,S as De,T as Te,U as Fe}from"./user-nav-BBmBVa03.js";import{D as de,a as xe,b as he,h as Pe,e as se,d as ze,L as Ie,f as Le,g as Me}from"./sidelinks-DLs_k-Mk.js";import{B as R,D as L,u as Oe,a as Re,g as He,b as Ee,c as Ge,d as Be}from"./column-header-BLyyjrhJ.js";import{b as Ke,c as Je,a as Ae,D as $e}from"./react-icons.esm-rZq2pt7A.js";import{I as b}from"./input-d0vtE30O.js";import{B as Q,D as me,e as ue,a as je,b as pe,c as ge,f as fe,d as qe,g as Ue}from"./button-DhrtVlOa.js";import{u as ve,a as x,b as h,c as u,d as m,e as k,F as We}from"./form-DIzSOdtk.js";import{z as l,t as Ne}from"./zod-x_8lkCGK.js";import{I as Y}from"./iconify-Dsf6bxB2.js";import{X as Xe,M as oe}from"./multiple-selector-CeO_loUo.js";import{H as Qe,I as Ye,J as ye,K as Ze,L as es,M as ss,N as rs,O as as}from"./index-BycJudEO.js";import{S as C,p as J,a as B}from"./index-ngg4RcvF.js";import{S as _,a as V,b as D,c as T,e as G,d as N}from"./select-Cqkdx-UJ.js";import{S as ls}from"./server-group-form-JiCHpkCJ.js";import{T as ns}from"./textarea-Bmd-AJpD.js";import{S as K}from"./switch-w5WyeRwk.js";import{T as A,a as $,b as q,c as U}from"./tooltip-B58e4dA7.js";import{P as ts,a as os,b as is}from"./popover-C5eiPdqD.js";import{S as cs}from"./separator-lX8UNwTG.js";import{C as ds}from"./confirm-dialog-CHz9pK2w.js";import{c as re}from"./common-BL1VIuho.js";import{u as xs}from"./user-CIJd3wDa.js";import{S as hs}from"./server-Igd-p88k.js";import{E as ms}from"./ellipsis-DggWsm3O.js";import{T as us}from"./trash-2-lI1I6nfk.js";import{u as js}from"./useQuery-mr7Ep0hT.js";import"./index-CcyXqhZ9.js";import"./index-BwSRHYe4.js";import"./index-CX6PQ3zO.js";import"./index-BlMNiBlp.js";import"./IconTicket-COhvkaJH.js";import"./arrow-up-9fLptvj0.js";import"./clipboard-YH5zrf5X.js";import"./index-CRh0M8qI.js";import"./index-kwEAqj-e.js";import"./loader-circle-BgRqqHyr.js";/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=le("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=le("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=le("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),be=v.forwardRef(({className:t,value:a,onChange:i,...j},n)=>{const[d,p]=v.useState("");v.useEffect(()=>{if(d.includes(",")){const g=new Set([...a,...d.split(",").map(S=>S.trim())]);i(Array.from(g)),p("")}},[d,i,a]);const w=()=>{if(d){const g=new Set([...a,d]);i(Array.from(g)),p("")}};return e.jsxs("div",{className:O(" has-[:focus-visible]:outline-none has-[:focus-visible]:ring-1 has-[:focus-visible]:ring-neutral-950  dark:has-[:focus-visible]:ring-neutral-300  flex w-full flex-wrap gap-2 rounded-md border border-input shadow-sm px-3 py-2 text-sm ring-offset-white  disabled:cursor-not-allowed disabled:opacity-50",t),children:[a.map(g=>e.jsxs(R,{variant:"secondary",children:[g,e.jsx(Q,{variant:"ghost",size:"icon",className:"ml-2 h-3 w-3",onClick:()=>{i(a.filter(S=>S!==g))},children:e.jsx(Xe,{className:"w-3"})})]},g)),e.jsx("input",{className:"flex-1 outline-none placeholder:text-muted-foreground bg-transparent",value:d,onChange:g=>p(g.target.value),onKeyDown:g=>{g.key==="Enter"||g.key===","?(g.preventDefault(),w()):g.key==="Backspace"&&d.length===0&&a.length>0&&(g.preventDefault(),i(a.slice(0,-1)))},...j,ref:n})]})});be.displayName="InputTags";function ae({dialogTrigger:t,state:a,setState:i,templateType:j}){const[n,d]=v.useState(!1),[p,w]=v.useState(typeof a=="object"?JSON.stringify(a,null,2):a),[g,S]=v.useState(null),F=r=>{if(!r)return null;try{const s=JSON.parse(r);return typeof s!="object"||s===null?"配置必须是一个JSON对象":null}catch{return"无效的JSON格式"}},H={tcp:{label:"TCP",content:{acceptProxyProtocol:!1,header:{type:"none"}}},"tcp-http":{label:"TCP + HTTP",content:{acceptProxyProtocol:!1,header:{type:"http",request:{version:"1.1",method:"GET",path:["/"],headers:{Host:["www.example.com"]}},response:{version:"1.1",status:"200",reason:"OK"}}}},grpc:{label:"gRPC",content:{serviceName:"GunService"}},ws:{label:"WebSocket",content:{path:"/",headers:{Host:"v2ray.com"}}}},I=()=>{switch(j){case"tcp":return["tcp","tcp-http"];case"grpc":return["grpc"];case"ws":return["ws"];default:return[]}},M=()=>{const r=F(p||"");if(r){P.error(r);return}try{if(!p){i(""),d(!1);return}i(JSON.parse(p)),d(!1)}catch{P.error("保存时发生错误")}},f=r=>{w(r),S(F(r))},E=r=>{const s=H[r];if(s){const c=JSON.stringify(s.content,null,2);w(c),S(null)}};return e.jsxs(me,{open:n,onOpenChange:r=>{!r&&n&&M(),d(r)},children:[e.jsx(ue,{asChild:!0,children:t??e.jsx(Q,{variant:"link",children:"编辑协议"})}),e.jsxs(je,{className:"sm:max-w-[425px]",children:[e.jsx(pe,{children:e.jsx(ge,{children:"编辑协议配置"})}),e.jsxs("div",{className:"space-y-4",children:[I().length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:I().map(r=>e.jsxs(Q,{variant:"outline",size:"sm",onClick:()=>E(r),children:["使用",H[r].label,"模板"]},r))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ns,{className:`min-h-[200px] font-mono text-sm ${g?"border-red-500 focus-visible:ring-red-500":""}`,value:p,placeholder:`请输入JSON配置${I().length>0?"或选择上方模板":""}`,onChange:r=>f(r.target.value)}),g&&e.jsx("p",{className:"text-sm text-red-500",children:g})]})]}),e.jsxs(fe,{className:"gap-2",children:[e.jsx(Q,{variant:"outline",onClick:()=>d(!1),children:"取消"}),e.jsx(Q,{onClick:M,disabled:!!g,children:"确定"})]})]})]})}const fs=({serverType:t,state:a,setState:i})=>{const j=l.object({cipher:l.string(),obfs:l.string().optional(),obfs_settings:l.object({path:l.string(),host:l.string()}).optional()}),n={cipher:"aes-128-gcm",obfs:"",obfs_settings:{path:"",host:""}},d=l.object({tls:l.string(),network:l.string(),network_settings:l.string().optional(),tls_settings:l.object({server_name:l.string(),allow_insecure:l.boolean()}).optional()}),p={tls:"0",network:"tcp",network_settings:"",tls_settings:{server_name:"",allow_insecure:!1}},w=l.object({allow_insecure:l.boolean(),network:l.string(),networkSettings:l.string().optional(),server_name:l.string().optional()}),g={allow_insecure:!1,network:"tcp",networkSettings:"",server_name:""},S=l.object({version:l.string(),obfs:l.object({open:l.boolean(),type:l.string().optional(),password:l.string().optional()}).optional(),tls:l.object({allow_insecure:l.boolean(),server_name:l.string().optional()}).optional(),bandwidth:l.object({up:l.union([l.number(),l.string()]).optional(),down:l.union([l.number(),l.string()]).optional()}),alpn:l.string().optional()}),F={version:"2",obfs:{open:!1,type:"",password:""},tls:{allow_insecure:!1,server_name:""},bandwidth:{up:"",down:""},alpn:"hysteria"},H=l.object({tls:l.string(),network:l.string(),network_settings:l.string().optional(),flow:l.string().optional(),tls_settings:l.object({server_name:l.string().optional(),allow_insecure:l.boolean()}),reality_settings:l.object({dest:l.string(),allow_insecure:l.boolean(),public_key:l.string().optional(),private_key:l.string().optional(),short_id:l.string().optional()}).optional()}),I={tls:"0",network:"tcp",network_settings:"",flow:"",tls_settings:{server_name:"",allow_insecure:!1},reality_settings:{dest:"",allow_insecure:!1,public_key:"",private_key:"",short_id:""}},M=()=>{let s,c;switch(t){case"shadowsocks":s=j,c=n;break;case"vmess":s=d,c=p;break;case"trojan":s=w,c=g;break;case"hysteria":s=S,c=F;break;case"vless":s=H,c=I;break}return{formSchema:s,initialValues:c}},{formSchema:f,initialValues:E}=M(),r=ve({resolver:Ne(f),defaultValues:JSON.stringify(a)!=="{}"?a:E,mode:"onChange"});return v.useEffect(()=>{if(JSON.stringify(a)==="{}"){const{initialValues:s}=M();r.reset(s),i(s)}},[t]),v.useEffect(()=>{i(r.getValues())},[]),r.watch(s=>i(s)),e.jsxs(e.Fragment,{children:[t==="shadowsocks"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{control:r.control,name:"cipher",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"加密算法"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择加密算法"})}),e.jsx(T,{children:e.jsx(G,{children:["aes-128-gcm","aes-192-gcm","aes-256-gcm","chacha20-ietf-poly1305","2022-blake3-aes-128-gcm","2022-blake3-aes-256-gcm"].map(c=>e.jsx(N,{value:c,children:c},c))})})]})})})]})}),e.jsx(x,{control:r.control,name:"obfs",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:" 混淆 "}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value||"0",children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择混淆方式"})}),e.jsx(T,{children:e.jsxs(G,{children:[e.jsx(N,{value:"0",children:"无"}),e.jsx(N,{value:"http",children:"HTTP"})]})})]})})})]})}),r.watch("obfs")=="http"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"obfs_settings.path",render:({field:s})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx("div",{className:"relative ",children:e.jsx(m,{children:e.jsx(b,{type:"text",placeholder:"路径",...s})})}),e.jsx(k,{})]})}),e.jsx(x,{control:r.control,name:"obfs_settings.host",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx("div",{className:"relative flex ",children:e.jsx(m,{children:e.jsx(b,{type:"text",placeholder:"Host",...s})})}),e.jsx(k,{})]})})]})]}),t==="vmess"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{control:r.control,name:"tls",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"TLS"}),e.jsx("div",{className:"",children:e.jsx(m,{children:e.jsxs(_,{value:s.value,onValueChange:s.onChange,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"请选择安全性"})}),e.jsxs(T,{children:[e.jsx(N,{value:"0",children:"不支持"}),e.jsx(N,{value:"1",children:"支持"})]})]})})})]})}),r.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"tls_settings.server_name",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsx(b,{placeholder:"不使用请留空",...s})})})]})}),e.jsx(x,{control:r.control,name:"tls_settings.allow_insecure",render:({field:s})=>e.jsxs(h,{className:"",children:[e.jsx(u,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(m,{children:e.jsx(K,{onCheckedChange:s.onChange,checked:s.value})})})]})})]}),e.jsx(x,{control:r.control,name:"network",render:({field:s})=>e.jsxs(h,{children:[e.jsxs(u,{children:["传输协议",e.jsx(ae,{state:r.getValues("network_settings"),setState:c=>r.setValue("network_settings",c),templateType:r.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择传输协议"})}),e.jsx(T,{children:e.jsx(G,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(c=>e.jsx(N,{value:c.value,className:"cursor-pointer",children:c.label},c.value))})})]})})})]})})]}),t==="trojan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"server_name",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{className:"leading-loose",children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsx(b,{placeholder:"当节点地址于证书不一致时用于证书验证",...s})})})]})}),e.jsx(x,{control:r.control,name:"allow_insecure",render:({field:s})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(u,{className:"leading-loose",children:"允许不安全?"}),e.jsx("div",{className:"flex flex-[1] items-center justify-center",children:e.jsx(m,{children:e.jsx(K,{onCheckedChange:s.onChange,checked:s.value})})})]})})]}),e.jsx(x,{control:r.control,name:"network",render:({field:s})=>e.jsxs(h,{children:[e.jsxs(u,{children:["传输协议",e.jsx(ae,{state:r.getValues("network_settings"),setState:c=>r.setValue("network_settings",c),templateType:r.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择传输协议"})}),e.jsx(T,{children:e.jsx(G,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(c=>e.jsx(N,{value:c.value,className:"cursor-pointer",children:c.label},c.value))})})]})})})]})})]}),t==="hysteria"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"version",render:({field:s})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx(u,{children:"协议版本"}),e.jsx(m,{children:e.jsxs(_,{value:s.value.toString(),onValueChange:s.onChange,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"协议版本"})}),e.jsx(T,{children:e.jsxs(G,{children:[e.jsx(N,{value:"1",className:"cursor-pointer",children:"V1"}),e.jsx(N,{value:"2",className:"cursor-pointer",children:"V2"})]})})]})})]})}),r.watch("version")==="1"&&e.jsx(x,{control:r.control,name:"alpn",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"ALPN"}),e.jsx(m,{children:e.jsxs(_,{value:s.value,onValueChange:s.onChange,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"ALPN"})}),e.jsx(T,{children:e.jsxs(G,{children:[e.jsx(N,{value:"hysteria",children:"hysteria"}),e.jsx(N,{value:"http/1.1",children:"http/1.1"}),e.jsx(N,{value:"h2",children:"h2"}),e.jsx(N,{value:"h3",children:"h3"})]})})]})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"obfs.open",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"混淆"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(m,{children:e.jsx(K,{checked:s.value,onCheckedChange:s.onChange})})})]})}),r.watch("obfs.open")==!0&&e.jsxs(e.Fragment,{children:[r.watch("version")=="2"&&e.jsx(x,{control:r.control,name:"obfs.type",render:({field:s})=>e.jsxs(h,{className:"flex-[1] ",children:[e.jsx(u,{children:"混淆实现"}),e.jsx(m,{children:e.jsxs(_,{value:s.value,onValueChange:s.onChange,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择混淆实现"})}),e.jsx(T,{children:e.jsx(G,{children:e.jsx(N,{value:"salamander",children:"Salamander"})})})]})})]})}),e.jsx(x,{control:r.control,name:"obfs.password",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"混淆密码"}),e.jsx(m,{children:e.jsx(b,{placeholder:"请输入混淆密码",...s})})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"tls.server_name",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsx(b,{placeholder:"当节点地址于证书不一致时用于证书验证",...s})})})]})}),e.jsx(x,{control:r.control,name:"tls.allow_insecure",render:({field:s})=>e.jsxs(h,{className:"",children:[e.jsx(u,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(m,{children:e.jsx(K,{className:"",onCheckedChange:s.onChange,checked:s.value})})})]})})]}),e.jsx(x,{control:r.control,name:"bandwidth.up",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"上行宽带"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(m,{children:e.jsx(b,{type:"number",placeholder:"请输入上行宽带"+(r.watch("version")==="2"?"，留空则使用BBR":""),className:"rounded-br-none rounded-tr-none",...s})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:"Mbps"})})]})]})}),e.jsx(x,{control:r.control,name:"bandwidth.down",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"下行宽带"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(m,{children:e.jsx(b,{type:"number",placeholder:"请输入下行宽带"+(r.watch("version")==="2"?"，留空则使用BBR":""),className:"rounded-br-none rounded-tr-none",...s})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:"Mbps"})})]})]})})]}),t==="vless"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{control:r.control,name:"tls",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"安全性"}),e.jsxs("div",{className:"",children:[e.jsx(m,{children:e.jsxs(_,{value:s.value.toString(),onValueChange:s.onChange,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"请选择安全性"})}),e.jsxs(T,{children:[e.jsx(N,{value:"0",children:"无"}),e.jsx(N,{value:"1",children:"TLS"}),e.jsx(N,{value:"2",children:"Reality"})]})]})}),e.jsx(k,{})]})]})}),r.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"tls_settings.server_name",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsx(b,{placeholder:"不使用请留空",...s})})})]})}),e.jsx(x,{control:r.control,name:"tls_settings.allow_insecure",render:({field:s})=>e.jsxs(h,{className:"",children:[e.jsx(u,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(m,{children:e.jsx(K,{onCheckedChange:s.onChange,checked:s.value})})})]})})]}),r.watch("tls")=="2"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:r.control,name:"reality_settings.dest",render:({field:s})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"伪装站点(dest)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsx(b,{placeholder:"例如：example.com:443",...s})})})]})}),e.jsx(x,{control:r.control,name:"reality_settings.allow_insecure",render:({field:s})=>e.jsxs(h,{className:"",children:[e.jsx(u,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(m,{children:e.jsx(K,{onCheckedChange:s.onChange,checked:s.value})})})]})})]}),e.jsx(x,{control:r.control,name:"reality_settings.private_key",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"私钥(Private key)"}),e.jsx(m,{children:e.jsx(b,{...s})})]})}),e.jsx(x,{control:r.control,name:"reality_settings.public_key",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"公钥(Public key)"}),e.jsx(m,{children:e.jsx(b,{...s})})]})}),e.jsx(x,{control:r.control,name:"reality_settings.short_id",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Short ID"}),e.jsx(m,{children:e.jsx(b,{...s})})]})})]}),e.jsx(x,{control:r.control,name:"network",render:({field:s})=>e.jsxs(h,{children:[e.jsxs(u,{children:["传输协议",e.jsx(ae,{state:r.getValues("network_settings"),setState:c=>r.setValue("network_settings",c),templateType:r.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(m,{children:e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(V,{children:e.jsx(D,{placeholder:"选择传输协议"})}),e.jsx(T,{children:e.jsx(G,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(c=>e.jsx(N,{value:c.value,className:"cursor-pointer",children:c.label},c.value))})})]})})})]})}),e.jsx(x,{control:r.control,name:"flow",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"XTLS流控算法"}),e.jsx("div",{className:"",children:e.jsx(m,{children:e.jsxs(_,{value:s.value||"none",onValueChange:c=>{s.onChange(c==="none"?"":c)},children:[e.jsx(V,{children:e.jsx(D,{placeholder:"请选择流控算法"})}),e.jsxs(T,{children:[e.jsx(N,{value:"none",children:"无"}),e.jsx(N,{value:"xtls-rprx-vision",children:"xtls-rprx-vision"})]})]})})})]})})]})]})},vs=l.object({id:l.number().optional().nullable(),code:l.string().optional(),name:l.string().min(1,"Please enter a valid name."),rate:l.string().min(1,"Please enter a valid rate."),tags:l.array(l.string()).default([]),excludes:l.array(l.string()).default([]),ips:l.array(l.string()).default([]),group_ids:l.array(l.string()).default([]),host:l.string().min(1,"Please enter a valid host."),port:l.string().min(1,"Please enter a valid port."),server_port:l.string().min(1,"Please enter a valid server port."),parent_id:l.string().default("0").nullable(),route_ids:l.array(l.string()).default([]),protocol_settings:l.record(l.any()).default({})}),Ns={id:null,code:"",name:"",rate:"1",tags:[],excludes:[],ips:[],group_ids:[],host:"",port:"",server_port:"",parent_id:"0",route_ids:[],protocol_settings:{}};function we({dialogTrigger:t,type:a,defaultFormValues:i=Ns,refetch:j}){const[n,d]=v.useState(!1),[p,w]=v.useState(a||C.Shadowsocks),[g,S]=v.useState([]),[F,H]=v.useState([]),[I,M]=v.useState([]),f=ve({resolver:Ne(vs),defaultValues:i,mode:"onChange"}),E=async()=>{if(!n)return;const[o,y,W]=await Promise.all([Qe(),Ye(),ye()]);S(o.data?.map(X=>({label:X.name,value:X.id.toString()}))||[]),H(y.data?.map(X=>({label:X.remarks,value:X.id.toString()}))||[]),M(W.data||[])},r=v.useMemo(()=>I?.filter(o=>(o.parent_id===0||o.parent_id===null)&&o.type===p&&o.id!==f.watch("id")),[p,I,f]);v.useEffect(()=>{E()},[n]),v.useEffect(()=>{f.reset(i)},[i,f,p]);const s=async()=>{try{const o=f.getValues();(await Ze({...o,type:p})).data&&(f.reset(i),d(!1),P.success("提交成功"),j())}catch{P.error("提交失败")}},c=()=>e.jsxs(de,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(z,{size:"sm",variant:"outline",children:e.jsx(Y,{icon:"ion:add"})})}),e.jsx(he,{align:"start",children:e.jsx(Pe,{children:J.map(({type:o,label:y})=>e.jsx(se,{onClick:()=>{w(o),d(!0)},className:"cursor-pointer",children:e.jsx(R,{variant:"outline",className:"text-white",style:{background:B[o]},children:y})},o))})})]});return e.jsxs(me,{open:n,onOpenChange:d,children:[t?e.jsx(ue,{asChild:!0,children:t}):c(),e.jsxs(je,{className:"sm:max-w-[425px]",children:[e.jsxs(pe,{children:[e.jsx(ge,{children:"新建节点"}),e.jsx(qe,{})]}),e.jsxs(We,{...f,children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{control:f.control,name:"name",render:({field:o})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(u,{children:"节点名称"}),e.jsx(m,{children:e.jsx(b,{placeholder:"请输入节点名称",...o})}),e.jsx(k,{})]})}),e.jsx(x,{control:f.control,name:"rate",render:({field:o})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx(u,{children:"倍率"}),e.jsx("div",{className:"relative flex",children:e.jsx(m,{children:e.jsx(b,{type:"number",min:"0",step:"0.1",...o})})}),e.jsx(k,{})]})})]}),e.jsx(x,{control:f.control,name:"code",render:({field:o})=>e.jsxs(h,{children:[e.jsxs(u,{children:["节点代码",e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(选填)"})]}),e.jsx(m,{children:e.jsx(b,{placeholder:"请输入节点唯一标识符",...o,value:o.value||""})}),e.jsx(k,{})]})}),e.jsx(x,{control:f.control,name:"tags",render:({field:o})=>e.jsxs(h,{children:[e.jsx(u,{children:"节点标签"}),e.jsx(m,{children:e.jsx(be,{value:o.value,onChange:o.onChange,placeholder:"输入后回车添加标签",className:"w-full"})}),e.jsx(k,{})]})}),e.jsx(x,{control:f.control,name:"group_ids",render:({field:o})=>e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center justify-between",children:["权限组",e.jsx(ls,{dialogTrigger:e.jsx(z,{variant:"link",children:"添加权限组"}),refetch:E})]}),e.jsx(m,{children:e.jsx(oe,{options:g,onChange:y=>o.onChange(y.map(W=>W.value)),value:g?.filter(y=>o.value.includes(y.value)),placeholder:"请选择权限组",emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:"no results found."})})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{control:f.control,name:"host",render:({field:o})=>e.jsxs(h,{children:[e.jsx(u,{children:"节点地址"}),e.jsx(m,{children:e.jsx(b,{placeholder:"请输入节点域名或者IP",...o})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{control:f.control,name:"port",render:({field:o})=>e.jsxs(h,{className:"flex-1",children:[e.jsxs(u,{className:"flex items-center gap-1.5",children:["连接端口",e.jsx(A,{delayDuration:100,children:e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsx(Y,{icon:"ph:info-light",className:"size-3.5 text-muted-foreground cursor-help"})}),e.jsx(U,{side:"top",className:"max-w-80 p-3",children:e.jsx("p",{children:"用户实际连接使用的端口，这是客户端配置中需要填写的端口号。如果使用了中转或隧道，这个端口可能与服务器实际监听的端口不同。"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{children:e.jsx(b,{placeholder:"用户连接端口",...o})}),e.jsx(A,{delayDuration:100,children:e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsx(z,{type:"button",variant:"ghost",size:"icon",className:"size-6 shrink-0 text-muted-foreground/50 hover:text-muted-foreground",onClick:()=>{const y=o.value;y&&f.setValue("server_port",y)},children:e.jsx(Y,{icon:"tabler:arrows-right",className:"size-3"})})}),e.jsx(U,{side:"right",children:e.jsx("p",{children:"同步到服务端口"})})]})})]}),e.jsx(k,{})]})}),e.jsx(x,{control:f.control,name:"server_port",render:({field:o})=>e.jsxs(h,{className:"flex-1",children:[e.jsxs(u,{className:"flex items-center gap-1.5",children:["服务端口",e.jsx(A,{delayDuration:100,children:e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsx(Y,{icon:"ph:info-light",className:"size-3.5 text-muted-foreground cursor-help"})}),e.jsx(U,{side:"top",className:"max-w-80 p-3",children:e.jsx("p",{children:"服务器实际监听的端口，这是在服务器上开放的真实端口。如果使用了中转或隧道，这个端口可能与用户连接端口不同。"})})]})})]}),e.jsx(m,{children:e.jsx(b,{placeholder:"服务端开放端口",...o})}),e.jsx(k,{})]})})]})]}),e.jsx(fs,{serverType:p,setState:o=>f.setValue("protocol_settings",o),state:f.getValues("protocol_settings")}),e.jsx(x,{control:f.control,name:"parent_id",render:({field:o})=>e.jsxs(h,{children:[e.jsx(u,{children:"父节点"}),e.jsxs(_,{onValueChange:o.onChange,value:o.value||"0",children:[e.jsx(m,{children:e.jsx(V,{children:e.jsx(D,{placeholder:"选择父节点"})})}),e.jsxs(T,{children:[e.jsx(N,{value:"0",children:"无"}),r?.map(y=>e.jsx(N,{value:y.id.toString(),className:"cursor-pointer",children:y.name},y.id))]})]}),e.jsx(k,{})]})}),e.jsx(x,{control:f.control,name:"route_ids",render:({field:o})=>e.jsxs(h,{children:[e.jsx(u,{children:"路由组"}),e.jsx(m,{children:e.jsx(oe,{options:F,onChange:y=>o.onChange(y.map(W=>W.value)),value:F?.filter(y=>o.value.includes(y.value)),placeholder:"选择路由组",emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:"no results found."})})}),e.jsx(k,{})]})})]}),e.jsxs(fe,{className:"mt-6",children:[e.jsx(Ue,{asChild:!0,children:e.jsx(z,{variant:"outline",children:"取消"})}),e.jsx(z,{type:"submit",onClick:s,children:"提交"})]})]})]})]})}function ce({column:t,title:a,options:i}){const j=t?.getFacetedUniqueValues(),n=new Set(t?.getFilterValue());return e.jsxs(ts,{children:[e.jsx(os,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),a,n?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(cs,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(R,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(R,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):i.filter(d=>n.has(d.value)).map(d=>e.jsx(R,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:d.label},d.value))})]})]})}),e.jsx(is,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Ce,{children:[e.jsx(Se,{placeholder:a}),e.jsxs(ke,{children:[e.jsx(_e,{children:"No results found."}),e.jsx(ne,{children:i.map(d=>{const p=n.has(d.value);return e.jsxs(te,{onSelect:()=>{p?n.delete(d.value):n.add(d.value);const w=Array.from(n);t?.setFilterValue(w.length?w:void 0)},className:"cursor-pointer",children:[e.jsx("div",{className:O("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",p?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Je,{className:O("h-4 w-4")})}),d.icon&&e.jsx(d.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${d.color}`}),e.jsx("span",{children:d.label}),j?.get(d.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:j.get(d.value)})]},d.value)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsx(ne,{children:e.jsx(te,{onSelect:()=>t?.setFilterValue(void 0),className:"justify-center text-center cursor-pointer",children:"Clear filters"})})]})]})]})})]})}const ys=[{value:C.Shadowsocks,label:J.find(t=>t.type===C.Shadowsocks)?.label,color:B[C.Shadowsocks]},{value:C.Vmess,label:J.find(t=>t.type===C.Vmess)?.label,color:B[C.Vmess]},{value:C.Trojan,label:J.find(t=>t.type===C.Trojan)?.label,color:B[C.Trojan]},{value:C.Hysteria,label:J.find(t=>t.type===C.Hysteria)?.label,color:B[C.Hysteria]},{value:C.Vless,label:J.find(t=>t.type===C.Vless)?.label,color:B[C.Vless]}];function bs({table:t,refetch:a,saveOrder:i,isSortMode:j,groups:n}){const d=t.getState().columnFilters.length>0,p=n.map(w=>({label:w,value:w}));return e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[!j&&e.jsxs(e.Fragment,{children:[e.jsx(we,{refetch:a}),e.jsx(b,{placeholder:"搜索节点...",value:t.getColumn("name")?.getFilterValue()??"",onChange:w=>t.getColumn("name")?.setFilterValue(w.target.value),className:"h-9 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[t.getColumn("type")&&e.jsx(ce,{column:t.getColumn("type"),title:"类型",options:ys}),t.getColumn("groups")&&e.jsx(ce,{column:t.getColumn("groups"),title:"权限组",options:p})]}),d&&e.jsxs(z,{variant:"ghost",onClick:()=>t.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(Ae,{className:"ml-2 h-4 w-4"})]})]}),j&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"拖拽节点进行排序，完成后点击保存"})})]}),e.jsx("div",{children:e.jsx(z,{size:"sm",variant:j?"default":"outline",className:"ml-auto hidden h-8 lg:flex",onClick:i,children:j?"保存排序":"编辑排序"})})]})}const Z={0:"bg-destructive/80 shadow-sm shadow-destructive/50",1:"bg-yellow-500/80 shadow-sm shadow-yellow-500/50",2:"bg-emerald-500/80 shadow-sm shadow-emerald-500/50"},ee={0:"未运行",1:"异常",2:"正常"},ws=t=>[{id:"drag-handle",header:({column:a})=>e.jsx(L,{column:a,title:"排序"}),cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx($e,{className:"size-4 cursor-move text-muted-foreground transition-colors hover:text-primary","aria-hidden":"true"})}),size:50},{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:"节点ID"}),cell:({row:a})=>{const i=a.getValue("id"),j=a.original.code;return e.jsx(A,{delayDuration:100,children:e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs("div",{className:"group/id flex items-center space-x-2",children:[e.jsxs(R,{variant:"outline",className:O("border-2 font-medium transition-all duration-200 hover:opacity-80","flex items-center gap-1.5"),style:{borderColor:B[a.original.type]},children:[e.jsx(hs,{className:"size-3"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[i,j&&e.jsxs("span",{className:"cursor-copy text-[0.7rem] text-muted-foreground/50",onClick:n=>{n.stopPropagation(),re(j),P.success("已复制节点代码")},children:["(",j,")"]})]}),a.original.parent_id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted-foreground/30",children:"→"}),e.jsx("span",{children:a.original.parent_id})]}):""]})]}),e.jsx(z,{variant:"ghost",size:"icon",className:"size-5 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:text-muted-foreground group-hover/id:opacity-100",onClick:n=>{n.stopPropagation(),re(j||i.toString()),P.success(j?"已复制节点代码":"已复制节点ID")},children:e.jsx(ie,{className:"size-3"})})]})}),e.jsxs(U,{side:"top",className:"flex flex-col gap-1 p-3",children:[e.jsxs("p",{className:"font-medium",children:[J.find(n=>n.type===a.original.type)?.label,a.original.parent_id?" (子节点)":""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j?"点击括号内容或复制按钮可复制节点代码":"点击复制按钮可复制节点ID"})]})]})})},size:200,enableSorting:!0},{accessorKey:"show",header:({column:a})=>e.jsx(L,{column:a,title:"显示"}),cell:({row:a})=>e.jsx(K,{defaultChecked:a.getValue("show"),onCheckedChange:async i=>{es({id:a.original.id,type:a.original.type,show:i?1:0}).catch(()=>{t()})},className:"data-[state=checked]:bg-primary"}),size:50,enableSorting:!1},{accessorKey:"name",header:({column:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx(L,{column:a,title:"节点",tooltip:e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:O("h-2.5 w-2.5 rounded-full",Z[0])}),e.jsx("span",{className:"text-sm font-medium",children:ee[0]})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:O("h-2.5 w-2.5 rounded-full",Z[1])}),e.jsx("span",{className:"text-sm font-medium",children:ee[1]})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:O("h-2.5 w-2.5 rounded-full",Z[2])}),e.jsx("span",{className:"text-sm font-medium",children:ee[2]})]})]})})}),cell:({row:a})=>e.jsx(A,{delayDuration:100,children:e.jsxs($,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:O("h-2.5 w-2.5 rounded-full transition-all duration-200",Z[a.original.available_status])}),e.jsx("span",{className:"font-medium text-left transition-colors hover:text-primary",children:a.getValue("name")})]})}),e.jsx(U,{children:e.jsx("p",{className:"font-medium",children:ee[a.original.available_status]})})]})}),enableSorting:!1,size:200},{accessorKey:"host",header:({column:a})=>e.jsx(L,{column:a,title:"地址"}),cell:({row:a})=>{const i=`${a.original.host}:${a.original.port}`,j=a.original.port!==a.original.server_port;return e.jsxs("div",{className:"group relative flex min-w-0 items-start",children:[e.jsxs("div",{className:"flex min-w-0 flex-wrap items-baseline gap-x-1 gap-y-0.5 pr-7",children:[e.jsxs("div",{className:"flex items-center whitespace-nowrap",children:[e.jsx("span",{className:"break-all font-mono text-sm font-medium text-foreground/90",children:a.original.host}),e.jsx("span",{className:"text-muted-foreground/50",children:":"}),e.jsx("span",{className:"font-mono text-sm font-medium text-foreground/90",children:a.original.port})]}),j&&e.jsxs("span",{className:"whitespace-nowrap text-[0.7rem] tracking-tight text-muted-foreground/40",children:["(内部端口 ",a.original.server_port,")"]})]}),e.jsx("div",{className:"absolute right-0 top-0",children:e.jsx(A,{delayDuration:0,children:e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:"size-6 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:bg-muted/50 hover:text-muted-foreground group-hover:opacity-100",onClick:n=>{n.stopPropagation(),re(i)},children:e.jsx(ie,{className:"size-3"})})}),e.jsx(U,{side:"top",sideOffset:10,children:"复制连接地址"})]})})})]})},enableSorting:!1,enableHiding:!0},{accessorKey:"online",header:({column:a})=>e.jsx(L,{column:a,title:"人数",tooltip:"在线人数根据服务端上报频率而定"}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(xs,{className:"size-4"}),e.jsx("span",{className:"font-medium",children:a.getValue("online")})]}),size:80,enableSorting:!0,enableHiding:!0},{accessorKey:"rate",header:({column:a})=>e.jsx(L,{column:a,title:"倍率",tooltip:"流量扣费倍率"}),cell:({row:a})=>e.jsxs(R,{variant:"secondary",className:"font-medium",children:[a.getValue("rate")," x"]}),size:80,enableSorting:!1,enableHiding:!0},{accessorKey:"groups",header:({column:a})=>e.jsx(L,{column:a,title:"权限组",tooltip:"可订阅到该节点的权限组"}),cell:({row:a})=>{const i=a.getValue("groups")||[];return e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5",children:i.length>0?i.map((j,n)=>e.jsx(R,{variant:"secondary",className:O("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:j.name},n)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"--"})})},enableSorting:!1,size:600,filterFn:(a,i,j)=>{const n=a.getValue(i);return n?j.some(d=>n.includes(d)):!1}},{accessorKey:"type",header:({column:a})=>e.jsx(L,{column:a,title:"类型"}),cell:({row:a})=>e.jsx(R,{variant:"outline",className:"border-2 font-medium transition-colors",style:{borderColor:B[a.getValue("type")]},children:a.getValue("type")}),enableSorting:!1,enableHiding:!0,enableColumnFilter:!1,size:8e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:"操作"}),cell:({row:a})=>e.jsx("div",{className:"flex justify-end",children:e.jsxs(de,{modal:!1,children:[e.jsx(xe,{asChild:!0,children:e.jsx(z,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":"打开操作菜单",children:e.jsx(ms,{className:"size-4"})})}),e.jsxs(he,{align:"end",className:"w-40",children:[e.jsx(se,{className:"cursor-pointer",onSelect:i=>i.preventDefault(),children:e.jsx(we,{refetch:t,type:a.original.type,defaultFormValues:{...a.original,rate:a.original.rate.toString(),parent_id:a.original.parent_id?.toString()??null},fetchNodeList:t,dialogTrigger:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(gs,{className:"mr-2 size-4"}),"编辑"]})})}),e.jsxs(se,{className:"cursor-pointer",onClick:async()=>{try{await ss({id:a.original.id}),P.success("复制成功"),t()}catch{P.error("复制失败")}},children:[e.jsx(ps,{className:"mr-2 size-4"}),"复制"]}),e.jsx(ze,{}),e.jsx(se,{className:"cursor-pointer text-destructive focus:text-destructive",onSelect:i=>i.preventDefault(),children:e.jsx(ds,{title:"确认删除",description:"此操作将永久删除该节点，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{rs({id:a.original.id}).then(({data:i})=>{i&&(P.success("删除成功"),t())})},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(us,{className:"mr-2 size-4"}),"删除"]})})})]})]})}),size:50}];function Cs(){const[t,a]=v.useState([]),[i,j]=v.useState([]),[n,d]=v.useState(!1),[p,w]=v.useState([]),[g,S]=v.useState({"drag-handle":!1}),{refetch:F}=js({queryKey:["nodeList"],queryFn:async()=>{const{data:r}=await ye();return w(r),r}}),H=v.useMemo(()=>{const r=new Set;return p.forEach(s=>{s.groups&&s.groups.forEach(c=>r.add(c))}),Array.from(r).sort()},[p]);v.useEffect(()=>{S({"drag-handle":n,type:!1,show:!n,name:!0,host:!n,online:!n,rate:!n,groups:!n,actions:!n})},[n]);const I=(r,s)=>{n&&(r.dataTransfer.setData("text/plain",s.toString()),r.currentTarget.classList.add("opacity-50"))},M=(r,s)=>{if(!n)return;r.preventDefault(),r.currentTarget.classList.remove("bg-muted");const c=parseInt(r.dataTransfer.getData("text/plain"));if(c===s)return;const o=[...p],[y]=o.splice(c,1);o.splice(s,0,y),w(o)},f=async()=>{if(n)try{const r=p.map((s,c)=>({id:s.id,order:c}));await as(r),await F(),d(!1),P.success("排序保存成功")}catch{P.error("排序保存失败")}else d(!0)},E=Oe({data:p,columns:ws(F),state:{sorting:i,columnFilters:t,columnVisibility:g},onSortingChange:j,onColumnFiltersChange:a,onColumnVisibilityChange:S,getCoreRowModel:He(),getFilteredRowModel:Ee(),getPaginationRowModel:Ge(),getSortedRowModel:Be(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(Re,{table:E,toolbar:r=>e.jsx(bs,{table:r,refetch:F,saveOrder:f,isSortMode:n,groups:H}),draggable:n,onDragStart:I,onDragEnd:r=>r.currentTarget.classList.remove("opacity-50"),onDragOver:r=>{r.preventDefault(),r.currentTarget.classList.add("bg-muted")},onDragLeave:r=>r.currentTarget.classList.remove("bg-muted"),onDrop:M,showPagination:!n})}function ir(){return e.jsxs(Ie,{children:[e.jsxs(Le,{children:[e.jsx(De,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Te,{}),e.jsx(Fe,{})]})]}),e.jsxs(Me,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"节点管理"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"管理所有节点，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Cs,{})})]})]})}export{ir as default};
