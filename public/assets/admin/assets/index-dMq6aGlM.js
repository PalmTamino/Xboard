import{r as c,j as e,B as f,t as r,a as O}from"./index-_xd8OyP8.js";import{c as z,S as E,T as H,U as P}from"./user-nav-BBmBVa03.js";import{L as _,f as q,g as B}from"./sidelinks-DLs_k-Mk.js";import{C as w,a as D,b as R,d as V,c as T}from"./card-6-6NT3wL.js";import{p as A,q as M,r as Q,t as W,v as Z,w as G}from"./index-BycJudEO.js";import{D as S,e as J,a as F,b as L,c as k,d as U,f as X}from"./button-DhrtVlOa.js";import{u as Y,F as $,a as K,b as ee,c as se,d as ae,e as re}from"./form-DIzSOdtk.js";import{D as te}from"./DynamicForm-r9rhu44l.js";import{L as ne}from"./loader-circle-BgRqqHyr.js";import{S as p}from"./skeleton-Dzu0p8kx.js";import{u as ie}from"./useQuery-mr7Ep0hT.js";import{C as le}from"./confirm-dialog-CHz9pK2w.js";import{T as oe}from"./trash-2-lI1I6nfk.js";import"./react-icons.esm-rZq2pt7A.js";import"./index-CcyXqhZ9.js";import"./index-BwSRHYe4.js";import"./index-CX6PQ3zO.js";import"./index-BlMNiBlp.js";import"./IconTicket-COhvkaJH.js";import"./clipboard-YH5zrf5X.js";import"./input-d0vtE30O.js";import"./textarea-Bmd-AJpD.js";/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=z("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function ce({themeKey:d,themeInfo:i}){const[j,m]=c.useState(!1),[g,x]=c.useState(!1),[v,h]=c.useState(!1),t=Y({defaultValues:i.configs.reduce((a,l)=>(a[l.field_name]="",a),{})}),n=async()=>{try{x(!0);const{data:a}=await A(d);Object.entries(a).forEach(([l,u])=>{t.setValue(l,u)})}catch{r.error("加载主题配置失败"),m(!1)}finally{x(!1)}},y=async a=>{try{h(!0),M(d,a).then(()=>{r.success("保存成功"),m(!1)})}catch{r.error("保存失败")}finally{h(!1)}};return e.jsxs(S,{open:j,onOpenChange:a=>{m(a),a?n():t.reset()},children:[e.jsx(J,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"主题设置"})}),e.jsxs(F,{className:"max-h-[90vh] overflow-auto sm:max-w-[425px]",children:[e.jsxs(L,{children:[e.jsxs(k,{children:["配置",i.name,"主题"]}),e.jsx(U,{children:"修改主题的样式、布局和其他显示选项。"})]}),g?e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(ne,{className:"h-6 w-6 animate-spin"})}):e.jsx($,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(y),className:"space-y-4",children:[i.configs.map(a=>e.jsx(K,{control:t.control,name:a.field_name,render:({field:l})=>e.jsxs(ee,{children:[e.jsx(se,{children:a.label}),e.jsx(ae,{children:te(a,l)}),e.jsx(re,{})]})},a.field_name)),e.jsxs(X,{className:"mt-6 gap-2",children:[e.jsx(f,{type:"button",variant:"secondary",onClick:()=>m(!1),children:"取消"}),e.jsx(f,{type:"submit",loading:v,children:"保存"})]})]})})]})]})}function Ie(){const[d,i]=c.useState(null),[j,m]=c.useState(!1),[g,x]=c.useState(!1),[v,h]=c.useState(!1),t=c.useRef(null),{data:n,isLoading:y,refetch:a}=ie({queryKey:["themeList"],queryFn:async()=>{const{data:s}=await G();return s}}),l=async s=>{try{i(s),await W({frontend_theme:s}),r.success("主题切换成功"),a()}catch{r.error("主题切换失败")}finally{i(null)}},u=async s=>{if(!s.name.endsWith(".zip")){r.error("只支持上传 ZIP 格式的主题文件");return}try{m(!0),await Z(s),r.success("主题上传成功"),x(!1),a()}catch{r.error("主题上传失败")}finally{m(!1),t.current&&(t.current.value="")}},N=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?h(!0):s.type==="dragleave"&&h(!1)},I=s=>{s.preventDefault(),s.stopPropagation(),h(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&u(s.dataTransfer.files[0])};return e.jsxs(_,{children:[e.jsxs(q,{className:"flex items-center justify-between",children:[e.jsx(E,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(H,{}),e.jsx(P,{})]})]}),e.jsxs(B,{className:"",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"主题配置"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground",children:"主题配置，包括主题色、字体大小等。如果你采用前后分离的方式部署V2board，那么主题配置将不会生效。"}),e.jsxs(f,{onClick:()=>x(!0),variant:"outline",className:"ml-4 shrink-0",children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"上传主题"]})]})]}),e.jsx("section",{className:"grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:y?e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(C,{})]}):n?.themes&&Object.entries(n.themes).map(([s,o])=>e.jsxs(w,{className:"relative transition-shadow hover:shadow-md",children:[s!==n.active&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(le,{title:"删除主题",description:"确定要删除该主题吗？删除后无法恢复。",confirmText:"删除",variant:"destructive",onConfirm:async()=>{if(s===n?.active){r.error("不能删除当前使用的主题");return}i(s),Q(s).then(()=>{r.success("主题删除成功"),a()}).catch(()=>{r.error("主题删除失败")}).finally(()=>{i(null)})},children:e.jsx(f,{disabled:d===s,loading:d===s,variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(oe,{className:"h-4 w-4"})})})}),e.jsxs(D,{children:[e.jsx(R,{children:o.name}),e.jsx(V,{children:o.description})]}),e.jsxs(T,{className:"flex items-center justify-end space-x-3",children:[e.jsx(ce,{themeKey:s,themeInfo:o}),e.jsx(f,{onClick:()=>l(s),disabled:d===s||s===n.active,loading:d===s,variant:s===n.active?"secondary":"default",children:s===n.active?"当前主题":"激活主题"})]})]},s))}),e.jsx(S,{open:g,onOpenChange:x,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(L,{children:[e.jsx(k,{children:"上传主题"}),e.jsx(U,{children:"请上传一个有效的主题压缩包（.zip 格式）。主题包应包含完整的主题文件结构。"})]}),e.jsxs("div",{className:O("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",v&&"border-primary/50 bg-muted/50"),onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:I,children:[e.jsx("input",{type:"file",ref:t,className:"hidden",accept:".zip",onChange:s=>{const o=s.target.files?.[0];o&&u(o)}}),j?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"正在上传..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(b,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium",children:["将主题文件拖放到此处，或者",e.jsx("button",{type:"button",onClick:()=>t.current?.click(),className:"mx-1 text-primary hover:underline",children:"点击选择"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"支持 .zip 格式的主题包"})]})]})})]})]})})]})]})}function C(){return e.jsxs(w,{children:[e.jsxs(D,{children:[e.jsx(p,{className:"h-6 w-[200px]"}),e.jsx(p,{className:"h-4 w-[300px]"})]}),e.jsxs(T,{className:"flex items-center justify-end space-x-3",children:[e.jsx(p,{className:"h-10 w-[100px]"}),e.jsx(p,{className:"h-10 w-[100px]"})]})]})}export{Ie as default};
