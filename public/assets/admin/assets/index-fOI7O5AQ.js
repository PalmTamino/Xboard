import{r as b,j as e,a as y,g as S,B as h,t as p}from"./index-_xd8OyP8.js";import{S as F}from"./separator-lX8UNwTG.js";import{z as l,t as T}from"./zod-x_8lkCGK.js";import{C as v}from"./react-icons.esm-rZq2pt7A.js";import{u as M,F as w,a as n,b as t,c as i,d as o,f as c,e as m}from"./form-DIzSOdtk.js";import{I as d}from"./input-d0vtE30O.js";import{u as j}from"./useQuery-mr7Ep0hT.js";import{s as E,e as N,f as q,h as C}from"./index-BycJudEO.js";import"./index-CX6PQ3zO.js";import"./clipboard-YH5zrf5X.js";const P=l.object({email_template:l.string().nullable(),email_host:l.string().nullable(),email_port:l.string().regex(/^\d+$/).nullable(),email_username:l.string().nullable(),email_password:l.string().nullable(),email_encryption:l.string().nullable(),email_from_address:l.string().email().nullable()}),I={email_template:"classic",email_host:"",email_port:"465",email_username:"",email_password:"",email_encryption:"",email_from_address:""};function L(){const r=M({resolver:T(P),defaultValues:I,mode:"onChange"}),{data:x}=j({queryKey:["settings","email"],queryFn:()=>N("email")}),{data:u}=j({queryKey:["emailTemplate"],queryFn:()=>q()});b.useEffect(()=>{if(x?.data.email){const s=x.data.email;Object.entries(s).forEach(([a,_])=>{r.setValue(a,_)})}},[x]);const{isLoading:f,refetch:g}=j({queryKey:["sendTestMail"],queryFn:()=>C().then(()=>p.success("发送成功")),enabled:!1});return e.jsxs(w,{...r,children:[e.jsx(n,{control:r.control,name:"email_host",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"SMTP服务器地址"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"由邮件服务商提供的服务地址"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_port",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"SMTP服务端口"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"常见的端口有25, 465, 587"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_encryption",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"SMTP加密方式"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"465端口加密方式一般为SSL，587端口加密方式一般为TLS"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_username",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"SMTP账号"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"由邮件服务商提供的账号"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_password",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"SMTP密码"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"由邮件服务商提供的密码"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_from_address",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"发件地址"}),e.jsx(o,{children:e.jsx(d,{placeholder:"请输入",...s})}),e.jsx(c,{children:"由邮件服务商提供的发件地址"}),e.jsx(m,{})]})}),e.jsx(n,{control:r.control,name:"email_template",render:({field:s})=>e.jsxs(t,{children:[e.jsx(i,{children:"邮件模板"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(o,{children:e.jsx("select",{className:y(S({variant:"outline"}),"w-[200px] appearance-none font-normal"),...s,children:u?.data?.map(a=>e.jsx("option",{value:a,children:a},a))})}),e.jsx(v,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(c,{children:"你可以在文档查看如何自定义邮件模板"}),e.jsx(m,{})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(h,{type:"submit",onClick:()=>{r.handleSubmit(s=>{console.log(s),E(s).then(({data:a})=>{a&&p.success("保存成功")})})()},children:"保存设置"}),e.jsx(h,{loading:f,onClick:()=>{g()},children:"发送测试邮件"})]})]})}function A(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"邮件设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统邮件服务，用于发送验证码、密码重置、通知等邮件，支持多种SMTP服务商。"})]}),e.jsx(F,{}),e.jsx(L,{})]})}export{A as default};
