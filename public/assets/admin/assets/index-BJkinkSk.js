import{r as m,j as e,B as x,a as re,t as K}from"./index-ra1jmRmU.js";import{S as ae,T as te,U as ne}from"./user-nav-Ch7kI57y.js";import{L as le,f as ie,g as oe}from"./sidelinks-B70MVRK0.js";import{D as v,B as q,u as ce,a as de,g as me,b as ue,c as xe,d as he,e as ge,f as pe}from"./column-header-p2OHlx2E.js";import{a as je,D as fe,P as be}from"./react-icons.esm-BRv52UVg.js";import{I as b}from"./input-BJSapCFH.js";import{T as ve,I as ye,U as I,V as Ne,f as we,W as Se}from"./index-vL3ySUIK.js";import{D as Ce,e as Te,a as _e,b as De,c as Fe,d as ke,f as Me,g as Ve}from"./button-BkBuHKqj.js";import{u as Oe,F as Ie,a as h,b as g,c as p,d as j,e as y,f as G}from"./form-BdPgCkkB.js";import{z as a,t as Re}from"./zod-DftZp2aV.js";import{S as $,a as Q,b as W,c as X,d as Y}from"./select-ar7QGfF7.js";import{T as R,a as P,b as A,c as L}from"./tooltip-uHmd8Pkm.js";import{M as Pe,E as Ae}from"./index-qcmcBeKk.js";import{S as Le}from"./server-group-form-B6uHqnlU.js";import{S as E}from"./switch-koO8JJ-3.js";import{C as Ee}from"./confirm-dialog-Cgr3O3nI.js";import{u as ze}from"./user-D0H1hp3K.js";import{T as He}from"./trash-2-DZs5wEr-.js";import{u as Be}from"./useQuery-BPONQpNy.js";import"./index-CmmzV1O3.js";import"./index-OwEZQf1t.js";import"./index-QSXu8nGm.js";import"./index-NvRyusV4.js";import"./IconTicket-s_6DwrCY.js";import"./arrow-up-Cu4ezgY6.js";import"./clipboard-Bl2zvJsv.js";import"./index-DGqrqZGX.js";import"./index-DBonxKbv.js";import"./index-D1AQYL1e.js";import"./iconify-DJqeKjVQ.js";import"./loader-circle-DZwZUkW0.js";const Ke=a.object({id:a.number().nullable(),group_id:a.union([a.number(),a.string()]).nullable().optional(),name:a.string().min(1).max(250),content:a.string().nullable().optional(),transfer_enable:a.union([a.number().min(0),a.string().min(1)]),prices:a.object({monthly:a.union([a.number(),a.string()]).nullable().optional(),quarterly:a.union([a.number(),a.string()]).nullable().optional(),half_yearly:a.union([a.number(),a.string()]).nullable().optional(),yearly:a.union([a.number(),a.string()]).nullable().optional(),two_yearly:a.union([a.number(),a.string()]).nullable().optional(),three_yearly:a.union([a.number(),a.string()]).nullable().optional(),onetime:a.union([a.number(),a.string()]).nullable().optional(),reset_traffic:a.union([a.number(),a.string()]).nullable().optional()}).default({}),speed_limit:a.union([a.number(),a.string()]).nullable().optional(),capacity_limit:a.union([a.number(),a.string()]).nullable().optional(),device_limit:a.union([a.number(),a.string()]).nullable().optional(),reset_traffic_method:a.number().nullable(),users_count:a.number().optional()}),Ue=1,qe=1e6;let z=0;function Ge(){return z=(z+1)%Number.MAX_SAFE_INTEGER,z.toString()}const H=new Map,J=t=>{if(H.has(t))return;const s=setTimeout(()=>{H.delete(t),M({type:"REMOVE_TOAST",toastId:t})},qe);H.set(t,s)},$e=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,Ue)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(i=>i.id===s.toast.id?{...i,...s.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=s;return i?J(i):t.toasts.forEach(c=>{J(c.id)}),{...t,toasts:t.toasts.map(c=>c.id===i||i===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(i=>i.id!==s.toastId)}}},Qe=[];let B={toasts:[]};function M(t){B=$e(B,t),Qe.forEach(s=>{s(B)})}function Z({...t}){const s=Ge(),i=u=>M({type:"UPDATE_TOAST",toast:{...u,id:s}}),c=()=>M({type:"DISMISS_TOAST",toastId:s});return M({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:u=>{u||c()}}}),{id:s,dismiss:c,update:i}}const ee={id:null,group_id:null,name:"",content:"",transfer_enable:"",prices:{monthly:"",quarterly:"",half_yearly:"",yearly:"",two_yearly:"",three_yearly:"",onetime:"",reset_traffic:""},speed_limit:"",capacity_limit:"",device_limit:"",show:!0,renew:!0,sort:null,reset_traffic_method:null},k={monthly:{label:"月付",months:1,discount:1},quarterly:{label:"季付",months:3,discount:.95},half_yearly:{label:"半年付",months:6,discount:.9},yearly:{label:"年付",months:12,discount:.85},two_yearly:{label:"两年付",months:24,discount:.8},three_yearly:{label:"三年付",months:36,discount:.75},onetime:{label:"流量包",months:1,discount:1},reset_traffic:{label:"重置包",months:1,discount:1}},We=[{value:0,label:"跟随系统设置"},{value:1,label:"每月1号"},{value:2,label:"按月重置"},{value:3,label:"不重置"},{value:4,label:"每年1月1日"},{value:5,label:"按年重置"}];function U({refreshData:t,dialogTrigger:s,type:i="add",defaultFormValues:c=ee}){const[u,N]=m.useState(!1),[T,_]=m.useState(!1),o=Oe({resolver:Re(Ke),defaultValues:{...ee,...c},mode:"onChange"}),w=new Pe({html:!0}),[C,D]=m.useState();async function S(){ye().then(({data:r})=>{D(r)})}m.useEffect(()=>{u&&S()},[u]);const V=r=>{if(isNaN(r))return;const n=Object.entries(k).reduce((d,[l,f])=>{const F=r*f.months*f.discount;return{...d,[l]:F.toFixed(2)}},{});o.setValue("prices",n,{shouldDirty:!0})};return e.jsxs(Ce,{onOpenChange:N,open:u,children:[e.jsx(Te,{asChild:!0,children:s||e.jsx(x,{variant:"outline",size:"sm",children:"添加套餐"})}),e.jsxs(_e,{className:"sm:max-w-[600px]",children:[e.jsxs(De,{children:[e.jsx(Fe,{children:i==="add"?"添加套餐":"编辑套餐"}),e.jsx(ke,{})]}),e.jsxs(Ie,{...o,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{control:o.control,name:"name",render:({field:r})=>e.jsxs(g,{children:[e.jsx(p,{children:"套餐名称"}),e.jsx(j,{children:e.jsx(b,{placeholder:"请输入套餐名称",...r})}),e.jsx(y,{})]})}),e.jsx(h,{control:o.control,name:"group_id",render:({field:r})=>e.jsxs(g,{children:[e.jsxs(p,{className:"flex items-center justify-between",children:["权限组",e.jsx(Le,{dialogTrigger:e.jsx(x,{variant:"link",children:"添加权限组"}),refetch:S})]}),e.jsxs($,{value:r.value||"",onValueChange:r.onChange,children:[e.jsx(j,{children:e.jsx(Q,{children:e.jsx(W,{placeholder:"选择权限组"})})}),e.jsx(X,{children:C?.map(n=>e.jsx(Y,{value:n.id,children:n.name},n.id))})]}),e.jsx(y,{})]})}),e.jsx(h,{control:o.control,name:"transfer_enable",render:({field:r})=>e.jsxs(g,{className:"flex-1",children:[e.jsx(p,{children:"流量"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(j,{children:e.jsx(b,{type:"number",min:0,placeholder:"请输入流量大小",className:"rounded-r-none",...r})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"GB"})]}),e.jsx(y,{})]})}),e.jsx(h,{control:o.control,name:"speed_limit",render:({field:r})=>e.jsxs(g,{className:"flex-1",children:[e.jsx(p,{children:"限速"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(j,{children:e.jsx(b,{type:"number",min:0,placeholder:"请输入限速",className:"rounded-r-none",...r})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"Mbps"})]}),e.jsx(y,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"}),e.jsx("h3",{className:"mx-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"售价设置"}),e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(b,{type:"number",placeholder:"基础月付价格",className:"h-7 w-32 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500",onChange:r=>{const n=parseFloat(r.target.value);V(n)}})]}),e.jsx(R,{children:e.jsxs(P,{children:[e.jsx(A,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{const r=Object.keys(k).reduce((n,d)=>({...n,[d]:""}),{});o.setValue("prices",r,{shouldDirty:!0})},children:"清空价格"})}),e.jsx(L,{side:"top",align:"end",children:e.jsx("p",{className:"text-xs",children:"清空所有周期的价格设置"})})]})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-3",children:Object.entries(k).filter(([r])=>!["onetime","reset_traffic"].includes(r)).map(([r,n])=>e.jsx("div",{className:"group relative rounded-md bg-card p-2 ring-1 ring-gray-200 transition-all hover:ring-primary dark:ring-gray-800",children:e.jsx(h,{control:o.control,name:`prices.${r}`,render:({field:d})=>e.jsxs(g,{children:[e.jsxs(p,{className:"text-xs font-medium text-muted-foreground",children:[n.label,e.jsxs("span",{className:"ml-1 text-[10px] text-gray-400",children:["(",n.months===1?"每月":`每${n.months}个月`,"结算)"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(j,{children:e.jsx(b,{type:"number",placeholder:"0.00",min:0,...d,value:d.value??"",onChange:l=>d.onChange(l.target.value),className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})},r))}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Object.entries(k).filter(([r])=>["onetime","reset_traffic"].includes(r)).map(([r,n])=>e.jsx("div",{className:"rounded-md border border-dashed border-gray-200 bg-muted/30 p-3 dark:border-gray-700",children:e.jsx(h,{control:o.control,name:`prices.${r}`,render:({field:d})=>e.jsx(g,{children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsx(p,{className:"text-xs font-medium",children:n.label}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:r==="onetime"?"一次性流量包，购买后立即生效":"用户可随时购买流量重置包，立即重置流量"})]}),e.jsxs("div",{className:"relative w-full md:w-32",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(j,{children:e.jsx(b,{type:"number",placeholder:"0.00",min:0,...d,className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})})},r))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(h,{control:o.control,name:"device_limit",render:({field:r})=>e.jsxs(g,{className:"flex-1",children:[e.jsx(p,{children:"设备限制"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(j,{children:e.jsx(b,{type:"number",min:0,placeholder:"留空则不限制",className:"rounded-r-none",...r,value:r.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"台"})]}),e.jsx(y,{})]})}),e.jsx(h,{control:o.control,name:"capacity_limit",render:({field:r})=>e.jsxs(g,{className:"flex-1",children:[e.jsx(p,{children:"容量限制"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(j,{children:e.jsx(b,{type:"number",min:0,placeholder:"留空则不限制",className:"rounded-r-none",...r,value:r.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"人"})]}),e.jsx(y,{})]})})]}),e.jsx(h,{control:o.control,name:"reset_traffic_method",render:({field:r})=>e.jsxs(g,{children:[e.jsx(p,{children:"流量重置方式"}),e.jsxs($,{value:r.value?.toString()??"0",onValueChange:n=>r.onChange(Number(n)),children:[e.jsx(j,{children:e.jsx(Q,{children:e.jsx(W,{placeholder:"选择流量重置方式"})})}),e.jsx(X,{children:We.map(n=>e.jsx(Y,{value:n.value.toString(),children:n.label},n.value))})]}),e.jsx(G,{className:"text-xs",children:"设置订阅流量的重置方式，不同的重置方式会影响用户的流量计算方式"}),e.jsx(y,{})]})}),e.jsx(h,{control:o.control,name:"content",render:({field:r})=>{const[n,d]=m.useState(!1);return e.jsxs(g,{className:"space-y-2",children:[e.jsxs(p,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["套餐描述",e.jsx(R,{children:e.jsxs(P,{children:[e.jsx(A,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>d(!n),children:n?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{d:"M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"}),e.jsx("path",{fillRule:"evenodd",d:"M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.28 2.22a.75.75 0 00-1.06 1.06l14.5 14.5a.75.75 0 101.06-1.06l-1.745-1.745a10.029 10.029 0 003.3-4.38 1.651 1.651 0 000-1.185A10.004 10.004 0 009.999 3a9.956 9.956 0 00-4.744 1.194L3.28 2.22zM7.752 6.69l1.092 1.092a2.5 2.5 0 013.374 3.373l1.091 1.092a4 4 0 00-5.557-5.557z",clipRule:"evenodd"}),e.jsx("path",{d:"M10.748 13.93l2.523 2.523a9.987 9.987 0 01-3.27.547c-4.258 0-7.894-2.66-9.337-6.41a1.651 1.651 0 010-1.186A10.007 10.007 0 012.839 6.02L6.07 9.252a4 4 0 004.678 4.678z"})]})})}),e.jsx(L,{side:"top",children:e.jsx("p",{className:"text-xs",children:n?"隐藏预览":"显示预览"})})]})})]}),e.jsx(R,{children:e.jsxs(P,{children:[e.jsx(A,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{r.onChange(`## 套餐特点
• 高速稳定的全球网络接入
• 支持多设备同时在线
• 无限制的流量重置

## 使用说明
1. 支持设备：iOS、Android、Windows、macOS
2. 24/7 技术支持
3. 自动定期流量重置

## 注意事项
- 禁止滥用
- 遵守当地法律法规
- 支持随时更换套餐`)},children:"使用模板"})}),e.jsx(L,{side:"left",align:"center",children:e.jsx("p",{className:"text-xs",children:"点击使用预设的套餐描述模板"})})]})})]}),e.jsxs("div",{className:`grid gap-4 ${n?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:[e.jsx("div",{className:"space-y-2",children:e.jsx(j,{children:e.jsx(Ae,{style:{height:"400px"},value:r.value||"",renderHTML:l=>w.render(l),onChange:({text:l})=>r.onChange(l),config:{view:{menu:!0,md:!0,html:!1},canView:{menu:!0,md:!0,html:!1,fullScreen:!1,hideMenu:!1}},placeholder:"在这里编写套餐描述...",className:"rounded-md border"})})}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"预览"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert h-[400px] max-w-none overflow-y-auto rounded-md border p-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:w.render(r.value||"")}})})]})]}),e.jsx(G,{className:"text-xs",children:"支持 Markdown 格式，可以使用标题、列表、粗体、斜体等样式来美化描述内容"}),e.jsx(y,{})]})}})]}),e.jsxs(Me,{className:"mt-6",children:[e.jsx(Ve,{asChild:!0,children:e.jsx(x,{type:"button",variant:"outline",children:"取消"})}),e.jsx(x,{type:"submit",disabled:T,onClick:()=>{o.handleSubmit(async r=>{_(!0);try{(await ve(r)).data&&(Z({title:"成功",description:i==="add"?"套餐添加成功":"套餐更新成功"}),N(!1),o.reset(),t())}catch(n){console.error("保存失败:",n),Z({variant:"destructive",title:"错误",description:n?.response?.data?.message||"保存失败，请重试"})}finally{_(!1)}})()},children:T?"提交中...":"提交"})]})]})]})]})}function Xe({table:t,refetch:s,saveOrder:i,isSortMode:c}){const u=t.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[c?e.jsx("p",{className:"text-sm text-muted-foreground",children:"拖拽套餐进行排序，完成后点击保存"}):e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(U,{refreshData:s}),e.jsx(b,{placeholder:"搜索订阅...",value:t.getColumn("name")?.getFilterValue()??"",onChange:N=>t.getColumn("name")?.setFilterValue(N.target.value),className:"h-9 w-[150px] lg:w-[250px]"}),u&&e.jsxs(x,{variant:"ghost",onClick:()=>t.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(je,{className:"ml-2 h-4 w-4"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!c&&e.jsx(U,{refreshData:s}),e.jsx(x,{size:"sm",variant:c?"default":"outline",onClick:i,children:c?"保存排序":"编辑排序"})]})]})}const Ye=t=>[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:"cursor-move",children:e.jsx(fe,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:s})=>e.jsx(v,{column:s,title:"ID"}),cell:({row:s})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{variant:"outline",children:s.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"show",header:({column:s})=>e.jsx(v,{column:s,title:"显示"}),cell:({row:s})=>e.jsx(E,{defaultChecked:s.getValue("show"),onCheckedChange:i=>{I({id:s.original.id,show:i}).then(({data:c})=>{!c&&t()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"sell",header:({column:s})=>e.jsx(v,{column:s,title:"销售"}),cell:({row:s})=>e.jsx(E,{defaultChecked:s.getValue("sell"),onCheckedChange:i=>{I({id:s.original.id,sell:i}).then(({data:c})=>{!c&&t()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"renew",header:({column:s})=>e.jsx(v,{column:s,title:"续费",tooltip:"在订阅停止销售时，已购用户是否可以续费"}),cell:({row:s})=>e.jsx(E,{defaultChecked:s.getValue("renew"),onCheckedChange:i=>{I({id:s.original.id,renew:i}).then(({data:c})=>{!c&&t()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(v,{column:s,title:"名称"}),cell:({row:s})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:s.getValue("name")})}),enableSorting:!1,enableHiding:!1,size:900},{accessorKey:"users_count",header:({column:s})=>e.jsx(v,{column:s,title:"统计"}),cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2 px-2",children:[e.jsx(ze,{}),e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:s.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"group",header:({column:s})=>e.jsx(v,{column:s,title:"权限组"}),cell:({row:s})=>e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5",children:e.jsx(q,{variant:"secondary",className:re("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:s.getValue("group")?.name})}),enableSorting:!1,enableHiding:!1,size:9e3},{id:"actions",header:({column:s})=>e.jsx(v,{className:"justify-end",column:s,title:"操作"}),cell:({row:s})=>e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(U,{refreshData:t,type:"edit",defaultFormValues:s.original,dialogTrigger:e.jsxs(x,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]})}),e.jsx(Ee,{title:"确认删除",description:"此操作将永久删除该订阅，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{Ne({id:s.original.id}).then(({data:i})=>{i&&(K.success("删除成功"),t())})},children:e.jsxs(x,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(He,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]})}];function Je(){const[t,s]=m.useState({}),[i,c]=m.useState({"drag-handle":!1}),[u,N]=m.useState([]),[T,_]=m.useState([]),[o,w]=m.useState(!1),[C,D]=m.useState([]),{refetch:S}=Be({queryKey:["planList"],queryFn:async()=>{const{data:l}=await we();return D(l),l}});m.useEffect(()=>{c({"drag-handle":o})},[o]);const V=(l,f)=>{o&&(l.dataTransfer.setData("text/plain",f.toString()),l.currentTarget.classList.add("opacity-50"))},r=(l,f)=>{if(!o)return;l.preventDefault(),l.currentTarget.classList.remove("bg-muted");const F=parseInt(l.dataTransfer.getData("text/plain"));if(F===f)return;const O=[...C],[se]=O.splice(F,1);O.splice(f,0,se),D(O)},n=async()=>{if(!o){w(!0);return}try{const l=C?.map(f=>f.id);await Se(l),K.success("排序保存成功"),w(!1),S()}catch{K.error("排序保存失败"),w(!1)}},d=ce({data:C||[],columns:Ye(S),state:{sorting:T,columnVisibility:i,rowSelection:t,columnFilters:u},enableRowSelection:!0,onRowSelectionChange:s,onSortingChange:_,onColumnFiltersChange:N,onColumnVisibilityChange:c,getCoreRowModel:me(),getFilteredRowModel:ue(),getPaginationRowModel:xe(),getSortedRowModel:he(),getFacetedRowModel:ge(),getFacetedUniqueValues:pe(),initialState:{columnPinning:{right:["actions"]}},pageCount:o?1:void 0});return e.jsx(de,{table:d,toolbar:l=>e.jsx(Xe,{table:l,refetch:S,saveOrder:n,isSortMode:o}),draggable:o,onDragStart:V,onDragEnd:l=>l.currentTarget.classList.remove("opacity-50"),onDragOver:l=>{l.preventDefault(),l.currentTarget.classList.add("bg-muted")},onDragLeave:l=>l.currentTarget.classList.remove("bg-muted"),onDrop:r,showPagination:!o})}function ks(){return e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(ae,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(te,{}),e.jsx(ne,{})]})]}),e.jsxs(oe,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"订阅管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"在这里可以配置订阅计划，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Je,{})})]})]})}export{ks as default};
