import{r as k,j as e,B as d,t as g}from"./index-ra1jmRmU.js";import{S as F}from"./separator-Ckt7QEUw.js";import{z as o,t as S}from"./zod-DftZp2aV.js";import{u as v,F as y,a as x,b as a,c as n,d as c,f as l,e as m}from"./form-BdPgCkkB.js";import{I as h}from"./input-BJSapCFH.js";import{S as T}from"./switch-koO8JJ-3.js";import{u as C}from"./useQuery-BPONQpNy.js";import{u}from"./useMutation-CAQi7k46.js";import{e as E,s as W,j as B}from"./index-vL3ySUIK.js";import"./index-QSXu8nGm.js";import"./index-OwEZQf1t.js";import"./index-DGqrqZGX.js";import"./index-NvRyusV4.js";import"./clipboard-Bl2zvJsv.js";const I=o.object({telegram_bot_enable:o.boolean().nullable(),telegram_bot_token:o.string().nullable(),telegram_discuss_link:o.string().nullable()}),K={telegram_bot_enable:!1,telegram_bot_token:"",telegram_discuss_link:""};function N(){const s=v({resolver:S(I),defaultValues:K,mode:"onChange"}),{data:i}=C({queryKey:["settings","telegram"],queryFn:()=>E("telegram")});k.useEffect(()=>{if(i?.data.telegram){const t=i.data.telegram;Object.entries(t).forEach(([r,_])=>{s.setValue(r,_)})}},[i]);const{mutate:j,status:p}=u({mutationFn:t=>W(t).then(({data:r})=>r&&g.success("保存成功")),mutationKey:["settings","telegram"]}),{mutate:b,status:f}=u({mutationFn:t=>B().then(({data:r})=>r&&g.success("保存成功")),mutationKey:["settings","settelegramWebhook"]});return e.jsxs(y,{...s,children:[e.jsx(x,{control:s.control,name:"telegram_bot_token",render:({field:t})=>e.jsxs(a,{children:[e.jsx(n,{children:"机器人Token"}),e.jsx(c,{children:e.jsx(h,{placeholder:"0000000000:xxxxxxxxx_xxxxxxxxxxxxxxx",...t})}),e.jsx(l,{children:"请输入由Botfather提供的token。"}),e.jsx(m,{})]})}),s.watch("telegram_bot_token")&&e.jsxs(a,{children:[e.jsx(n,{children:"设置Webhook"}),e.jsx("div",{children:e.jsx(d,{loading:f=="pending",onClick:()=>{b()},children:"一键设置"})}),e.jsx(l,{children:"对机器人进行Webhook设置，不设置将无法收到Telegram通知。"}),e.jsx(m,{})]}),e.jsx(x,{control:s.control,name:"telegram_bot_enable",render:({field:t})=>e.jsxs(a,{children:[e.jsx(n,{children:"开启机器人通知"}),e.jsx(l,{children:"开启后bot将会对绑定了telegram的管理员和用户进行基础通知。"}),e.jsx(c,{children:e.jsx(T,{checked:t.value,onCheckedChange:t.onChange})}),e.jsx(m,{})]})}),e.jsx(x,{control:s.control,name:"telegram_discuss_link",render:({field:t})=>e.jsxs(a,{children:[e.jsx(n,{children:"群组地址"}),e.jsx(c,{children:e.jsx(h,{placeholder:"https://t.me/xxxxxx",...t})}),e.jsx(l,{children:"填写后将会在用户端展示，或者被用于需要的地方。"}),e.jsx(m,{})]})}),e.jsx(d,{type:"submit",loading:p==="pending",onClick:()=>{s.handleSubmit(t=>{console.log(t),j(t)})()},children:"保存设置"})]})}function P(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Telegram设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置Telegram机器人功能，实现用户通知、账户绑定、指令交互等自动化服务。"})]}),e.jsx(F,{}),e.jsx(N,{})]})}export{P as default};
