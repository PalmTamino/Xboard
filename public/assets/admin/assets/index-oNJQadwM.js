import{r as n,j as e,a as v,x as H,u as he,t as C}from"./index-ra1jmRmU.js";import{c as z,C as fe,a as ge,b as pe,d as ve,e as P,f as A,g as je,S as be,T as ye,U as Ne}from"./user-nav-Ch7kI57y.js";import{i as O,u as we,R as Ce,I as Te,L as Se,f as Me,g as ke}from"./sidelinks-B70MVRK0.js";import{B as b,D as N,u as Re,g as Ve,b as Fe,c as Le,d as De,e as Ie,f as _e,a as Ee}from"./column-header-p2OHlx2E.js";import{u as K}from"./useQuery-BPONQpNy.js";import{c as Pe,u as Ae,a as V}from"./index-OwEZQf1t.js";import{u as Be,P as He}from"./index-CmmzV1O3.js";import{P as k}from"./index-QSXu8nGm.js";import{B as p,D as ze,e as Oe,a as Ke,c as Ue}from"./button-BkBuHKqj.js";import{P as qe,a as $e,b as Ge}from"./popover-C64Crl1x.js";import{S as L}from"./separator-Ckt7QEUw.js";import{t as T,T as j,j as w,k as We}from"./index-ngg4RcvF.js";import{u as Ze,a as Qe,U as Je,T as Xe}from"./traffic-record-table-DyDdLbR3.js";import{a8 as Ye,a9 as ea,aa as U,a as aa}from"./index-vL3ySUIK.js";import{a as M}from"./common-DR9A_A8_.js";import{T as sa}from"./textarea-C2MOf6wm.js";import{C as q}from"./confirm-dialog-Cgr3O3nI.js";import{S as F}from"./skeleton-Dl8LFgxA.js";import{u as B}from"./user-D0H1hp3K.js";import"./react-icons.esm-BRv52UVg.js";import"./index-NvRyusV4.js";import"./IconTicket-s_6DwrCY.js";import"./input-BJSapCFH.js";import"./select-ar7QGfF7.js";import"./index-DGqrqZGX.js";import"./index-DBonxKbv.js";import"./tooltip-uHmd8Pkm.js";import"./arrow-up-Cu4ezgY6.js";import"./zod-DftZp2aV.js";import"./form-BdPgCkkB.js";import"./calendar-BSDjNVAZ.js";import"./switch-koO8JJ-3.js";import"./clipboard-Bl2zvJsv.js";/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=z("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=z("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var I="Tabs",[ia,rs]=Pe(I,[O]),$=O(),[la,_]=ia(I),G=n.forwardRef((s,a)=>{const{__scopeTabs:i,value:t,onValueChange:r,defaultValue:o,orientation:l="horizontal",dir:h,activationMode:x="automatic",...f}=s,m=we(h),[d,g]=Ae({prop:t,onChange:r,defaultProp:o});return e.jsx(la,{scope:i,baseId:Be(),value:d,onValueChange:g,orientation:l,dir:m,activationMode:x,children:e.jsx(k.div,{dir:m,"data-orientation":l,...f,ref:a})})});G.displayName=I;var W="TabsList",Z=n.forwardRef((s,a)=>{const{__scopeTabs:i,loop:t=!0,...r}=s,o=_(W,i),l=$(i);return e.jsx(Ce,{asChild:!0,...l,orientation:o.orientation,dir:o.dir,loop:t,children:e.jsx(k.div,{role:"tablist","aria-orientation":o.orientation,...r,ref:a})})});Z.displayName=W;var Q="TabsTrigger",J=n.forwardRef((s,a)=>{const{__scopeTabs:i,value:t,disabled:r=!1,...o}=s,l=_(Q,i),h=$(i),x=ee(l.baseId,t),f=ae(l.baseId,t),m=t===l.value;return e.jsx(Te,{asChild:!0,...h,focusable:!r,active:m,children:e.jsx(k.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":f,"data-state":m?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:x,...o,ref:a,onMouseDown:V(s.onMouseDown,d=>{!r&&d.button===0&&d.ctrlKey===!1?l.onValueChange(t):d.preventDefault()}),onKeyDown:V(s.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&l.onValueChange(t)}),onFocus:V(s.onFocus,()=>{const d=l.activationMode!=="manual";!m&&!r&&d&&l.onValueChange(t)})})})});J.displayName=Q;var X="TabsContent",Y=n.forwardRef((s,a)=>{const{__scopeTabs:i,value:t,forceMount:r,children:o,...l}=s,h=_(X,i),x=ee(h.baseId,t),f=ae(h.baseId,t),m=t===h.value,d=n.useRef(m);return n.useEffect(()=>{const g=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(He,{present:r||m,children:({present:g})=>e.jsx(k.div,{"data-state":m?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":x,hidden:!g,id:f,tabIndex:0,...l,ref:a,style:{...s.style,animationDuration:d.current?"0s":void 0},children:g&&o})})});Y.displayName=X;function ee(s,a){return`${s}-trigger-${a}`}function ae(s,a){return`${s}-content-${a}`}var na=G,se=Z,te=J,re=Y;const oa=na,ie=n.forwardRef(({className:s,...a},i)=>e.jsx(se,{ref:i,className:v("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...a}));ie.displayName=se.displayName;const D=n.forwardRef(({className:s,...a},i)=>e.jsx(te,{ref:i,className:v("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...a}));D.displayName=te.displayName;const ca=n.forwardRef(({className:s,...a},i)=>e.jsx(re,{ref:i,className:v("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));ca.displayName=re.displayName;function da({column:s,title:a,options:i}){const t=new Set(s?.getFilterValue());return e.jsxs(qe,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),a,t?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(b,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:t.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:t.size>2?e.jsxs(b,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[t.size," selected"]}):i.filter(r=>t.has(r.value)).map(r=>e.jsx(b,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},`selected-${r.value}`))})]})]})}),e.jsx(Ge,{className:"w-[200px] p-0",align:"start",children:e.jsxs(fe,{children:[e.jsx(ge,{placeholder:a}),e.jsxs(pe,{children:[e.jsx(ve,{children:"No results found."}),e.jsx(P,{children:i.map(r=>{const o=t.has(r.value);return e.jsxs(A,{onSelect:()=>{o?t.delete(r.value):t.add(r.value);const l=Array.from(t);s?.setFilterValue(l.length?l:void 0)},children:[e.jsx("div",{className:v("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ta,{className:v("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label})]},`option-${r.value}`)})}),t.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsx(P,{children:e.jsx(A,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const ua=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11H5a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})});function ma({table:s}){return e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-4",children:[e.jsx(oa,{defaultValue:s.getColumn("status")?.getFilterValue(),onValueChange:a=>s.getColumn("status")?.setFilterValue(a),children:e.jsxs(ie,{className:"grid w-full grid-cols-2",children:[e.jsx(D,{value:"0",children:"已开始"}),e.jsx(D,{value:"1",children:"已关闭"})]})}),s.getColumn("level")&&e.jsx(da,{column:s.getColumn("level"),title:"优先级",options:[{label:T[j.LOW],value:j.LOW,icon:ua,color:"gray"},{label:T[j.MEDIUM],value:j.MEDIUM,icon:Ze,color:"yellow"},{label:T[j.HIGH],value:j.HIGH,icon:Qe,color:"red"}]})]})})}function xa(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[e.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const ha=H("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),le=n.forwardRef(({className:s,variant:a,layout:i,children:t,...r},o)=>e.jsx("div",{className:v(ha({variant:a,layout:i,className:s}),"relative group"),ref:o,...r,children:n.Children.map(t,l=>n.isValidElement(l)&&typeof l.type!="string"?n.cloneElement(l,{variant:a,layout:i}):l)}));le.displayName="ChatBubble";const fa=H("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"bg-primary text-primary-foreground rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),ne=n.forwardRef(({className:s,variant:a,layout:i,isLoading:t=!1,children:r,...o},l)=>e.jsx("div",{className:v(fa({variant:a,layout:i,className:s}),"break-words max-w-full whitespace-pre-wrap"),ref:l,...o,children:t?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(xa,{})}):r}));ne.displayName="ChatBubbleMessage";const ga=n.forwardRef(({variant:s,className:a,children:i,...t},r)=>e.jsx("div",{ref:r,className:v("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",s==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",a),...t,children:i}));ga.displayName="ChatBubbleActionWrapper";const oe=n.forwardRef(({className:s,...a},i)=>e.jsx(sa,{autoComplete:"off",ref:i,name:"message",className:v("max-h-12 px-4 py-3 bg-background text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 w-full rounded-md flex items-center h-16 resize-none",s),...a}));oe.displayName="ChatInput";const ce=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29l-4.3 4.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l4.29-4.3l4.29 4.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42Z"})}),de=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.098 12.634L13 11.423V7a1 1 0 0 0-2 0v5a1 1 0 0 0 .5.866l2.598 1.5a1 1 0 1 0 1-1.732M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8.01 8.01 0 0 1-8 8"})}),pa=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M3.71 16.29a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21a1 1 0 0 0-.21.33a1 1 0 0 0 .21 1.09a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1 1 0 0 0 .21-1.09a1 1 0 0 0-.21-.33M7 8h14a1 1 0 0 0 0-2H7a1 1 0 0 0 0 2m-3.29 3.29a1 1 0 0 0-1.09-.21a1.2 1.2 0 0 0-.33.21a1 1 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1 1 0 0 0-.21-.33M21 11H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2M3.71 6.29a1 1 0 0 0-.33-.21a1 1 0 0 0-1.09.21a1.2 1.2 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a1 1 0 0 0 1.09-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1.2 1.2 0 0 0-.21-.33M21 16H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})}),va=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9 12H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-1-2h4a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2m1 6H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m12-4h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Zm-6.44-2.83a.8.8 0 0 0-.18-.09a.6.6 0 0 0-.19-.06a1 1 0 0 0-.9.27A1.05 1.05 0 0 0 12 17a1 1 0 0 0 .07.38a1.2 1.2 0 0 0 .22.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21A1 1 0 0 0 14 17a1.05 1.05 0 0 0-.29-.71a2 2 0 0 0-.15-.12m.14-3.88a1 1 0 0 0-1.62.33A1 1 0 0 0 13 14a1 1 0 0 0 1-1a1 1 0 0 0-.08-.38a.9.9 0 0 0-.22-.33"})});function ja(){return e.jsxs("div",{className:"flex h-full flex-col space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"h-8 w-3/4"}),e.jsx(F,{className:"h-4 w-1/2"})]}),e.jsx("div",{className:"flex-1 space-y-4",children:[1,2,3].map(s=>e.jsx(F,{className:"h-20 w-2/3"},s))})]})}function ba({ticketId:s,dialogTrigger:a}){const i=he(),t=n.useRef(null),[r,o]=n.useState(!1),[l,h]=n.useState(""),[x,f]=n.useState(!1),{data:m,refetch:d,isLoading:g}=K({queryKey:["ticket",s,r],queryFn:()=>r?Ye(s):Promise.resolve(null),refetchInterval:r?5e3:!1,retry:3}),u=m?.data,R=(c="smooth")=>{if(t.current){const{scrollHeight:S,clientHeight:xe}=t.current;t.current.scrollTo({top:S-xe,behavior:c})}};n.useEffect(()=>{if(!r)return;const c=requestAnimationFrame(()=>{R("instant"),setTimeout(()=>R(),1e3)});return()=>{cancelAnimationFrame(c)}},[r,u?.messages]);const E=async()=>{const c=l.trim();if(!(!c||x)){f(!0);try{await ea({id:s,message:c}),h(""),await d(),R()}catch(S){C.error(S instanceof Error?S.message:"回复失败")}finally{f(!1)}}},ue=async()=>{try{await U(s),C.success("工单已关闭"),await d()}catch(c){C.error(c instanceof Error?c.message:"关闭工单失败")}},me=()=>{u?.user&&i("/finance/order?user_id="+u.user.id)},y=u?.status===w.CLOSED;return e.jsxs(ze,{open:r,onOpenChange:o,children:[e.jsx(Oe,{asChild:!0,children:a??e.jsx(p,{variant:"outline",children:"查看工单"})}),e.jsxs(Ke,{className:"flex h-[90vh] max-w-4xl flex-col gap-0 p-0",children:[e.jsx(Ue,{}),g?e.jsx(ja,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4 border-b p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:u?.subject}),e.jsx(b,{variant:y?"secondary":"default",children:y?"已关闭":"处理中"}),!y&&e.jsx(q,{title:"确认关闭工单",description:"关闭后将无法继续回复，是否确认关闭该工单？",confirmText:"关闭工单",variant:"destructive",onConfirm:ue,children:e.jsxs(p,{variant:"ghost",size:"sm",className:"gap-1 text-muted-foreground hover:text-destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),"关闭工单"]})})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:u?.user?.email})]}),e.jsx(L,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["创建于 ",M(u?.created_at)]})]}),e.jsx(L,{orientation:"vertical",className:"h-4"}),e.jsx(b,{variant:"outline",children:u?.level!=null&&T[u.level]})]})]}),u?.user&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Je,{defaultValues:u.user,refetch:d,dialogTrigger:e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8",title:"用户信息",children:e.jsx(B,{className:"h-4 w-4"})})}),e.jsx(Xe,{user_id:u.user.id,dialogTrigger:e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8",title:"流量记录",children:e.jsx(pa,{className:"h-4 w-4"})})}),e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8",title:"订单记录",onClick:me,children:e.jsx(va,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{ref:t,className:"h-full space-y-4 overflow-y-auto p-6",children:u?.messages?.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:"暂无消息记录"}):u?.messages?.map(c=>e.jsx(le,{variant:c.is_me?"sent":"received",className:c.is_me?"ml-auto":"mr-auto",children:e.jsx(ne,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"whitespace-pre-wrap break-words",children:c.message}),e.jsx("div",{className:"text-right",children:e.jsx("time",{className:"text-[10px] text-muted-foreground",children:M(c.created_at)})})]})})},c.id))})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"relative flex items-center space-x-2",children:[e.jsx(oe,{disabled:y||x,placeholder:y?"工单已关闭":"请输入回复内容...",className:"flex-1 resize-none rounded-lg border bg-background p-3 focus-visible:ring-1",value:l,onChange:c=>h(c.target.value),onKeyDown:c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),E())}}),e.jsx(p,{disabled:y||x||!l.trim(),onClick:E,children:x?"发送中...":"发送"})]})})]})]})]})}const ya=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3m-.41 2l-5.88 5.88a1 1 0 0 1-1.42 0L5.41 6ZM20 17a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V7.41l5.88 5.88a3 3 0 0 0 4.24 0L20 7.41Z"})}),Na=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.92 11.6C19.9 6.91 16.1 4 12 4s-7.9 2.91-9.92 7.6a1 1 0 0 0 0 .8C4.1 17.09 7.9 20 12 20s7.9-2.91 9.92-7.6a1 1 0 0 0 0-.8M12 18c-3.17 0-6.17-2.29-7.9-6C5.83 8.29 8.83 6 12 6s6.17 2.29 7.9 6c-1.73 3.71-4.73 6-7.9 6m0-10a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"})}),wa=s=>[{accessorKey:"id",header:({column:a})=>e.jsx(N,{column:a,title:"工单号"}),cell:({row:a})=>e.jsx(b,{variant:"outline",children:a.getValue("id")}),enableSorting:!1,enableHiding:!1},{accessorKey:"subject",header:({column:a})=>e.jsx(N,{column:a,title:"主题"}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ya,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[500px] truncate font-medium",children:a.getValue("subject")})]}),enableSorting:!1,enableHiding:!1,size:4e3},{accessorKey:"level",header:({column:a})=>e.jsx(N,{column:a,title:"优先级"}),cell:({row:a})=>{const i=a.getValue("level"),t=i===j.LOW?"default":i===j.MEDIUM?"secondary":"destructive";return e.jsx(b,{variant:t,className:"whitespace-nowrap",children:T[i]})},filterFn:(a,i,t)=>t.includes(a.getValue(i))},{accessorKey:"status",header:({column:a})=>e.jsx(N,{column:a,title:"状态"}),cell:({row:a})=>{const i=a.getValue("status"),t=a.original.reply_status,r=i===w.CLOSED?We[w.CLOSED]:t===0?"已回复":"待回复",o=i===w.CLOSED?"default":t===0?"secondary":"destructive";return e.jsx(b,{variant:o,className:"whitespace-nowrap",children:r})}},{accessorKey:"updated_at",header:({column:a})=>e.jsx(N,{column:a,title:"最后更新"}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:M(a.getValue("updated_at"))})]}),enableSorting:!0},{accessorKey:"created_at",header:({column:a})=>e.jsx(N,{column:a,title:"创建时间"}),cell:({row:a})=>e.jsx("div",{className:"text-sm text-muted-foreground",children:M(a.getValue("created_at"))}),enableSorting:!0,meta:{isFlexGrow:!0}},{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"操作"}),cell:({row:a})=>{const i=a.original.status!==w.CLOSED;return e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(ba,{ticketId:a.original.id,dialogTrigger:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"查看详情",children:e.jsx(Na,{className:"h-4 w-4"})})}),i&&e.jsx(q,{title:"确认关闭工单",description:"关闭后将无法继续回复，是否确认关闭该工单？",confirmText:"关闭工单",variant:"destructive",onConfirm:async()=>{try{await U(a.original.id),C.success("工单已关闭"),s()}catch{C.error("关闭工单失败")}},children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"关闭工单",children:e.jsx(ce,{className:"h-4 w-4"})})})]})}}];function Ca(){const[s,a]=n.useState({}),[i,t]=n.useState({}),[r,o]=n.useState([{id:"status",value:"0"}]),[l,h]=n.useState([]),[x,f]=n.useState({pageIndex:0,pageSize:10}),{refetch:m,data:d,isLoading:g}=K({queryKey:["orderList",x,r,l],queryFn:()=>aa({pageSize:x.pageSize,current:x.pageIndex+1,filter:r,sort:l})}),u=Re({data:d?.data??[],columns:wa(m),state:{sorting:l,columnVisibility:i,rowSelection:s,columnFilters:r,pagination:x},rowCount:d?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:h,onColumnFiltersChange:o,onColumnVisibilityChange:t,getCoreRowModel:Ve(),getFilteredRowModel:Fe(),getPaginationRowModel:Le(),onPaginationChange:f,getSortedRowModel:De(),getFacetedRowModel:Ie(),getFacetedUniqueValues:_e(),initialState:{columnPinning:{right:["actions"]}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ma,{table:u,refetch:m}),e.jsx(Ee,{table:u,showPagination:!0})]})}function is(){return e.jsxs(Se,{children:[e.jsxs(Me,{children:[e.jsx(be,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ye,{}),e.jsx(Ne,{})]})]}),e.jsxs(ke,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:" 工单管理"}),e.jsx("p",{className:"text-muted-foreground",children:"在这里可以查看用户工单，包括查看、回复、关闭等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ca,{})})]})]})}export{is as default};
