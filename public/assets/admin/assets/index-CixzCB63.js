import{j as e,B as z,a as N,r as m,L as ee,e as se}from"./index-ra1jmRmU.js";import{c as ae,C as te,a as le,b as re,d as ne,e as M,f as O,g as ie,S as oe,T as ce,U as de}from"./user-nav-Ch7kI57y.js";import{D as V,a as R,b as k,e as C,L as me,f as ue,g as xe}from"./sidelinks-B70MVRK0.js";import{B as g,D as u,u as he,g as ge,b as je,c as fe,d as pe,e as Ne,f as ve,a as be}from"./column-header-p2OHlx2E.js";import{u as Ce}from"./useQuery-BPONQpNy.js";import{d as Se,S as K,e as E,f as U,Q as ye,b as we,c as Ie,a as De}from"./react-icons.esm-BRv52UVg.js";import{I as Ee}from"./input-BJSapCFH.js";import{O as i,o as h,b as f,C as o,c as S,d as y,e as B,f as Pe}from"./index-ngg4RcvF.js";import{P as _e,a as Le,b as Te}from"./popover-C64Crl1x.js";import{S as $}from"./separator-Ckt7QEUw.js";import{O as Fe}from"./order-assign-form-SPO5KUlu.js";import{Y as Me,Z as Oe,_ as Ve,$ as A,b as Re}from"./index-vL3ySUIK.js";import{D as ke,e as Ae,a as Ge,b as He,c as ze,B as D}from"./button-BkBuHKqj.js";import{f as p,a as P}from"./common-DR9A_A8_.js";import{T as Ke,a as Ue,b as Be,c as $e}from"./tooltip-uHmd8Pkm.js";import{u as qe}from"./question-circle-DbxGI5ux.js";import"./index-CmmzV1O3.js";import"./index-OwEZQf1t.js";import"./index-QSXu8nGm.js";import"./index-NvRyusV4.js";import"./IconTicket-s_6DwrCY.js";import"./select-ar7QGfF7.js";import"./index-DGqrqZGX.js";import"./index-DBonxKbv.js";import"./arrow-up-Cu4ezgY6.js";import"./zod-DftZp2aV.js";import"./form-BdPgCkkB.js";import"./clipboard-Bl2zvJsv.js";/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=ae("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Y=[{value:i.PENDING,label:h[i.PENDING],icon:Se,color:f[i.PENDING]},{value:i.PROCESSING,label:h[i.PROCESSING],icon:K,color:f[i.PROCESSING]},{value:i.COMPLETED,label:h[i.COMPLETED],icon:E,color:f[i.COMPLETED]},{value:i.CANCELLED,label:h[i.CANCELLED],icon:U,color:f[i.CANCELLED]},{value:i.DISCOUNTED,label:h[i.DISCOUNTED],icon:E,color:f[i.DISCOUNTED]}],Q=[{value:o.PENDING,label:S[o.PENDING],icon:ye,color:y[o.PENDING]},{value:o.PROCESSING,label:S[o.PROCESSING],icon:K,color:y[o.PROCESSING]},{value:o.VALID,label:S[o.VALID],icon:E,color:y[o.VALID]},{value:o.INVALID,label:S[o.INVALID],icon:U,color:y[o.INVALID]}];function G({column:a,title:s,options:r}){const t=a?.getFacetedUniqueValues(),l=a?.getFilterValue(),c=Array.isArray(l)?new Set(l):l!==void 0?new Set([l]):new Set;return e.jsxs(_e,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),s,c?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx($,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(g,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:c.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:c.size>2?e.jsxs(g,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[c.size," selected"]}):r.filter(n=>c.has(n.value)).map(n=>e.jsx(g,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:n.label},n.value))})]})]})}),e.jsx(Te,{className:"w-[200px] p-0",align:"start",children:e.jsxs(te,{children:[e.jsx(le,{placeholder:s}),e.jsxs(re,{children:[e.jsx(ne,{children:"No results found."}),e.jsx(M,{children:r.map(n=>{const x=c.has(n.value);return e.jsxs(O,{onSelect:()=>{const j=new Set(c);x?j.delete(n.value):j.add(n.value);const v=Array.from(j);a?.setFilterValue(v.length?v:void 0)},children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",x?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Ie,{className:N("h-4 w-4")})}),n.icon&&e.jsx(n.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${n.color}`}),e.jsx("span",{children:n.label}),t?.get(n.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:t.get(n.value)})]},n.value)})}),c.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(M,{children:e.jsx(O,{onSelect:()=>a?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function Ye({table:a,refetch:s}){const r=a.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Ee,{placeholder:"搜索订单...",value:a.getColumn("trade_no")?.getFilterValue()??"",onChange:t=>a.getColumn("trade_no")?.setFilterValue(t.target.value),className:"h-9 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[a.getColumn("status")&&e.jsx(G,{column:a.getColumn("status"),title:"订单状态",options:Y}),a.getColumn("commission_status")&&e.jsx(G,{column:a.getColumn("commission_status"),title:"佣金状态",options:Q})]}),r&&e.jsxs(z,{variant:"ghost",onClick:()=>a.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(De,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Fe,{refetch:s})]})}function d({label:a,value:s,className:r,valueClassName:t}){return e.jsxs("div",{className:N("flex items-center py-1.5",r),children:[e.jsx("div",{className:"w-28 shrink-0 text-sm text-muted-foreground",children:a}),e.jsx("div",{className:N("text-sm",t),children:s||"-"})]})}function Qe({status:a}){const s={PENDING:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",PAID:"bg-green-100 text-green-800 hover:bg-green-100",FAILED:"bg-red-100 text-red-800 hover:bg-red-100",REFUNDED:"bg-gray-100 text-gray-800 hover:bg-gray-100"};return e.jsx(g,{variant:"secondary",className:N("font-medium",s[a]),children:h[a]})}function Ze({id:a,trigger:s}){const[r,t]=m.useState(!1),[l,c]=m.useState();return m.useEffect(()=>{(async()=>{if(r){const{data:x}=await Me({id:a});c(x)}})()},[r,a]),e.jsxs(ke,{onOpenChange:t,open:r,children:[e.jsx(Ae,{asChild:!0,children:s}),e.jsxs(Ge,{className:"max-w-xl",children:[e.jsxs(He,{className:"space-y-2",children:[e.jsx(ze,{className:"text-lg font-medium",children:"订单信息"}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-muted-foreground",children:["订单号：",l?.trade_no]}),l?.status&&e.jsx(Qe,{status:l.status})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"基本信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{label:"用户邮箱",value:l?.user?.email?e.jsxs(ee,{to:`/user/manage?email=${l.user.email}`,className:"group inline-flex items-center gap-1 text-primary hover:underline",children:[l.user.email,e.jsx(q,{className:"h-3.5 w-3.5 opacity-0 transition-opacity group-hover:opacity-100"})]}):"-"}),e.jsx(d,{label:"订单周期",value:l&&B[l.period]}),e.jsx(d,{label:"订阅计划",value:l?.plan?.name,valueClassName:"font-medium"}),e.jsx(d,{label:"回调单号",value:l?.callback_no,valueClassName:"font-mono text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"金额信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{label:"支付金额",value:p(l?.total_amount||0),valueClassName:"font-medium text-primary"}),e.jsx($,{className:"my-2"}),e.jsx(d,{label:"余额支付",value:p(l?.balance_amount||0)}),e.jsx(d,{label:"优惠金额",value:p(l?.discount_amount||0),valueClassName:"text-green-600"}),e.jsx(d,{label:"退回金额",value:p(l?.refund_amount||0),valueClassName:"text-red-600"}),e.jsx(d,{label:"折抵金额",value:p(l?.surplus_amount||0)})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"时间信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{label:"创建时间",value:P(l?.created_at),valueClassName:"font-mono text-xs"}),e.jsx(d,{label:"更新时间",value:P(l?.updated_at),valueClassName:"font-mono text-xs"})]})]})]})]})]})}const H=a=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...a,children:e.jsx("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"})}),Je=a=>[{accessorKey:"trade_no",header:({column:s})=>e.jsx(u,{column:s,title:"#订单号"}),cell:({row:s})=>{const r=s.original.trade_no,t=r.length>6?`${r.slice(0,3)}...${r.slice(-3)}`:r;return e.jsx("div",{className:"flex items-center",children:e.jsx(Ze,{trigger:e.jsxs(D,{variant:"ghost",size:"sm",className:"h-8 px-2 text-blue-500 hover:text-blue-600 hover:bg-blue-50 flex items-center gap-1 font-medium",children:[e.jsx("span",{children:t}),e.jsx(q,{className:"h-3.5 w-3.5"})]}),id:s.original.id})})},enableSorting:!1,enableHiding:!1},{accessorKey:"type",header:({column:s})=>e.jsx(u,{column:s,title:"类型"}),cell:({row:s})=>e.jsx(g,{variant:"outline",children:Pe[s.getValue("type")]}),enableSorting:!1,enableHiding:!1},{accessorKey:"plan.name",header:({column:s})=>e.jsx(u,{column:s,title:"订阅计划"}),cell:({row:s})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:s.original.plan?.name||"-"})}),enableSorting:!1,enableHiding:!1},{accessorKey:"period",header:({column:s})=>e.jsx(u,{column:s,title:"周期"}),cell:({row:s})=>e.jsx(g,{variant:"outline",children:B[s.getValue("period")]}),enableSorting:!1,enableHiding:!1},{accessorKey:"total_amount",header:({column:s})=>e.jsx(u,{column:s,title:"支付金额"}),cell:({row:s})=>{const r=s.getValue("total_amount"),t=typeof r=="number"?(r/100).toFixed(2):"N/A";return e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:t})})},enableSorting:!1,enableHiding:!1},{accessorKey:"status",header:({column:s})=>e.jsxs("div",{className:"flex",children:[e.jsx(u,{column:s,title:"订单状态"}),e.jsx(Ke,{delayDuration:100,children:e.jsxs(Ue,{children:[e.jsx(Be,{className:"ml-1",children:e.jsx(qe,{})}),e.jsx($e,{children:"标记为[已支付]后将会由系统进行开通后并完成"})]})})]}),cell:({row:s,table:r})=>{const t=Y.find(l=>l.value===s.getValue("status"));return t&&e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex items-center",children:[t.icon&&e.jsx(t.icon,{className:`mr-2 h-4 w-4 text-${t.color}`}),e.jsx("span",{children:t.label})]}),t.value===i.PENDING&&e.jsxs(V,{modal:!0,children:[e.jsx(R,{asChild:!0,children:e.jsx("div",{className:"text-end",children:e.jsxs(D,{variant:"link",size:"sm",children:["标记为",e.jsx(H,{className:" h-4 w-4"})]})})}),e.jsxs(k,{align:"end",className:"min-w-[40px]",children:[e.jsx(C,{className:"cursor-pointer",onClick:()=>{Oe({trade_no:s.original.trade_no}),a()},children:"已支付"}),e.jsx(C,{className:"cursor-pointer",onClick:()=>{Ve({trade_no:s.original.trade_no}),a()},children:"取消"})]})]})]})},enableSorting:!1,enableHiding:!1},{accessorKey:"commission_balance",header:({column:s})=>e.jsx(u,{column:s,title:"佣金金额"}),cell:({row:s})=>{const r=s.getValue("commission_balance"),t=r?(r/100).toFixed(2):"-";return e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:t})})},enableSorting:!1,enableHiding:!1},{accessorKey:"commission_status",header:({column:s})=>e.jsx(u,{column:s,title:"佣金状态"}),cell:({row:s})=>{const r=s.original.commission_status,t=Q.find(l=>l.value===s.getValue("commission_status"));return r==0||!t?"-":e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex  items-center",children:[t.icon&&e.jsx(t.icon,{className:`mr-2 h-4 w-4 text-${t.color}`}),e.jsx("span",{children:t.label})]}),t.value===o.PENDING&&e.jsxs(V,{modal:!0,children:[e.jsx(R,{asChild:!0,children:e.jsx("div",{className:"text-end",children:e.jsxs(D,{variant:"link",size:"sm",children:["标记为",e.jsx(H,{className:" h-4 w-4"})]})})}),e.jsxs(k,{align:"end",className:"min-w-[40px]",children:[e.jsx(C,{className:"cursor-pointer",onClick:()=>{A({trade_no:s.original.trade_no,commission_status:o.PROCESSING}),a()},children:"有效"}),e.jsx(C,{className:"cursor-pointer",onClick:()=>{A({trade_no:s.original.trade_no,commission_status:o.INVALID}),a()},children:"无效"})]})]})]})},enableSorting:!1,enableHiding:!1},{accessorKey:"created_at",header:({column:s})=>e.jsx(u,{column:s,title:"创建时间"}),cell:({row:s})=>e.jsx("div",{children:P(s.getValue("created_at"),"YYYY/MM/DD HH:mm:ss")}),enableSorting:!0,enableHiding:!1}];function We(){const a=se(),s=new URLSearchParams(a.search),r=Array.from(s.entries()).map(([X,F])=>({id:X,value:parseInt(F)||F})),[t]=m.useState(!0),l=t&&a.state?.filters?a.state.filters:[],c=[...r,...l];m.useEffect(()=>{a.state?.filters&&window.history.replaceState({...a.state,filters:void 0},"")},[]);const[n,x]=m.useState({}),[j,v]=m.useState({}),[w,Z]=m.useState(c),[I,J]=m.useState([]),[b,W]=m.useState({pageIndex:0,pageSize:10}),{refetch:_,data:L,isLoading:Xe}=Ce({queryKey:["orderList",b,w,I],queryFn:()=>Re({pageSize:b.pageSize,current:b.pageIndex+1,filter:w,sort:I})}),T=he({data:L?.data??[],columns:Je(_),state:{sorting:I,columnVisibility:j,rowSelection:n,columnFilters:w,pagination:b},rowCount:L?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:x,onSortingChange:J,onColumnFiltersChange:Z,onColumnVisibilityChange:v,getCoreRowModel:ge(),getFilteredRowModel:je(),getPaginationRowModel:fe(),onPaginationChange:W,getSortedRowModel:pe(),getFacetedRowModel:Ne(),getFacetedUniqueValues:ve()});return e.jsx(be,{table:T,toolbar:e.jsx(Ye,{table:T,refetch:_}),showPagination:!0})}function Es(){return e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(oe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ce,{}),e.jsx(de,{})]})]}),e.jsxs(xe,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:" 订单管理"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"在这里可以查看用户订单，包括分配、查看、删除等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(We,{})})]})]})}export{Es as default};
