import{r as o,j as e,t as Zr,c as Xr,I as ra,a as ps,S as Kt,u as We,b as ot,d as Qr,O as Gt,e as el,f as z,g as sl,h as tl,i as al,Q as nl,k as rl,R as ll,l as il,P as ol,m as cl,B as dl,n as Da,F as xl,C as ml,o as ul,p as hl,q as jl,s as gl,v as fl,z as i,w as Ta,x as Z,y as Q,A as Fa,D as ct,E as dt,G as Ut,H as Re,T as xt,J as mt,K as Pa,L as Va,M as pl,N as vl,U as bl,V as yl,W as Ia,X as qt,Y as za,Z as Nl,_ as Ra,$ as Ea,a0 as Ma,a1 as Oa,a2 as ds,a3 as La,a4 as wl,a5 as $a,a6 as Aa,a7 as _l,a8 as Cl,a9 as Sl,aa as kl,ab as Ha,ac as Dl,ad as Tl,ae as vs,af as Ka,ag as Fl,ah as Pl,ai as Ga,aj as Vl,ak as Il,al as la,am as zl,an as Ua,ao as Rl,ap as qa,aq as El,ar as Ml,as as Ol,at as Ll,au as $l,av as Al,aw as Ba,ax as Hl,ay as Kl,az as Gl,aA as ve,aB as Ul,aC as ql,aD as Bl,aE as Yl,aF as Ya,aG as Wa,aH as Ja,aI as Wl,aJ as Ft,aK as Jl,aL as Pt,aM as at,aN as Vt,aO as It,aP as Zl,aQ as ia,aR as oa,aS as G,aT as Xl,aU as Ql,aV as ei,aW as si,aX as ti,aY as Za,aZ as ai,a_ as ni,a$ as ri,b0 as Xa,b1 as li,b2 as Ye,b3 as Qa,b4 as ii,b5 as en,b6 as oi,b7 as sn,b8 as ci,b9 as tn,ba as an,bb as di,bc as xi,bd as nn,be as mi,bf as ui,bg as rn,bh as hi,bi as ln,bj as ji,bk as gi,bl as nt,bm as Bs,bn as fi,bo as ca,bp as zt,bq as Rt,br as da,bs as xa,bt as pi,bu as ut,bv as wt,bw as on,bx as vi,by as bi,bz as yi,bA as Ni,bB as cn,bC as wi,bD as Et,bE as _i,bF as Ci,bG as rt,bH as Ce,bI as ma,bJ as Si,bK as dn,bL as xn,bM as mn,bN as un,bO as hn,bP as jn,bQ as ki,bR as Di,bS as Ti,bT as ht,bU as bs,bV as Je,bW as Fe,bX as Pe,bY as Ee,bZ as Me,b_ as Oe,b$ as gn,c0 as ua,c1 as Mt,c2 as Ze,c3 as Xe,c4 as fn,c5 as pn,c6 as Fs,c7 as Fi,c8 as Pi,c9 as Vi,ca as vn,cb as ha,cc as lt,cd as Ii,ce as zi,cf as bn,cg as Ri,ch as Ei,ci as yn,cj as Ot,ck as Nn,cl as Mi,cm as wn,cn as Oi,co as Li,cp as $i,cq as _n,cr as Cn,cs as Sn,ct as Ai,cu as Hi,cv as Ki}from"./vendor.js";import"./index.js";var gu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}const Gi={theme:"system",setTheme:()=>null},kn=o.createContext(Gi);function Ui({children:s,defaultTheme:t="system",storageKey:a="vite-ui-theme",...n}){const[r,l]=o.useState(()=>localStorage.getItem(a)||t);o.useEffect(()=>{const x=window.document.documentElement;if(x.classList.remove("light","dark"),r==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";x.classList.add(u);return}x.classList.add(r)},[r]);const c={theme:r,setTheme:x=>{localStorage.setItem(a,x),l(x)}};return e.jsx(kn.Provider,{...n,value:c,children:s})}const qi=()=>{const s=o.useContext(kn);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},Bi=function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),Yi=function(s,t){return new URL(s,t).href},ja={},J=function(t,a,n){let r=Promise.resolve();if(a&&a.length>0){const c=document.getElementsByTagName("link"),x=document.querySelector("meta[property=csp-nonce]"),u=x?.nonce||x?.getAttribute("nonce");r=Promise.allSettled(a.map(b=>{if(b=Yi(b,n),b in ja)return;ja[b]=!0;const p=b.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(!!n)for(let F=c.length-1;F>=0;F--){const T=c[F];if(T.href===b&&(!p||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${y}`))return;const D=document.createElement("link");if(D.rel=p?"stylesheet":Bi,p||(D.as="script"),D.crossOrigin="",D.href=b,u&&D.setAttribute("nonce",u),document.head.appendChild(D),p)return new Promise((F,T)=>{D.addEventListener("load",F),D.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${b}`)))})}))}function l(c){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=c,window.dispatchEvent(x),!x.defaultPrevented)throw c}return r.then(c=>{for(const x of c||[])x.status==="rejected"&&l(x.reason);return t().catch(l)})};function f(...s){return Zr(Xr(s))}const De=ps("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),k=o.forwardRef(({className:s,variant:t,size:a,asChild:n=!1,children:r,disabled:l,loading:c=!1,leftSection:x,rightSection:u,...b},p)=>{const y=n?Kt:"button";return e.jsxs(y,{className:f(De({variant:t,size:a,className:s})),disabled:c||l,ref:p,...b,children:[(x&&c||!x&&!u&&c)&&e.jsx(ra,{className:"mr-2 h-4 w-4 animate-spin"}),!c&&x&&e.jsx("div",{className:"mr-2",children:x}),r,!c&&u&&e.jsx("div",{className:"ml-2",children:u}),u&&c&&e.jsx(ra,{className:"ml-2 h-4 w-4 animate-spin"})]})});k.displayName="Button";function Ns({className:s,minimal:t=!1}){const a=We();return e.jsx("div",{className:f("h-svh w-full",s),children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[!t&&e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"500"}),e.jsxs("span",{className:"font-medium",children:["Oops! Something went wrong ",":')"]}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["We apologize for the inconvenience. ",e.jsx("br",{})," Please try again later."]}),!t&&e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(k,{variant:"outline",onClick:()=>a(-1),children:"Go Back"}),e.jsx(k,{onClick:()=>a("/"),children:"Back to Home"})]})]})})}function ga(){const s=We();return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"404"}),e.jsx("span",{className:"font-medium",children:"Oops! Page Not Found!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["It seems like the page you're looking for ",e.jsx("br",{}),"does not exist or might have been removed."]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(k,{variant:"outline",onClick:()=>s(-1),children:"Go Back"}),e.jsx(k,{onClick:()=>s("/"),children:"Back to Home"})]})]})})}function Wi(){return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"503"}),e.jsx("span",{className:"font-medium",children:"Website is under maintenance!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["The site is not available at the moment. ",e.jsx("br",{}),"We'll be back online shortly."]}),e.jsx("div",{className:"mt-6 flex gap-4",children:e.jsx(k,{variant:"outline",children:"Learn more"})})]})})}function Ji(s){return typeof s>"u"}function Zi(s){return s===null}function Xi(s){return Zi(s)||Ji(s)}class Qi{storage;prefixKey;constructor(t){this.storage=t.storage,this.prefixKey=t.prefixKey}getKey(t){return`${this.prefixKey}${t}`.toUpperCase()}set(t,a,n=null){const r=JSON.stringify({value:a,time:Date.now(),expire:n!==null?new Date().getTime()+n*1e3:null});this.storage.setItem(this.getKey(t),r)}get(t,a=null){const n=this.storage.getItem(this.getKey(t));if(!n)return{value:a,time:0};try{const r=JSON.parse(n),{value:l,time:c,expire:x}=r;return Xi(x)||x>new Date().getTime()?{value:l,time:c}:(this.remove(t),{value:a,time:0})}catch{return this.remove(t),{value:a,time:0}}}remove(t){this.storage.removeItem(this.getKey(t))}clear(){this.storage.clear()}}function Dn({prefixKey:s="",storage:t=sessionStorage}){return new Qi({prefixKey:s,storage:t})}const Tn="Xboard_",eo=function(s={}){return Dn({prefixKey:s.prefixKey||"",storage:localStorage})},so=function(s={}){return Dn({prefixKey:s.prefixKey||"",storage:sessionStorage})},jt=eo({prefixKey:Tn});so({prefixKey:Tn});const Fn="access_token";function $s(){return jt.get(Fn)}function Pn(){jt.remove(Fn)}const fa=["/sign-in","/sign-in-2","/sign-up","/forgot-password","/otp"];function to({children:s}){const t=We(),a=ot(),n=$s();return o.useEffect(()=>{if(!n.value&&!fa.includes(a.pathname)){const r=encodeURIComponent(a.pathname+a.search);t(`/sign-in?redirect=${r}`)}},[n.value,a.pathname,a.search,t]),fa.includes(a.pathname)||n.value?e.jsx(e.Fragment,{children:s}):null}const ao=()=>e.jsx(to,{children:e.jsx(Gt,{})}),no=Qr([{path:"/sign-in",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>So);return{default:s}},void 0,import.meta.url)).default})},{element:e.jsx(ao,{}),children:[{path:"/",lazy:async()=>({Component:(await J(()=>Promise.resolve().then(()=>$o),void 0,import.meta.url)).default}),errorElement:e.jsx(Ns,{}),children:[{index:!0,lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>ad);return{default:s}},void 0,import.meta.url)).default})},{path:"config",errorElement:e.jsx(Ns,{}),children:[{path:"system",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>ld);return{default:s}},void 0,import.meta.url)).default}),children:[{index:!0,lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>md);return{default:s}},void 0,import.meta.url)).default})},{path:"safe",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>fd);return{default:s}},void 0,import.meta.url)).default})},{path:"subscribe",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Nd);return{default:s}},void 0,import.meta.url)).default})},{path:"invite",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>kd);return{default:s}},void 0,import.meta.url)).default})},{path:"frontend",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Vd);return{default:s}},void 0,import.meta.url)).default})},{path:"server",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Md);return{default:s}},void 0,import.meta.url)).default})},{path:"email",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Hd);return{default:s}},void 0,import.meta.url)).default})},{path:"telegram",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Bd);return{default:s}},void 0,import.meta.url)).default})},{path:"APP",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Xd);return{default:s}},void 0,import.meta.url)).default})}]},{path:"payment",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>xx);return{default:s}},void 0,import.meta.url)).default})},{path:"theme",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>hx);return{default:s}},void 0,import.meta.url)).default})},{path:"notice",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>yx);return{default:s}},void 0,import.meta.url)).default})},{path:"knowledge",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Tx);return{default:s}},void 0,import.meta.url)).default})}]},{path:"server",errorElement:e.jsx(Ns,{}),children:[{path:"manage",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Hx);return{default:s}},void 0,import.meta.url)).default})},{path:"group",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Bx);return{default:s}},void 0,import.meta.url)).default})},{path:"route",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Qx);return{default:s}},void 0,import.meta.url)).default})}]},{path:"finance",errorElement:e.jsx(Ns,{}),children:[{path:"plan",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>om);return{default:s}},void 0,import.meta.url)).default})},{path:"order",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>fm);return{default:s}},void 0,import.meta.url)).default})},{path:"coupon",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Sm);return{default:s}},void 0,import.meta.url)).default})}]},{path:"user",errorElement:e.jsx(Ns,{}),children:[{path:"manage",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>Ym);return{default:s}},void 0,import.meta.url)).default})},{path:"ticket",lazy:async()=>({Component:(await J(async()=>{const{default:s}=await Promise.resolve().then(()=>uu);return{default:s}},void 0,import.meta.url)).default})}]}]}]},{path:"/500",Component:Ns},{path:"/404",Component:ga},{path:"/503",Component:Wi},{path:"*",Component:ga}]),ro="locale";function lo(){return jt.get(ro)}function Vn(){Pn();const s=window.location.pathname,t=s&&!["/404","/sign-in"].includes(s);window.location.href="/sign-in"+(t?`?redirect=${s}`:"")}const io=["/passport/auth/login","/passport/auth/token2Login","/passport/auth/register","/guest/comm/config","/passport/comm/sendEmailVerify","/passport/auth/forget"];function oo(){const s=window.settings?.base_url||"/";return s.endsWith("/")?s+"api/v2":s+"/api/v2"}const I=el.create({baseURL:oo(),timeout:12e3,headers:{"Content-Type":"application/json"}});I.interceptors.request.use(s=>{s.method?.toLowerCase()==="get"&&(s.params={...s.params,t:Date.now()});const t=$s();if(!io.includes(s.url?.split("?")[0]||"")){if(!t.value)return Vn(),Promise.reject({code:-1,message:"未登录"});s.headers.Authorization=t.value}return s.headers["Content-Language"]=lo().value||"zh-CN",s},s=>Promise.reject(s));I.interceptors.response.use(s=>{const t=s?.data||{code:-1,message:"未知错误"};return Promise.resolve(t)},s=>{const t=s.response?.data||{data:null,code:-1,message:"未知错误"},a=s.response?.status;let n=t.message;return a===401||a===403?(Vn(),n=a===401?n||"登录已过期":n||"没有权限"):a===404?n=n||"资源或接口不存在":n=n||"未知异常",z.error(n),Promise.resolve(t)});function co(){return I.get("/user/info")}const _t={token:$s()?.value||"",userInfo:null,isLoggedIn:!!$s()?.value,loading:!1,error:null},Os=sl("user/fetchUserInfo",async()=>(await co()).data,{condition:(s,{getState:t})=>{const{user:a}=t();return!!a.token&&!a.loading}}),In=tl({name:"user",initialState:_t,reducers:{setToken(s,t){s.token=t.payload,s.isLoggedIn=!!t.payload},resetUserState:()=>_t},extraReducers:s=>{s.addCase(Os.pending,t=>{t.loading=!0,t.error=null}).addCase(Os.fulfilled,(t,a)=>{t.loading=!1,t.userInfo=a.payload,t.error=null}).addCase(Os.rejected,(t,a)=>{if(t.loading=!1,t.error=a.error.message||"Failed to fetch user info",!t.token)return _t})}}),{setToken:xo,resetUserState:mo}=In.actions,uo=s=>s.user.userInfo,ho=In.reducer,zn=al({reducer:{user:ho}});$s()?.value&&zn.dispatch(Os());const jo=new nl;rl.createRoot(document.getElementById("root")).render(e.jsx(ll.StrictMode,{children:e.jsx(il,{client:jo,children:e.jsx(ol,{store:zn,children:e.jsxs(Ui,{defaultTheme:"light",storageKey:"vite-ui-theme",children:[e.jsx(cl,{router:no}),e.jsx(dl,{richColors:!0,position:"top-right"})]})})})}));const ze=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("rounded-xl border bg-card text-card-foreground shadow",s),...t}));ze.displayName="Card";const Ke=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex flex-col space-y-1.5 p-6",s),...t}));Ke.displayName="CardHeader";const os=o.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:f("font-semibold leading-none tracking-tight",s),...t}));os.displayName="CardTitle";const Rn=o.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:f("text-sm text-muted-foreground",s),...t}));Rn.displayName="CardDescription";const Ge=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("p-6 pt-0",s),...t}));Ge.displayName="CardContent";const go=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex items-center p-6 pt-0",s),...t}));go.displayName="CardFooter";const fo=ps("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),En=o.forwardRef(({className:s,...t},a)=>e.jsx(Da,{ref:a,className:f(fo(),s),...t}));En.displayName=Da.displayName;const ee=xl,Mn=o.createContext({}),j=({...s})=>e.jsx(Mn.Provider,{value:{name:s.name},children:e.jsx(ml,{...s})}),gt=()=>{const s=o.useContext(Mn),t=o.useContext(On),{getFieldState:a,formState:n}=ul(),r=a(s.name,n);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:l}=t;return{id:l,name:s.name,formItemId:`${l}-form-item`,formDescriptionId:`${l}-form-item-description`,formMessageId:`${l}-form-item-message`,...r}},On=o.createContext({}),h=o.forwardRef(({className:s,...t},a)=>{const n=o.useId();return e.jsx(On.Provider,{value:{id:n},children:e.jsx("div",{ref:a,className:f("space-y-2",s),...t})})});h.displayName="FormItem";const g=o.forwardRef(({className:s,...t},a)=>{const{error:n,formItemId:r}=gt();return e.jsx(En,{ref:a,className:f(n&&"text-destructive",s),htmlFor:r,...t})});g.displayName="FormLabel";const v=o.forwardRef(({...s},t)=>{const{error:a,formItemId:n,formDescriptionId:r,formMessageId:l}=gt();return e.jsx(Kt,{ref:t,id:n,"aria-describedby":a?`${r} ${l}`:`${r}`,"aria-invalid":!!a,...s})});v.displayName="FormControl";const P=o.forwardRef(({className:s,...t},a)=>{const{formDescriptionId:n}=gt();return e.jsx("p",{ref:a,id:n,className:f("text-[0.8rem] text-muted-foreground",s),...t})});P.displayName="FormDescription";const S=o.forwardRef(({className:s,children:t,...a},n)=>{const{error:r,formMessageId:l}=gt(),c=r?String(r?.message):t;return c?e.jsx("p",{ref:n,id:l,className:f("text-[0.8rem] font-medium text-destructive",s),...a,children:c}):null});S.displayName="FormMessage";const C=o.forwardRef(({className:s,type:t,...a},n)=>e.jsx("input",{type:t,className:f("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...a}));C.displayName="Input";const Ln=o.forwardRef(({className:s,...t},a)=>{const[n,r]=o.useState(!1);return e.jsxs("div",{className:"relative rounded-md",children:[e.jsx("input",{type:n?"text":"password",className:f("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}),e.jsx(k,{type:"button",size:"icon",variant:"ghost",className:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2 rounded-md text-muted-foreground",onClick:()=>r(l=>!l),children:n?e.jsx(hl,{size:18}):e.jsx(jl,{size:18})})]})});Ln.displayName="PasswordInput";const po=s=>I({url:"/passport/auth/login",method:"post",data:s}),Lt=s=>s;function X(s=void 0,t="YYYY-MM-DD HH:mm:ss"){return s==null?"":(Math.floor(s).toString().length===10&&(s=s*1e3),gl(s).format(t))}function vo(s=void 0,t="YYYY-MM-DD"){return X(s,t)}function _s(s){const t=typeof s=="string"?parseFloat(s):s;return isNaN(t)?"0.00":t.toFixed(2)}function Es(s){const t=typeof s=="string"?parseFloat(s):s;return isNaN(t)?"0.00":(t/100).toFixed(2)}function tt(s){navigator.clipboard?navigator.clipboard.writeText(s).then(()=>{z.success(Lt("复制成功"))}).catch(t=>{console.error("复制到剪贴板时出错:",t),pa(s)}):pa(s)}function pa(s){const t=document.createElement("button"),a=new fl(t,{text:()=>s});a.on("success",()=>{z.success(Lt("复制成功")),a.destroy()}),a.on("error",()=>{z.error(Lt("复制失败")),a.destroy()}),t.click()}function ks(s){const t=s/1024,a=t/1024,n=a/1024,r=n/1024;return r>=1?_s(r)+" TB":n>=1?_s(n)+" GB":a>=1?_s(a)+" MB":_s(t)+" KB"}const bo="access_token";function yo(s){jt.set(bo,s)}const No=i.object({email:i.string().min(1,{message:"请输入邮箱地址"}).email({message:"邮箱地址格式不正确"}),password:i.string().min(1,{message:"请输入密码"}).min(7,{message:"密码长度至少为7个字符"})});function wo({className:s,onForgotPassword:t,...a}){const n=We(),r=Ta(),l=Z({resolver:Q(No),defaultValues:{email:"",password:""}});async function c(x){try{const{data:u}=await po(x);u&&(yo(u.auth_data),r(xo(u.auth_data)),await r(Os()).unwrap(),n("/"))}catch(u){const b=u instanceof Error?u.message:"登录失败";z.error(b)}}return e.jsx("div",{className:f("grid gap-6",s),...a,children:e.jsx(ee,{...l,children:e.jsx("form",{onSubmit:l.handleSubmit(c),children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{control:l.control,name:"email",render:({field:x})=>e.jsxs(h,{className:"space-y-1",children:[e.jsx(g,{children:"邮箱地址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"name@example.com",...x})}),e.jsx(S,{})]})}),e.jsx(j,{control:l.control,name:"password",render:({field:x})=>e.jsxs(h,{className:"space-y-1",children:[e.jsx(g,{children:"密码"}),e.jsx(v,{children:e.jsx(Ln,{placeholder:"请输入密码",...x})}),e.jsx(S,{})]})}),e.jsx(k,{className:"mt-2",loading:l.formState.isSubmitting,children:"登录"}),e.jsx(k,{variant:"link",type:"button",className:"mt-1 text-sm text-muted-foreground hover:text-primary",onClick:t,children:"忘记密码？"})]})})})})}const de=Fa,Se=Pa,_o=Va,Gs=Ut,$n=o.forwardRef(({className:s,...t},a)=>e.jsx(ct,{ref:a,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));$n.displayName=ct.displayName;const re=o.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(_o,{children:[e.jsx($n,{}),e.jsxs(dt,{ref:n,className:f("max-h-[95%] overflow-auto fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Ut,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));re.displayName=dt.displayName;const he=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});he.displayName="DialogHeader";const ke=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});ke.displayName="DialogFooter";const xe=o.forwardRef(({className:s,...t},a)=>e.jsx(xt,{ref:a,className:f("text-lg font-semibold leading-none tracking-tight",s),...t}));xe.displayName=xt.displayName;const Ve=o.forwardRef(({className:s,...t},a)=>e.jsx(mt,{ref:a,className:f("text-sm text-muted-foreground",s),...t}));Ve.displayName=mt.displayName;const Ts=ps("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),A=o.forwardRef(({className:s,variant:t,size:a,asChild:n=!1,...r},l)=>{const c=n?Kt:"button";return e.jsx(c,{className:f(Ts({variant:t,size:a,className:s})),ref:l,...r})});A.displayName="Button";function Co(){const[s,t]=o.useState(!1),a=async r=>{try{await navigator.clipboard.writeText(r),z.success("命令已复制到剪贴板")}catch{z.error("复制失败，请手动复制")}},n="php artisan reset:password 管理员邮箱";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container grid h-svh flex-col items-center justify-center bg-primary-foreground lg:max-w-none lg:px-0",children:e.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-2 sm:w-[480px] lg:p-8",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",children:e.jsx("h1",{className:"text-3xl font-medium",children:window?.settings?.title})}),e.jsxs(ze,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-left",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"登录"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"请输入您的邮箱和密码登录系统"})]}),e.jsx(wo,{onForgotPassword:()=>t(!0)})]})]})}),e.jsx(de,{open:s,onOpenChange:t,children:e.jsx(re,{children:e.jsxs(he,{children:[e.jsx(xe,{children:"忘记密码"}),e.jsx(Ve,{children:"在站点目录下执行以下命令找回密码"}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"rounded-md bg-secondary p-4 pr-12",children:n}),e.jsx(A,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 h-8 w-8 hover:bg-secondary-foreground/10",onClick:()=>a(n),children:e.jsx(pl,{className:"h-4 w-4"})})]})})]})})})]})}const So=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),ge=o.forwardRef(({className:s,fadedBelow:t=!1,fixedHeight:a=!1,...n},r)=>e.jsx("div",{ref:r,className:f("relative flex h-full w-full flex-col",t&&"after:pointer-events-none after:absolute after:bottom-0 after:left-0 after:hidden after:h-32 after:w-full after:bg-[linear-gradient(180deg,_transparent_10%,_hsl(var(--background))_70%)] after:md:block",a&&"md:h-svh",s),...n}));ge.displayName="Layout";const fe=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex h-[var(--header-height)] flex-none items-center gap-4 bg-background p-4 md:px-8",s),...t}));fe.displayName="LayoutHeader";const be=o.forwardRef(({className:s,fixedHeight:t,...a},n)=>e.jsx("div",{ref:n,className:f("flex-1 overflow-hidden px-4 py-6 md:px-8",t&&"h-[calc(100%-var(--header-height))]",s),...a}));be.displayName="LayoutBody";const An=vl,Hn=bl,Kn=yl,gs=_l,fs=Cl,ko=Sl,Do=o.forwardRef(({className:s,inset:t,children:a,...n},r)=>e.jsxs(Ia,{ref:r,className:f("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...n,children:[a,e.jsx(qt,{className:"ml-auto h-4 w-4"})]}));Do.displayName=Ia.displayName;const To=o.forwardRef(({className:s,...t},a)=>e.jsx(za,{ref:a,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));To.displayName=za.displayName;const cs=o.forwardRef(({className:s,sideOffset:t=4,...a},n)=>e.jsx(Nl,{children:e.jsx(Ra,{ref:n,sideOffset:t,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));cs.displayName=Ra.displayName;const ae=o.forwardRef(({className:s,inset:t,...a},n)=>e.jsx(Ea,{ref:n,className:f("relative flex cursor-default cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));ae.displayName=Ea.displayName;const Fo=o.forwardRef(({className:s,children:t,checked:a,...n},r)=>e.jsxs(Ma,{ref:r,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Oa,{children:e.jsx(ds,{className:"h-4 w-4"})})}),t]}));Fo.displayName=Ma.displayName;const Po=o.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(La,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Oa,{children:e.jsx(wl,{className:"h-4 w-4 fill-current"})})}),t]}));Po.displayName=La.displayName;const Bt=o.forwardRef(({className:s,inset:t,...a},n)=>e.jsx($a,{ref:n,className:f("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));Bt.displayName=$a.displayName;const As=o.forwardRef(({className:s,...t},a)=>e.jsx(Aa,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",s),...t}));As.displayName=Aa.displayName;const $t=({className:s,...t})=>e.jsx("span",{className:f("ml-auto text-xs tracking-widest opacity-60",s),...t});$t.displayName="DropdownMenuShortcut";const ue=kl,oe=Dl,ce=Tl,ne=o.forwardRef(({className:s,sideOffset:t=4,...a},n)=>e.jsx(Ha,{ref:n,sideOffset:t,className:f("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));ne.displayName=Ha.displayName;function ft(){const{pathname:s}=ot();return{checkActiveNav:a=>{if(a==="/"&&s==="/")return!0;const n=a.replace(/^\//,""),r=s.replace(/^\//,"");return n?r.startsWith(n):!1}}}function Gn({key:s,defaultValue:t}){const[a,n]=o.useState(()=>{const r=localStorage.getItem(s);return r!==null?JSON.parse(r):t});return o.useEffect(()=>{localStorage.setItem(s,JSON.stringify(a))},[a,s]),[a,n]}function Vo(){const[s,t]=Gn({key:"expanded-sidebar-items",defaultValue:["仪表盘","系统管理","节点管理","订阅管理","用户管理"]});return{expandedItems:s,toggleItem:n=>{t(r=>r.includes(n)?r.filter(l=>l!==n):[...r,n])},isExpanded:n=>s.includes(n)}}function Io({links:s,isCollapsed:t,className:a,closeNav:n}){const r=({sub:l,...c})=>{const x=`${c.title}-${c.href}`;return t&&l?o.createElement(Eo,{...c,sub:l,key:x,closeNav:n}):t?o.createElement(Ro,{...c,key:x,closeNav:n}):l?o.createElement(zo,{...c,sub:l,key:x,closeNav:n}):o.createElement(Un,{...c,key:x,closeNav:n})};return e.jsx("div",{"data-collapsed":t,className:f("group border-b bg-background py-2 transition-[max-height,padding] duration-500 data-[collapsed=true]:py-2 md:border-none",a),children:e.jsx(ue,{delayDuration:0,children:e.jsx("nav",{className:"grid gap-1 group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:s.map(r)})})})}function Un({title:s,icon:t,label:a,href:n,closeNav:r,subLink:l=!1}){const{checkActiveNav:c}=ft();return e.jsxs(vs,{to:n,onClick:r,className:f(De({variant:c(n)?"secondary":"ghost",size:"sm"}),"h-12 justify-start text-wrap rounded-none px-6",l&&"h-10 w-full border-l border-l-slate-500 px-2"),"aria-current":c(n)?"page":void 0,children:[e.jsx("div",{className:"mr-2",children:t}),s,a&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:a})]})}function zo({title:s,icon:t,label:a,sub:n,closeNav:r}){const{checkActiveNav:l}=ft(),{isExpanded:c,toggleItem:x}=Vo(),u=!!n?.find(p=>l(p.href)),b=c(s)||u;return e.jsxs(An,{open:b,onOpenChange:()=>x(s),children:[e.jsxs(Hn,{className:f(De({variant:"ghost",size:"sm"}),"group h-12 w-full justify-start rounded-none px-6"),children:[e.jsx("div",{className:"mr-2",children:t}),s,a&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:a}),e.jsx("span",{className:f('ml-auto transition-all group-data-[state="open"]:-rotate-180'),children:e.jsx(Ka,{stroke:1})})]}),e.jsx(Kn,{className:"collapsibleDropdown",asChild:!0,children:e.jsx("ul",{children:n.map(p=>e.jsx("li",{className:"my-1 ml-8",children:e.jsx(Un,{...p,subLink:!0,closeNav:r})},p.title))})})]})}function Ro({title:s,icon:t,label:a,href:n}){const{checkActiveNav:r}=ft();return e.jsxs(oe,{delayDuration:0,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(vs,{to:n,className:f(De({variant:r(n)?"secondary":"ghost",size:"icon"}),"h-12 w-12"),children:[t,e.jsx("span",{className:"sr-only",children:s})]})}),e.jsxs(ne,{side:"right",className:"flex items-center gap-4",children:[s,a&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:a})]})]})}function Eo({title:s,icon:t,label:a,sub:n}){const{checkActiveNav:r}=ft(),l=!!n?.find(c=>r(c.href));return e.jsxs(gs,{children:[e.jsxs(oe,{delayDuration:0,children:[e.jsx(ce,{asChild:!0,children:e.jsx(fs,{asChild:!0,children:e.jsx(k,{variant:l?"secondary":"ghost",size:"icon",className:"h-12 w-12",children:t})})}),e.jsxs(ne,{side:"right",className:"flex items-center gap-4",children:[s," ",a&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:a}),e.jsx(Ka,{size:18,className:"-rotate-90 text-muted-foreground"})]})]}),e.jsxs(cs,{side:"right",align:"start",sideOffset:4,children:[e.jsxs(Bt,{children:[s," ",a?`(${a})`:""]}),e.jsx(As,{}),n.map(({title:c,icon:x,label:u,href:b})=>e.jsx(ae,{asChild:!0,children:e.jsxs(vs,{to:b,className:`${r(b)?"bg-secondary":""}`,children:[x," ",e.jsx("span",{className:"ml-2 max-w-52 text-wrap",children:c}),u&&e.jsx("span",{className:"ml-auto text-xs",children:u})]})},`${c}-${b}`))]})]})}const qn=[{title:"仪表盘",label:"",href:"/",icon:e.jsx(Fl,{size:18})},{title:"系统管理",label:"",href:"",icon:e.jsx(Pl,{size:18}),sub:[{title:"系统配置",label:"",href:"/config/system",icon:e.jsx(Ga,{size:18})},{title:"主题配置",label:"",href:"/config/theme",icon:e.jsx(Vl,{size:18})},{title:"公告管理",label:"",href:"/config/notice",icon:e.jsx(Il,{size:18})},{title:"支付配置",label:"",href:"/config/payment",icon:e.jsx(la,{size:18})},{title:"知识库管理",label:"",href:"/config/knowledge",icon:e.jsx(zl,{size:18})}]},{title:"节点管理",label:"",href:"",icon:e.jsx(Ua,{size:18}),sub:[{title:"节点管理",label:"",href:"/server/manage",icon:e.jsx(Rl,{size:18})},{title:"权限组管理",label:"",href:"/server/group",icon:e.jsx(qa,{size:18})},{title:"路由管理",label:"",href:"/server/route",icon:e.jsx(El,{size:18})}]},{title:"订阅管理",label:"",href:"",icon:e.jsx(Ml,{size:18}),sub:[{title:"套餐管理",label:"",href:"/finance/plan",icon:e.jsx(Ol,{size:18})},{title:"订单管理",label:"",href:"/finance/order",icon:e.jsx(la,{size:18})},{title:"优惠券管理",label:"",href:"/finance/coupon",icon:e.jsx(Ll,{size:18})}]},{title:"用户管理",label:"",href:"",icon:e.jsx($l,{size:18}),sub:[{title:"用户管理",label:"",href:"/user/manage",icon:e.jsx(Al,{size:18})},{title:"工单管理",label:"",href:"/user/ticket",icon:e.jsx(Ba,{size:18})}]}];function Mo({className:s,isCollapsed:t,setIsCollapsed:a}){const[n,r]=o.useState(!1);return o.useEffect(()=>{n?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")},[n]),e.jsxs("aside",{className:f(`fixed left-0 right-0 top-0 z-50 w-full border-r-2 border-r-muted transition-[width] md:bottom-0 md:right-auto md:h-svh ${t?"md:w-14":"md:w-64"}`,s),children:[e.jsx("div",{onClick:()=>r(!1),className:`absolute inset-0 transition-[opacity] delay-100 duration-700 ${n?"h-svh opacity-50":"h-0 opacity-0"} w-full bg-black md:hidden`}),e.jsxs(ge,{children:[e.jsxs(fe,{className:"sticky top-0 justify-between px-4 py-3 shadow md:px-4",children:[e.jsxs("div",{className:`flex items-center ${t?"":"gap-2"}`,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",className:`transition-all ${t?"h-6 w-6":"h-8 w-8"}`,children:[e.jsx("rect",{width:"256",height:"256",fill:"none"}),e.jsx("line",{x1:"208",y1:"128",x2:"128",y2:"208",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("line",{x1:"192",y1:"40",x2:"40",y2:"192",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("span",{className:"sr-only",children:"Website Name"})]}),e.jsx("div",{className:`flex flex-col justify-end truncate ${t?"invisible w-0":"visible w-auto"}`,children:e.jsx("span",{className:"font-medium",children:window?.settings?.title})})]}),e.jsx(k,{variant:"ghost",size:"icon",className:"md:hidden","aria-label":"Toggle Navigation","aria-controls":"sidebar-menu","aria-expanded":n,onClick:()=>r(l=>!l),children:n?e.jsx(Hl,{}):e.jsx(Kl,{})})]}),e.jsx(Io,{id:"sidebar-menu",className:`h-full flex-1 overflow-auto ${n?"max-h-screen":"max-h-0 py-0 md:max-h-screen md:py-2"}`,closeNav:()=>r(!1),isCollapsed:t,links:qn}),e.jsx(k,{onClick:()=>a(l=>!l),size:"icon",variant:"outline",className:"absolute -right-5 top-1/2 hidden rounded-full md:inline-flex",children:e.jsx(Gl,{stroke:1.5,className:`h-5 w-5 ${t?"rotate-180":""}`})})]})]})}function Oo(){const[s,t]=Gn({key:"collapsed-sidebar",defaultValue:!1});return o.useEffect(()=>{const a=()=>{t(window.innerWidth<768?!1:s)};return a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[s,t]),[s,t]}function Lo(){const[s,t]=Oo();return e.jsxs("div",{className:"relative h-full overflow-hidden bg-background",children:[e.jsx(Mo,{isCollapsed:s,setIsCollapsed:t}),e.jsx("main",{id:"content",className:`overflow-x-hidden pt-16 transition-[margin] md:overflow-y-hidden md:pt-0 ${s?"md:ml-14":"md:ml-64"} h-full`,children:e.jsx(Gt,{})})]})}const $o=Object.freeze(Object.defineProperty({__proto__:null,default:Lo},Symbol.toStringTag,{value:"Module"})),Qe=o.forwardRef(({className:s,...t},a)=>e.jsx(ve,{ref:a,className:f("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...t}));Qe.displayName=ve.displayName;const Ao=({children:s,...t})=>e.jsx(de,{...t,children:e.jsx(re,{className:"overflow-hidden p-0",children:e.jsx(Qe,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:s})})}),xs=o.forwardRef(({className:s,...t},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Ul,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(ve.Input,{ref:a,className:f("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...t})]}));xs.displayName=ve.Input.displayName;const es=o.forwardRef(({className:s,...t},a)=>e.jsx(ve.List,{ref:a,className:f("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...t}));es.displayName=ve.List.displayName;const ms=o.forwardRef((s,t)=>e.jsx(ve.Empty,{ref:t,className:"py-6 text-center text-sm",...s}));ms.displayName=ve.Empty.displayName;const pe=o.forwardRef(({className:s,...t},a)=>e.jsx(ve.Group,{ref:a,className:f("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...t}));pe.displayName=ve.Group.displayName;const ys=o.forwardRef(({className:s,...t},a)=>e.jsx(ve.Separator,{ref:a,className:f("-mx-1 h-px bg-border",s),...t}));ys.displayName=ve.Separator.displayName;const ie=o.forwardRef(({className:s,...t},a)=>e.jsx(ve.Item,{ref:a,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t}));ie.displayName=ve.Item.displayName;function Ho(){const s=[];for(const t of qn)if(t.href&&s.push(t),t.sub)for(const a of t.sub)s.push({...a,parent:t.title});return s}function Ne(){const[s,t]=o.useState(!1),a=We(),n=Ho();o.useEffect(()=>{const l=c=>{c.key==="k"&&(c.metaKey||c.ctrlKey)&&(c.preventDefault(),t(x=>!x))};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[]);const r=o.useCallback(l=>{t(!1),a(l)},[a]);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",className:"relative h-9 w-9 p-0 xl:h-10 xl:w-60 xl:justify-start xl:px-3 xl:py-2",onClick:()=>t(!0),children:[e.jsx(ql,{className:"h-4 w-4 xl:mr-2"}),e.jsx("span",{className:"hidden xl:inline-flex",children:"搜索..."}),e.jsx("span",{className:"sr-only",children:"搜索"}),e.jsxs("kbd",{className:"pointer-events-none absolute right-1.5 top-2 hidden h-6 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 xl:flex",children:[e.jsx("span",{className:"text-xs",children:"⌘"}),"K"]})]}),e.jsxs(Ao,{open:s,onOpenChange:t,children:[e.jsx(xs,{placeholder:"搜索所有菜单和功能..."}),e.jsxs(es,{children:[e.jsx(ms,{children:"未找到相关结果"}),e.jsx(pe,{heading:"菜单导航",children:n.map(l=>e.jsxs(ie,{value:`${l.parent?l.parent+" ":""}${l.title}`,onSelect:()=>r(l.href),children:[e.jsx("div",{className:"mr-2",children:l.icon}),e.jsx("span",{children:l.title}),l.parent&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:l.parent})]},l.href))})]})]})]})}function we(){const{theme:s,setTheme:t}=qi();return o.useEffect(()=>{const a=s==="dark"?"#020817":"#fff",n=document.querySelector("meta[name='theme-color']");n&&n.setAttribute("content",a)},[s]),e.jsx(k,{size:"icon",variant:"ghost",className:"rounded-full",onClick:()=>t(s==="light"?"dark":"light"),children:s==="light"?e.jsx(Bl,{size:20}):e.jsx(Yl,{size:20})})}const Bn=o.forwardRef(({className:s,...t},a)=>e.jsx(Ya,{ref:a,className:f("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));Bn.displayName=Ya.displayName;const Yn=o.forwardRef(({className:s,...t},a)=>e.jsx(Wa,{ref:a,className:f("aspect-square h-full w-full",s),...t}));Yn.displayName=Wa.displayName;const Wn=o.forwardRef(({className:s,...t},a)=>e.jsx(Ja,{ref:a,className:f("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));Wn.displayName=Ja.displayName;function _e(){const s=We(),t=Ta(),a=Wl(uo),n=()=>{Pn(),t(mo()),s("/sign-in")},r=a?.email?.split("@")[0]||"User",l=r.substring(0,2).toUpperCase();return e.jsxs(gs,{children:[e.jsx(fs,{asChild:!0,children:e.jsx(k,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:e.jsxs(Bn,{className:"h-8 w-8",children:[e.jsx(Yn,{src:a?.avatar_url,alt:r}),e.jsx(Wn,{children:l})]})})}),e.jsxs(cs,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(Bt,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:r}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:a?.email||"user@example.com"})]})}),e.jsx(As,{}),e.jsx(ae,{asChild:!0,children:e.jsxs(vs,{to:"/config/system",children:["设置",e.jsx($t,{children:"⌘S"})]})}),e.jsx(As,{}),e.jsxs(ae,{onClick:n,children:["退出登录",e.jsx($t,{children:"⇧⌘Q"})]})]})]})}const R=window?.settings?.secure_path,Ko=()=>I.get(R+"/stat/getOrder"),Go=()=>I.get(R+"/stat/getStats"),va=s=>I.get(R+"/stat/getTrafficRank",{params:s}),Uo=()=>I.get(R+"/theme/getThemes"),qo=s=>I.post(R+"/theme/getThemeConfig",{name:s}),Bo=(s,t)=>I.post(R+"/theme/saveThemeConfig",{name:s,config:t}),Yo=s=>{const t=new FormData;return t.append("file",s),I.post(R+"/theme/upload",t,{headers:{"Content-Type":"multipart/form-data"}})},Wo=s=>I.post(R+"/theme/delete",{name:s}),Jo=s=>I.post(R+"/config/save",s),Jn=()=>I.get(R+"/server/manage/getNodes"),Zo=s=>I.post(R+"/server/manage/save",s),Xo=s=>I.post(R+"/server/manage/drop",s),Qo=s=>I.post(R+"/server/manage/copy",s),ec=s=>I.post(R+"/server/manage/update",s),sc=s=>I.post(R+"/server/manage/sort",s),pt=()=>I.get(R+"/server/group/fetch"),tc=s=>I.post(R+"/server/group/save",s),ac=s=>I.post(R+"/server/group/drop",s),Zn=()=>I.get(R+"/server/route/fetch"),nc=s=>I.post(R+"/server/route/save",s),rc=s=>I.post(R+"/server/route/drop",s),lc=()=>I.get(R+"/payment/fetch"),ic=()=>I.get(R+"/payment/getPaymentMethods"),oc=s=>I.post(R+"/payment/getPaymentForm",s),cc=s=>I.post(R+"/payment/save",s),dc=s=>I.post(R+"/payment/drop",s),xc=s=>I.post(R+"/payment/show",s),mc=s=>I.post(R+"/payment/sort",s),uc=()=>I.get(R+"/notice/fetch"),hc=s=>I.post(R+"/notice/save",s),jc=s=>I.post(R+"/notice/drop",s),gc=s=>I.post(R+"/notice/show",s),fc=()=>I.get(R+"/knowledge/fetch"),pc=s=>I.get(R+"/knowledge/fetch?id="+s),vc=s=>I.post(R+"/knowledge/save",s),bc=s=>I.post(R+"/knowledge/drop",s),yc=s=>I.post(R+"/knowledge/show",s),Nc=s=>I.post(R+"/knowledge/sort",s),Ps=()=>I.get(R+"/plan/fetch"),wc=s=>I.post(R+"/plan/save",s),Ct=s=>I.post(R+"/plan/update",s),_c=s=>I.post(R+"/plan/drop",s),Cc=s=>I.post(R+"/plan/sort",{ids:s}),Xn=async s=>I.post(R+"/order/fetch",s),Sc=s=>I.post(R+"/order/detail",s),kc=s=>I.post(R+"/order/paid",s),Dc=s=>I.post(R+"/order/cancel",s),ba=s=>I.post(R+"/order/update",s),Tc=s=>I.post(R+"/order/assign",s),Fc=s=>I.post(R+"/coupon/fetch",s),Pc=s=>I.post(R+"/coupon/generate",s),Vc=s=>I.post(R+"/coupon/drop",s),Ic=s=>I.post(R+"/coupon/update",s),zc=s=>I.post(R+"/user/fetch",s),Rc=s=>I.post(R+"/user/update",s),Ec=s=>I.post(R+"/user/resetSecret",s),Mc=s=>I.post(R+"/user/generate",s),Oc=s=>I.post(R+"/stat/getStatUser",s),Qn=s=>I.post(R+"/ticket/fetch",s),Lc=s=>I.get(R+"/ticket/fetch?id= "+s),$c=s=>I.post(R+"/ticket/reply",s),er=s=>I.post(R+"/ticket/close",{id:s}),ss=(s="")=>I.get(R+"/config/fetch?key="+s),ts=s=>I.post(R+"/config/save",s),Ac=()=>I.get(R+"/config/getEmailTemplate"),Hc=()=>I.post(R+"/config/testSendMail"),Kc=()=>I.post(R+"/config/setTelegramWebhook"),ns={income:{main:"hsl(var(--primary))",gradient:{start:"hsl(var(--primary))",end:"hsl(var(--primary))"}},commission:{main:"hsl(280, 65%, 50%)",gradient:{start:"hsl(280, 65%, 50%)",end:"hsl(280, 65%, 50%)"}},income_count:"hsl(217, 91%, 60%)",commission_count:"hsl(262, 83%, 58%)"};function Gc(s){const t=new Map;return s.forEach(a=>{t.has(a.date)||t.set(a.date,{date:a.date,income:0,income_count:0,commission:0,commission_count:0});const n=t.get(a.date);switch(a.type){case"收款金额":n.income=a.value;break;case"收款笔数":n.income_count=a.value;break;case"佣金金额(已发放)":n.commission=a.value;break;case"佣金笔数(已发放)":n.commission_count=a.value;break}}),Array.from(t.values()).sort((a,n)=>a.date.localeCompare(n.date))}function Uc(){const[s,t]=o.useState([]);return o.useEffect(()=>{async function a(){const{data:n}=await Ko();t(Gc(n))}a()},[]),e.jsxs(ze,{children:[e.jsx(Ke,{children:e.jsx(os,{children:"收入趋势"})}),e.jsx(Ge,{children:e.jsx("div",{className:"h-[400px] w-full pt-4",children:e.jsx(Ft,{width:"100%",height:"100%",children:e.jsxs(Jl,{data:s,margin:{top:20,right:30,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"incomeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:ns.income.gradient.start,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:ns.income.gradient.end,stopOpacity:.05})]}),e.jsxs("linearGradient",{id:"commissionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:ns.commission.gradient.start,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:ns.commission.gradient.end,stopOpacity:.05})]})]}),e.jsx(Pt,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},dy:10}),e.jsx(at,{yAxisId:"left",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:a=>`¥${(a/100).toFixed(2)}`}),e.jsx(at,{yAxisId:"right",orientation:"right",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:a=>`${a}笔`}),e.jsx(Vt,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))",opacity:.3}),e.jsx(It,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",fontSize:"12px",padding:"8px 12px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},formatter:(a,n)=>n.includes("金额")?[`¥${(a/100).toFixed(2)}`,n]:[`${a}笔`,n],labelStyle:{color:"hsl(var(--foreground))"},cursor:{stroke:"hsl(var(--muted))"}}),e.jsx(Zl,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,wrapperStyle:{paddingBottom:"12px"}}),e.jsx(ia,{yAxisId:"left",type:"monotone",dataKey:"income",name:"收款金额",stroke:ns.income.main,strokeWidth:2,fillOpacity:1,fill:"url(#incomeGradient)"}),e.jsx(ia,{yAxisId:"left",type:"monotone",dataKey:"commission",name:"佣金金额",stroke:ns.commission.main,strokeWidth:2,fillOpacity:1,fill:"url(#commissionGradient)"}),e.jsx(oa,{yAxisId:"right",type:"monotone",dataKey:"income_count",name:"收款笔数",stroke:ns.income_count,strokeWidth:3,dot:!1}),e.jsx(oa,{yAxisId:"right",type:"monotone",dataKey:"commission_count",name:"佣金笔数",stroke:ns.commission_count,strokeWidth:3,dot:!1})]})})})})]})}var te=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.CANCELLED=2]="CANCELLED",s[s.COMPLETED=3]="COMPLETED",s[s.DISCOUNTED=4]="DISCOUNTED",s))(te||{});const ws={0:"待支付",1:"开通中",2:"已取消",3:"已完成",4:"已折抵"},Ms={0:"yellow-500",1:"blue-500",2:"red-500",3:"green-500",4:"green-500"},qc={1:"新购",2:"续费",3:"升级",5:"流量重置"};var le=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.VALID=2]="VALID",s[s.INVALID=3]="INVALID",s))(le||{});const Ys={0:"待确认",1:"发放中",2:"有效",3:"无效"},Ws={0:"yellow-500",1:"blue-500",2:"green-500",3:"red-500"};var Cs=(s=>(s.MONTH_PRICE="month_price",s.QUARTER_PRICE="quarter_price",s.HALF_YEAR_PRICE="half_year_price",s.YEAR_PRICE="year_price",s.TWO_YEAR_PRICE="two_year_price",s.THREE_YEAR_PRICE="three_year_price",s.ONETIME_PRICE="onetime_price",s.RESET_PRICE="reset_price",s))(Cs||{});const it={month_price:"月付",quarter_price:"季付",half_year_price:"半年付",year_price:"年付",two_year_price:"两年付",three_year_price:"三年付",onetime_price:"一次性",reset_price:"流量重置包"};var me=(s=>(s.Shadowsocks="shadowsocks",s.Vmess="vmess",s.Trojan="trojan",s.Hysteria="hysteria",s.Vless="vless",s))(me||{});const js=[{type:"shadowsocks",label:"Shadowsocks"},{type:"vmess",label:"VMess"},{type:"trojan",label:"Trojan"},{type:"hysteria",label:"Hysteria"},{type:"vless",label:"VLess"}],ls={shadowsocks:"#489851",vmess:"#CB3180",trojan:"#EBB749",hysteria:"#5684e6",vless:"#1a1a1a"};var vt=(s=>(s[s.AMOUNT=1]="AMOUNT",s[s.PERCENTAGE=2]="PERCENTAGE",s))(vt||{});const Yt={1:"按金额优惠",2:"按比例优惠"},Bc={0:"正常",1:"锁定"};var Ss=(s=>(s[s.OPENING=0]="OPENING",s[s.CLOSED=1]="CLOSED",s))(Ss||{});const Yc={0:"开启",1:"已关闭"};var Be=(s=>(s[s.LOW=0]="LOW",s[s.MIDDLE=1]="MIDDLE",s[s.HIGH=2]="HIGH",s))(Be||{});const Ls={0:"低",1:"中",2:"高"};function Wc(){const s=We(),{data:t}=G({queryKey:["pendingTickets"],queryFn:()=>Qn({filter:[{id:"status",value:0}]}),staleTime:1e3*30,refetchInterval:1e3*30}),{data:a}=G({queryKey:["pendingCommissions"],queryFn:()=>Xn({filter:[{id:"commission_status",value:le.PENDING},{id:"status",value:te.COMPLETED}]}),staleTime:1e3*30,refetchInterval:1e3*30}),n=t?.data||[],r=a?.data||[],l=()=>{s("/finance/order",{state:{filters:[{id:"commission_status",value:le.PENDING},{id:"status",value:te.COMPLETED}]}})};return e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(ze,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${n.length>0?"border-orange-500/50":""}`,onClick:()=>s("/user/ticket"),children:[e.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(os,{className:"text-sm font-medium",children:"待处理工单"}),e.jsx(Xl,{className:`h-4 w-4 ${n.length>0?"text-orange-500":"text-muted-foreground"}`})]}),e.jsxs(Ge,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.length>0?"有待处理的工单需要关注":"暂无待处理工单"})]})]}),e.jsxs(ze,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${r.length>0?"border-blue-500/50":""}`,onClick:l,children:[e.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(os,{className:"text-sm font-medium",children:"待处理佣金"}),e.jsx(Ql,{className:`h-4 w-4 ${r.length>0?"text-blue-500":"text-muted-foreground"}`})]}),e.jsxs(Ge,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.length>0?"有待处理的佣金需要确认":"暂无待处理佣金"})]})]})]})}function Te({className:s,...t}){return e.jsx("div",{className:f("animate-pulse rounded-md bg-primary/10",s),...t})}function Jc(){return e.jsxs(ze,{children:[e.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Te,{className:"h-4 w-[100px]"}),e.jsx(Te,{className:"h-4 w-4"})]}),e.jsxs(Ge,{children:[e.jsx(Te,{className:"h-8 w-[120px]"}),e.jsx("div",{className:"flex items-center pt-1",children:e.jsx(Te,{className:"h-4 w-[100px]"})})]})]})}function Zc(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((s,t)=>e.jsx(Jc,{},t))})}function Js({title:s,value:t,icon:a,trend:n,className:r}){return e.jsxs(ze,{className:f("transition-colors hover:border-primary/50",r),children:[e.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(os,{className:"text-sm font-medium",children:s}),a]}),e.jsxs(Ge,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),e.jsxs("div",{className:"flex items-center pt-1",children:[e.jsx(ai,{className:f("h-4 w-4",n.isPositive?"text-emerald-500":"text-red-500")}),e.jsxs("span",{className:f("ml-1 text-xs",n.isPositive?"text-emerald-500":"text-red-500"),children:[n.isPositive?"+":"-",Math.abs(n.value),"%"]}),e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:n.label})]})]})]})}function Xc({className:s}){const{data:t,isLoading:a}=G({queryKey:["dashboardStats"],queryFn:async()=>(await Go()).data,refetchInterval:3e5});return a||!t?e.jsx(Zc,{}):e.jsxs("div",{className:f("grid gap-4 md:grid-cols-2 lg:grid-cols-4",s),children:[e.jsx(Js,{title:"本月收入",value:`¥${t.currentMonthIncome/100}`,icon:e.jsx(ei,{className:"h-4 w-4 text-emerald-500"}),trend:{value:t.monthIncomeGrowth,label:"vs 上月",isPositive:t.monthIncomeGrowth>0}}),e.jsx(Js,{title:"上月收入",value:`¥${t.lastMonthIncome/100}`,icon:e.jsx(si,{className:"h-4 w-4 text-muted-foreground"}),trend:{value:t.lastMonthIncomeGrowth,label:"vs 上上月",isPositive:t.lastMonthIncomeGrowth>0}}),e.jsx(Js,{title:"上月佣金支出",value:`¥${t.lastMonthCommissionPayout/100}`,icon:e.jsx(ti,{className:"h-4 w-4 text-destructive"}),trend:{value:t.commissionGrowth,label:"vs 上上月",isPositive:t.commissionGrowth>0}}),e.jsx(Js,{title:"本月新增用户",value:t.currentMonthNewUsers,icon:e.jsx(Za,{className:"h-4 w-4 text-blue-500"}),trend:{value:t.userGrowth,label:"vs 上月",isPositive:t.userGrowth>0}})]})}const B=ni,rs=mi,Y=ri,U=o.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(Xa,{ref:n,className:f("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(li,{asChild:!0,children:e.jsx(Ye,{className:"h-4 w-4 opacity-50"})})]}));U.displayName=Xa.displayName;const sr=o.forwardRef(({className:s,...t},a)=>e.jsx(Qa,{ref:a,className:f("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ii,{className:"h-4 w-4"})}));sr.displayName=Qa.displayName;const tr=o.forwardRef(({className:s,...t},a)=>e.jsx(en,{ref:a,className:f("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Ye,{className:"h-4 w-4"})}));tr.displayName=en.displayName;const q=o.forwardRef(({className:s,children:t,position:a="popper",...n},r)=>e.jsx(oi,{children:e.jsxs(sn,{ref:r,className:f("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...n,children:[e.jsx(sr,{}),e.jsx(ci,{className:f("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(tr,{})]})}));q.displayName=sn.displayName;const Qc=o.forwardRef(({className:s,...t},a)=>e.jsx(tn,{ref:a,className:f("px-2 py-1.5 text-sm font-semibold",s),...t}));Qc.displayName=tn.displayName;const O=o.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(an,{ref:n,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(di,{children:e.jsx(ds,{className:"h-4 w-4"})})}),e.jsx(xi,{children:t})]}));O.displayName=an.displayName;const ed=o.forwardRef(({className:s,...t},a)=>e.jsx(nn,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",s),...t}));ed.displayName=nn.displayName;function Us({className:s,classNames:t,showOutsideDays:a=!0,...n}){return e.jsx(ui,{showOutsideDays:a,className:f("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:f(Ts({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:f("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",n.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:f(Ts({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({className:r,...l})=>e.jsx(rn,{className:f("h-4 w-4",r),...l}),IconRight:({className:r,...l})=>e.jsx(qt,{className:f("h-4 w-4",r),...l})},...n})}Us.displayName="Calendar";const Ue=ji,qe=gi,Le=o.forwardRef(({className:s,align:t="center",sideOffset:a=4,...n},r)=>e.jsx(hi,{children:e.jsx(ln,{ref:r,align:t,sideOffset:a,className:f("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));Le.displayName=ln.displayName;const At={today:{label:"今天",getValue:()=>({start:pi(),end:new Date})},last7days:{label:"最近7天",getValue:()=>({start:nt(new Date,7),end:new Date})},last30days:{label:"最近30天",getValue:()=>({start:nt(new Date,30),end:new Date})},custom:{label:"自定义范围",getValue:()=>null}};function ya({selectedRange:s,customDateRange:t,onRangeChange:a,onCustomRangeChange:n}){return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(B,{value:s,onValueChange:a,children:[e.jsx(U,{className:"w-[140px]",children:e.jsx(Y,{placeholder:"选择时间范围"})}),e.jsx(q,{position:"popper",className:"z-50",children:Object.entries(At).map(([r,{label:l}])=>e.jsx(O,{value:r,children:l},r))})]}),s==="custom"&&e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:f("justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),t?.from?t.to?e.jsxs(e.Fragment,{children:[wt(t.from,"yyyy-MM-dd")," -"," ",wt(t.to,"yyyy-MM-dd")]}):wt(t.from,"yyyy-MM-dd"):e.jsx("span",{children:"选择日期范围"})]})}),e.jsx(Le,{className:"w-auto p-0",align:"end",children:e.jsx(Us,{initialFocus:!0,mode:"range",defaultMonth:t?.from,selected:{from:t?.from,to:t?.to},onSelect:r=>{r?.from&&r?.to&&n({from:r.from,to:r.to})},numberOfMonths:2})})]})]})}function sd({className:s}){const[t,a]=o.useState("today"),[n,r]=o.useState({from:nt(new Date,7),to:new Date}),[l,c]=o.useState("today"),[x,u]=o.useState({from:nt(new Date,7),to:new Date}),b=o.useMemo(()=>t==="custom"?{start:n.from,end:n.to}:At[t].getValue(),[t,n]),p=o.useMemo(()=>l==="custom"?{start:x.from,end:x.to}:At[l].getValue(),[l,x]),{data:y}=G({queryKey:["nodeTrafficRank",b.start,b.end],queryFn:()=>va({type:"node",start_time:Bs.round(b.start.getTime()/1e3),end_time:Bs.round(b.end.getTime()/1e3)}),refetchInterval:2e3}),{data:_}=G({queryKey:["userTrafficRank",p.start,p.end],queryFn:()=>va({type:"user",start_time:Bs.round(p.start.getTime()/1e3),end_time:Bs.round(p.end.getTime()/1e3)}),refetchInterval:2e3});return e.jsx("div",{className:f("min-h-[400px]",s),children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs(ze,{className:"min-h-[400px] flex-1",children:[e.jsx(Ke,{className:"flex-none",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fi,{className:"mr-2 h-4 w-4"}),"节点流量排行"]})}),e.jsx(ca,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ya,{selectedRange:t,customDateRange:n,onRangeChange:a,onCustomRangeChange:r})})]})}),e.jsx(Ge,{className:"flex-1",children:y?.data?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid min-h-[200px] grid-cols-1 gap-4 md:grid-cols-2",children:y.data.slice(0,4).map(D=>e.jsxs("div",{className:"flex flex-col justify-between rounded-lg bg-muted/50 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium truncate max-w-[70%]",children:D.name}),e.jsxs("span",{className:f("text-xs font-medium",D.change>=0?"text-green-600":"text-red-600"),children:[D.change>=0?e.jsx(zt,{className:"mr-1 inline h-3 w-3"}):e.jsx(Rt,{className:"mr-1 inline h-3 w-3"}),Math.abs(D.change),"%"]})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[D.value,"GB"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["上期：",D.previousValue,"GB"]})]},D.name))}),e.jsx("div",{className:"mt-6 h-[300px] w-full",children:e.jsx(Ft,{width:"100%",height:"100%",children:e.jsxs(da,{data:y.data,margin:{top:10,right:10,left:0,bottom:0},barSize:24,children:[e.jsx(Pt,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},interval:0,angle:-45,textAnchor:"end",height:60,dy:20}),e.jsx(at,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:D=>`${D}GB`}),e.jsx(Vt,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))",opacity:.3}),e.jsx(It,{cursor:{fill:"hsl(var(--muted))",opacity:.1},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",fontSize:"12px",padding:"8px 12px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},formatter:(D,F,T)=>{const m=T.payload;return[`${D}GB`,e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"流量"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["较上期：",e.jsxs("span",{className:f(m.change>=0?"text-green-600":"text-red-600"),children:[m.change>=0?"+":"",m.change,"%"]})]})]})]},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(xa,{dataKey:"value",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:"Loading..."})})})]}),e.jsxs(ze,{className:"min-h-[400px] flex-1",children:[e.jsx(Ke,{className:"flex-none",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Za,{className:"mr-2 h-4 w-4"}),"用户流量排行"]})}),e.jsx(ca,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ya,{selectedRange:l,customDateRange:x,onRangeChange:c,onCustomRangeChange:u})})]})}),e.jsx(Ge,{className:"flex-1",children:_?.data?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid min-h-[200px] grid-cols-1 gap-4 md:grid-cols-2",children:_.data.slice(0,4).map(D=>e.jsxs("div",{className:"flex flex-col justify-between rounded-lg bg-muted/50 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium truncate max-w-[70%]",children:D.name}),e.jsxs("span",{className:f("text-xs font-medium",D.change>=0?"text-green-600":"text-red-600"),children:[D.change>=0?e.jsx(zt,{className:"mr-1 inline h-3 w-3"}):e.jsx(Rt,{className:"mr-1 inline h-3 w-3"}),Math.abs(D.change),"%"]})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[D.value,"GB"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["上期：",D.previousValue,"GB"]})]},D.name))}),e.jsx("div",{className:"mt-6 h-[300px] w-full",children:e.jsx(Ft,{width:"100%",height:"100%",children:e.jsxs(da,{data:_.data,margin:{top:10,right:10,left:0,bottom:0},barSize:24,children:[e.jsx(Pt,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},interval:0,angle:-45,textAnchor:"end",height:60,dy:20}),e.jsx(at,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:D=>`${D}GB`}),e.jsx(Vt,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))",opacity:.3}),e.jsx(It,{cursor:{fill:"hsl(var(--muted))",opacity:.1},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",fontSize:"12px",padding:"8px 12px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},formatter:(D,F,T)=>{const m=T.payload;return[`${D}GB`,e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"流量"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["较上期：",e.jsxs("span",{className:f(m.change>=0?"text-green-600":"text-red-600"),children:[m.change>=0?"+":"",m.change,"%"]})]})]})]},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(xa,{dataKey:"value",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:"Loading..."})})})]})]})})}function td(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"仪表盘"})}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ne,{}),e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b pb-6",children:e.jsx(Wc,{})}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Xc,{}),e.jsx(Uc,{}),e.jsx(sd,{})]})]})})]})}const ad=Object.freeze(Object.defineProperty({__proto__:null,default:td},Symbol.toStringTag,{value:"Module"})),se=o.forwardRef(({className:s,orientation:t="horizontal",decorative:a=!0,...n},r)=>e.jsx(on,{ref:r,decorative:a,orientation:t,className:f("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...n}));se.displayName=on.displayName;function nd({className:s,items:t,...a}){const{pathname:n}=ot(),r=We(),[l,c]=o.useState(n??"/settings"),x=u=>{c(u),r(u)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1 md:hidden",children:e.jsxs(B,{value:l,onValueChange:x,children:[e.jsx(U,{className:"h-12 sm:w-48",children:e.jsx(Y,{placeholder:"Theme"})}),e.jsx(q,{children:t.map(u=>e.jsx(O,{value:u.href,children:e.jsxs("div",{className:"flex gap-x-4 px-2 py-1",children:[e.jsx("span",{className:"scale-125",children:u.icon}),e.jsx("span",{className:"text-md",children:u.title})]})},u.href))})]})}),e.jsx("div",{className:"hidden w-full overflow-x-auto bg-background px-1 py-2 md:block",children:e.jsx("nav",{className:f("flex space-x-2 lg:flex-col lg:space-x-0 lg:space-y-1",s),...a,children:t.map(u=>e.jsxs(vs,{to:u.href,className:f(De({variant:"ghost"}),n===u.href?"bg-muted hover:bg-muted":"hover:bg-transparent hover:underline","justify-start"),children:[e.jsx("span",{className:"mr-2",children:u.icon}),u.title]},u.href))})})]})}const ar=[{title:"站点设置",key:"site",icon:e.jsx(vi,{size:18}),href:"/config/system",description:"配置站点基本信息，包括站点名称、描述、货币单位等核心设置。"},{title:"安全设置",key:"safe",icon:e.jsx(qa,{size:18}),href:"/config/system/safe",description:"配置系统安全相关选项，包括登录验证、密码策略、API访问等安全设置。"},{title:"订阅设置",key:"subscribe",icon:e.jsx(Ba,{size:18}),href:"/config/system/subscribe",description:"管理用户订阅相关配置，包括订阅链接格式、更新频率、流量统计等设置。"},{title:"邀请&佣金",key:"invite",icon:e.jsx(bi,{size:18}),href:"/config/system/invite",description:"管理用户邀请和佣金系统，配置邀请奖励、分销规则等。"},{title:"节点配置",key:"server",icon:e.jsx(Ua,{size:18}),href:"/config/system/server",description:"配置节点通信和同步设置，包括通信密钥、轮询间隔、负载均衡等高级选项。"},{title:"邮件设置",key:"email",icon:e.jsx(yi,{size:18}),href:"/config/system/email",description:"配置系统邮件服务，用于发送验证码、密码重置、通知等邮件，支持多种SMTP服务商。"},{title:"Telegram设置",key:"telegram",icon:e.jsx(Ni,{size:18}),href:"/config/system/telegram",description:"配置Telegram机器人功能，实现用户通知、账户绑定、指令交互等自动化服务。"},{title:"APP设置",key:"app",icon:e.jsx(Ga,{size:18}),href:"/config/system/app",description:"管理移动应用程序相关配置，包括API接口、版本控制、推送通知等功能设置。"}];function rd(){return e.jsxs(ge,{fadedBelow:!0,fixedHeight:!0,children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"系统设置"}),e.jsx("div",{className:"text-muted-foreground",children:"管理系统核心配置，包括站点、安全、订阅、邀请佣金、节点、邮件和通知等设置"})]}),e.jsx(se,{className:"my-6"}),e.jsxs("div",{className:"flex flex-1 flex-col space-y-8 overflow-auto lg:flex-row lg:space-x-12 lg:space-y-0",children:[e.jsx("aside",{className:"sticky top-0 lg:w-1/5",children:e.jsx(nd,{items:ar})}),e.jsx("div",{className:"w-full p-1 pr-4 lg:max-w-xl",children:e.jsx("div",{className:"pb-16",children:e.jsx(Gt,{})})})]})]})]})}const ld=Object.freeze(Object.defineProperty({__proto__:null,default:rd},Symbol.toStringTag,{value:"Module"}));function id({title:s,description:t,children:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]}),e.jsx(se,{}),a]})}const L=o.forwardRef(({className:s,...t},a)=>e.jsx(cn,{className:f("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:a,children:e.jsx(wi,{className:f("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));L.displayName=cn.displayName;const od=i.object({logo:i.string().nullable().nullable(),force_https:i.number().nullable(),stop_register:i.number().nullable(),app_name:i.string().nullable(),app_description:i.string().nullable(),app_url:i.string().nullable(),subscribe_url:i.string().nullable(),try_out_plan_id:i.number().nullable(),try_out_hour:i.number().nullable(),tos_url:i.string().nullable(),currency:i.string().nullable(),currency_symbol:i.string().nullable()}),cd={logo:"",force_https:0,stop_register:0,app_name:"",app_description:"",app_url:"",subscribe_url:"",try_out_plan_id:0,try_out_hour:0,tos_url:"",currency:"USD",currency_symbol:"$"};function dd(){const{data:s}=G({queryKey:["settings","site"],queryFn:()=>ss("site")}),{data:t}=G({queryKey:["plans"],queryFn:()=>Ps()}),a=Z({resolver:Q(od),defaultValues:cd,mode:"onChange"});o.useEffect(()=>{if(s?.data?.site){const r=s?.data?.site;Object.entries(r).forEach(([l,c])=>{a.setValue(l,c)})}},[s]);function n(r){ts(r).then(({data:l})=>{l&&z.success("更新成功")})}return e.jsx(ee,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(n),className:"space-y-8",children:[e.jsx(j,{control:a.control,name:"app_name",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"站点名称"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入站点名称",...r})}),e.jsx(P,{children:"用于显示需要站点名称的地方。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"app_description",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"站点描述"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入站点描述",...r})}),e.jsx(P,{children:"用于显示需要站点名称的地方。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"app_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"站点网址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入站点URL，末尾不要/",...r})}),e.jsx(P,{children:"当前网站最新网址，将会在邮件等需要用于网址处体现。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"force_https",render:({field:r})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"强制HTTPS"}),e.jsx(P,{children:"当站点没有使用HTTPS，CDN或反代开启强制HTTPS时需要开启。"})]}),e.jsx(v,{children:e.jsx(L,{checked:r.value,onCheckedChange:r.onChange})})]})}),e.jsx(j,{control:a.control,name:"logo",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"LOGO"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入LOGO URL，末尾不要/",...r})}),e.jsx(P,{children:"用于显示需要LOGO的地方。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"subscribe_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"订阅URL"}),e.jsx(v,{children:e.jsx(C,{placeholder:'用于订阅所使用，多个订阅地址用","隔开.留空则为站点URL。',...r})}),e.jsx(P,{children:"用于订阅所使用，留空则为站点URL。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"tos_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"用户条款(TOS)URL"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入用户条款URL，末尾不要/",...r})}),e.jsx(P,{children:"用于跳转到用户条款(TOS)"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"stop_register",render:({field:r})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"停止新用户注册"}),e.jsx(P,{children:"开启后任何人都将无法进行注册。"})]}),e.jsx(v,{children:e.jsx(L,{checked:r.value,onCheckedChange:r.onChange})})]})}),e.jsx(j,{control:a.control,name:"try_out_plan_id",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"注册试用"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...r,value:r.value||0,onChange:l=>r.onChange(Number(l.target.value)),children:[e.jsx("option",{value:0,children:"关闭"}),t?.data?.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"选择需要试用的订阅，如果没有选项请先前往订阅管理添加。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"currency",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"货币单位"}),e.jsx(v,{children:e.jsx(C,{placeholder:"CNY",...r})}),e.jsx(P,{children:"仅用于展示使用，更改后系统中所有的货币单位都将发生变更。"}),e.jsx(S,{})]})}),e.jsx(j,{control:a.control,name:"currency_symbol",render:({field:r})=>e.jsxs(h,{children:[e.jsx(g,{children:"货币符号"}),e.jsx(v,{children:e.jsx(C,{placeholder:"¥",...r})}),e.jsx(P,{children:"仅用于展示使用，更改后系统中所有的货币单位都将发生变更。"}),e.jsx(S,{})]})}),e.jsx(k,{type:"submit",children:"更新配置"})]})})}function xd(){const s=ar.find(t=>t.key==="site");return e.jsx(id,{title:s.title,description:s.description,children:e.jsx(dd,{})})}const md=Object.freeze(Object.defineProperty({__proto__:null,default:xd},Symbol.toStringTag,{value:"Module"})),us=o.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:f("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}));us.displayName="Textarea";const ud=i.object({email_verify:i.boolean().nullable(),safe_mode_enable:i.boolean().nullable(),secure_path:i.string().nullable(),email_whitelist_enable:i.boolean().nullable(),email_whitelist_suffix:i.array(i.string().nullable()).nullable(),email_gmail_limit_enable:i.boolean().nullable(),recaptcha_enable:i.boolean().nullable(),recaptcha_key:i.string().nullable(),recaptcha_site_key:i.string().nullable(),register_limit_by_ip_enable:i.boolean().nullable(),register_limit_count:i.coerce.string().transform(s=>s===""?null:s).nullable(),register_limit_expire:i.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_enable:i.boolean().nullable(),password_limit_count:i.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_expire:i.coerce.string().transform(s=>s===""?null:s).nullable()}),hd={email_verify:!1,safe_mode_enable:!1,secure_path:"",email_whitelist_enable:!1,email_whitelist_suffix:[],email_gmail_limit_enable:!1,recaptcha_enable:!1,recaptcha_key:"",recaptcha_site_key:"",register_limit_by_ip_enable:!1,register_limit_count:"",register_limit_expire:"",password_limit_enable:!1,password_limit_count:"",password_limit_expire:""};function jd(){const s=Z({resolver:Q(ud),defaultValues:hd,mode:"onChange"}),{data:t}=G({queryKey:["settings","safe"],queryFn:()=>ss("safe")});o.useEffect(()=>{if(t?.data.safe){const n=t.data.safe;Object.entries(n).forEach(([r,l])=>{typeof l=="number"?s.setValue(r,String(l)):s.setValue(r,l)})}},[t,s]);function a(n){ts(n).then(({data:r})=>{r&&z.success("保存成功")})}return e.jsx(ee,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(a),className:"space-y-8",children:[e.jsx(j,{control:s.control,name:"email_verify",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"邮箱验证"}),e.jsx(P,{children:"开启后将会强制要求用户进行邮箱验证。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:s.control,name:"email_gmail_limit_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"禁止使用Gmail多别名"}),e.jsx(P,{children:"开启后Gmail多别名将无法注册。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:s.control,name:"safe_mode_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"安全模式"}),e.jsx(P,{children:"开启后除了站点URL以外的绑定本站点的域名访问都将会被403。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:s.control,name:"secure_path",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"后台路径"}),e.jsx(v,{children:e.jsx(C,{placeholder:"admin",...n})}),e.jsx(P,{children:"后台管理路径，修改后将会改变原有的admin路径"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_whitelist_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"邮箱后缀白名单"}),e.jsx(P,{children:"开启后在名单中的邮箱后缀才允许进行注册。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),s.watch("email_whitelist_enable")&&e.jsx(j,{control:s.control,name:"email_whitelist_suffix",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"白名单后缀"}),e.jsx(v,{children:e.jsx(us,{placeholder:"请输入后缀域名，逗号分割 如：qq.com,gmail.com",value:n.value?.length&&n.value.join(","),onChange:r=>{r.target.value&&n.onChange(r.target.value.split(","))}})}),e.jsx(P,{children:"请使用逗号进行分割，如：qq.com,gmail.com。"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"recaptcha_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"防机器人"}),e.jsx(P,{children:"开启后将会使用Google reCAPTCHA防止机器人。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),s.watch("recaptcha_enable")&&e.jsx(j,{control:s.control,name:"recaptcha_key",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"密钥"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"在Google reCAPTCHA申请的密钥。"}),e.jsx(S,{})]})}),s.watch("recaptcha_enable")&&e.jsx(j,{control:s.control,name:"recaptcha_site_key",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"网站密钥"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"在Google reCAPTCH申请的网站密钥。"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"register_limit_by_ip_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"IP注册限制"}),e.jsx(P,{children:"开启后如果IP注册账户达到规则要求将会被限制注册，请注意IP判断可能因为CDN或前置代理导致问题。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),s.watch("register_limit_by_ip_enable")&&e.jsx(j,{control:s.control,name:"register_limit_count",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"次数"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"达到注册次数后开启惩罚。"}),e.jsx(S,{})]})}),s.watch("register_limit_by_ip_enable")&&e.jsx(j,{control:s.control,name:"register_limit_expire",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"惩罚时间(分钟)"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"需要等待惩罚时间过后才可以再次注册。"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"password_limit_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"IP注册限制"}),e.jsx(P,{children:"开启后如果IP注册账户达到规则要求将会被限制注册，请注意IP判断可能因为CDN或前置代理导致问题。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),s.watch("password_limit_enable")&&e.jsx(j,{control:s.control,name:"password_limit_count",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"次数"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"达到注册次数后开启惩罚。"}),e.jsx(S,{})]})}),s.watch("password_limit_enable")&&e.jsx(j,{control:s.control,name:"password_limit_expire",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"惩罚时间(分钟)"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"需要等待惩罚时间过后才可以再次登陆。"}),e.jsx(S,{})]})}),e.jsx(k,{type:"submit",children:"保存配置"})]})})}function gd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"安全设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统安全相关选项，包括登录验证、密码策略、API访问等安全设置。"})]}),e.jsx(se,{}),e.jsx(jd,{})]})}const fd=Object.freeze(Object.defineProperty({__proto__:null,default:gd},Symbol.toStringTag,{value:"Module"})),pd=i.object({plan_change_enable:i.boolean().nullable(),reset_traffic_method:i.coerce.number().nullable(),surplus_enable:i.boolean().nullable(),new_order_event_id:i.coerce.number().nullable(),renew_order_event_id:i.coerce.number().nullable(),change_order_event_id:i.coerce.number().nullable(),show_info_to_server_enable:i.boolean().nullable(),show_protocol_to_server_enable:i.boolean().nullable(),default_remind_expire:i.boolean().nullable(),default_remind_traffic:i.boolean().nullable()}),vd={plan_change_enable:!1,reset_traffic_method:0,surplus_enable:!1,new_order_event_id:0,renew_order_event_id:0,change_order_event_id:0,show_info_to_server_enable:!1,show_protocol_to_server_enable:!1,default_remind_expire:!1,default_remind_traffic:!1};function bd(){const{data:s}=G({queryKey:["settings","subscribe"],queryFn:()=>ss("subscribe")}),t=Z({resolver:Q(pd),defaultValues:vd,mode:"onChange"});o.useEffect(()=>{if(s?.data?.subscribe){const n=s?.data?.subscribe;Object.entries(n).forEach(([r,l])=>{t.setValue(r,l)})}},[s]);function a(n){ts(n).then(({data:r})=>{r&&z.success("更新成功")})}return e.jsx(ee,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(a),className:"space-y-8",children:[e.jsx(j,{control:t.control,name:"plan_change_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"允许用户更改订阅"}),e.jsx(P,{children:"开启后用户将会可以对订阅计划进行变更。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"reset_traffic_method",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"月流量重置方式"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...n,children:[e.jsx("option",{value:"0",children:"每月1号"}),e.jsx("option",{value:"1",children:"按月重置"}),e.jsx("option",{value:"2",children:"不重置"}),e.jsx("option",{value:"3",children:"每年1月1号"}),e.jsx("option",{value:"4",children:"按年重置"})]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"全局流量重置方式，默认每月1号。可以在订阅管理为订阅单独设置。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"surplus_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"开启折抵方案"}),e.jsx(P,{children:"开启后用户更换订阅将会由系统对原有订阅进行折抵，方案参考文档。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"new_order_event_id",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"当订阅新购时触发事件"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...n,children:[e.jsx("option",{value:"0",children:"不执行任何动作"}),e.jsx("option",{value:"1",children:"重置用户流量"})]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"新购订阅完成时将触发该任务。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"renew_order_event_id",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"当订阅续费时触发事件"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...n,children:[e.jsx("option",{value:"0",children:"不执行任何动作"}),e.jsx("option",{value:"1",children:"重置用户流量"})]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"续费订阅完成时将触发该任务。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"change_order_event_id",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"当订阅变更时触发事件"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...n,children:[e.jsx("option",{value:"0",children:"不执行任何动作"}),e.jsx("option",{value:"1",children:"重置用户流量"})]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"变更订阅完成时将触发该任务。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"show_info_to_server_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"在订阅中展示订阅信息"}),e.jsx(P,{children:"开启后将会在用户订阅节点时输出订阅信息。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"show_protocol_to_server_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"在订阅中线路名称中显示协议名称"}),e.jsx(P,{children:"开启后订阅线路会附带协议名称（例如: [Hy2]香港）"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"default_remind_expire",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"用户订阅到期提醒的默认设置"}),e.jsx(P,{children:"开启后新注册用户将默认接收订阅到期提醒。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"default_remind_traffic",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"用户流量告急提醒的默认设置"}),e.jsx(P,{children:"开启后新注册用户将默认接收流量告急提醒。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(k,{type:"submit",children:"保存设置"})]})})}function yd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"订阅设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"管理用户订阅相关配置，包括订阅链接格式、更新频率、流量统计等设置。"})]}),e.jsx(se,{}),e.jsx(bd,{})]})}const Nd=Object.freeze(Object.defineProperty({__proto__:null,default:yd},Symbol.toStringTag,{value:"Module"})),wd=i.object({invite_force:i.boolean().default(!1),invite_commission:i.coerce.string().default("0"),invite_gen_limit:i.coerce.string().default("0"),invite_never_expire:i.boolean().default(!1),commission_first_time_enable:i.boolean().default(!1),commission_auto_check_enable:i.boolean().default(!1),commission_withdraw_limit:i.coerce.string().default("0"),commission_withdraw_method:i.array(i.string()).default(["支付宝","USDT","Paypal"]),withdraw_close_enable:i.boolean().default(!1),commission_distribution_enable:i.boolean().default(!1),commission_distribution_l1:i.coerce.number().default(0),commission_distribution_l2:i.coerce.number().default(0),commission_distribution_l3:i.coerce.number().default(0)}),_d={invite_force:!1,invite_commission:"0",invite_gen_limit:"0",invite_never_expire:!1,commission_first_time_enable:!1,commission_auto_check_enable:!1,commission_withdraw_limit:"0",commission_withdraw_method:["支付宝","USDT","Paypal"],withdraw_close_enable:!1,commission_distribution_enable:!1,commission_distribution_l1:0,commission_distribution_l2:0,commission_distribution_l3:0};function Cd(){const{data:s}=G({queryKey:["settings","invite"],queryFn:()=>ss("invite")}),t=Z({resolver:Q(wd),defaultValues:_d,mode:"onChange"});o.useEffect(()=>{if(s?.data?.invite){const n=s?.data?.invite;Object.entries(n).forEach(([r,l])=>{typeof l=="number"?t.setValue(r,String(l)):t.setValue(r,l)})}},[s,t]);function a(n){ts(n).then(r=>{r.data&&z.success("更新成功")})}return e.jsx(ee,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(a),className:"space-y-8",children:[e.jsx(j,{control:t.control,name:"invite_force",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"开启强制邀请"}),e.jsx(P,{children:"开启后只有被邀请的用户才可以进行注册。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"invite_commission",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"邀请佣金百分比"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"默认全局的佣金分配比例，你可以在用户管理单独配置单个比例。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"invite_gen_limit",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"用户可创建邀请码上限"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"用户可创建邀请码上限"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"invite_never_expire",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"邀请码永不失效"}),e.jsx(P,{children:"开启后邀请码被使用后将不会失效，否则使用过后即失效。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"commission_first_time_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"佣金仅首次发放"}),e.jsx(P,{children:"开启后被邀请人首次支付时才会产生佣金，可以在用户管理对用户进行单独配置。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"commission_auto_check_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"佣金自动确认"}),e.jsx(P,{children:"开启后佣金将会在订单完成3日后自动进行确认。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"commission_withdraw_limit",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"提现单申请门槛(元)"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"小于门槛金额的提现单将不会被提交。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"commission_withdraw_method",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"提现方式"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"可以支持的提现方式。"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"withdraw_close_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"关闭提现"}),e.jsx(P,{children:"关闭后将禁止用户申请提现，且邀请佣金将会直接进入用户余额。"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"commission_distribution_enable",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"三级分销"}),e.jsxs(P,{children:["开启后将佣金将按照设置的3成比例进行分成，三成比例合计请不要",">","100%。"]})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),t.watch("commission_distribution_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:t.control,name:"commission_distribution_l1",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"一级邀请人比例"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入比例如：50",...n})}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"commission_distribution_l2",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"二级邀请人比例"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入比例如：50",...n})}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"commission_distribution_l3",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"三级邀请人比例"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入比例如：50",...n})}),e.jsx(S,{})]})})]}),e.jsx(k,{type:"submit",children:"保存设置"})]})})}function Sd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"邀请&佣金设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"邀请注册、佣金相关设置。"})]}),e.jsx(se,{}),e.jsx(Cd,{})]})}const kd=Object.freeze(Object.defineProperty({__proto__:null,default:Sd},Symbol.toStringTag,{value:"Module"})),Dd=i.object({frontend_theme:i.string().nullable(),frontend_theme_sidebar:i.string().nullable(),frontend_theme_header:i.string().nullable(),frontend_theme_color:i.string().nullable(),frontend_background_url:i.string().url().nullable()}),Td={frontend_theme:"",frontend_theme_sidebar:"",frontend_theme_header:"",frontend_theme_color:"",frontend_background_url:""};function Fd(){const{data:s}=G({queryKey:["settings","frontend"],queryFn:()=>ss("frontend")}),t=Z({resolver:Q(Dd),defaultValues:Td,mode:"onChange"});o.useEffect(()=>{if(s?.data?.frontend){const n=s?.data?.frontend;Object.entries(n).forEach(([r,l])=>{t.setValue(r,l)})}},[s]);function a(n){ts(n).then(({data:r})=>{r&&z.success("更新成功")})}return e.jsx(ee,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(a),className:"space-y-8",children:[e.jsx(j,{control:t.control,name:"frontend_theme_sidebar",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"边栏风格"}),e.jsx(P,{children:"边栏风格"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"frontend_theme_header",render:({field:n})=>e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"头部风格"}),e.jsx(P,{children:"边栏风格"})]}),e.jsx(v,{children:e.jsx(L,{checked:n.value,onCheckedChange:n.onChange})})]})}),e.jsx(j,{control:t.control,name:"frontend_theme_color",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"主题色"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsxs("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...n,children:[e.jsx("option",{value:"default",children:"默认"}),e.jsx("option",{value:"black",children:"黑色"}),e.jsx("option",{value:"blackblue",children:"暗蓝色"}),e.jsx("option",{value:"green",children:"奶绿色"})]})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"主题色"}),e.jsx(S,{})]})}),e.jsx(j,{control:t.control,name:"frontend_background_url",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"背景"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入图片地址",...n})}),e.jsx(P,{children:"将会在后台登录页面进行展示。"}),e.jsx(S,{})]})}),e.jsx(k,{type:"submit",children:"保存设置"})]})})}function Pd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"个性化设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"自定义系统界面外观，包括主题风格、布局、颜色方案、背景图等个性化选项。"})]}),e.jsx(se,{}),e.jsx(Fd,{})]})}const Vd=Object.freeze(Object.defineProperty({__proto__:null,default:Pd},Symbol.toStringTag,{value:"Module"})),Id=i.object({server_pull_interval:i.coerce.number().nullable(),server_push_interval:i.coerce.number().nullable(),server_token:i.string().nullable()}),zd={server_pull_interval:0,server_push_interval:0,server_token:""};function Rd(){const s=Z({resolver:Q(Id),defaultValues:zd,mode:"onChange"}),{data:t}=G({queryKey:["settings","server"],queryFn:()=>ss("server")});o.useEffect(()=>{if(t?.data.server){const n=t.data.server;Object.entries(n).forEach(([r,l])=>{s.setValue(r,l)})}},[t]);function a(n){ts(n).then(({data:r})=>{r&&z.success("保存成功")})}return e.jsx(ee,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(a),className:"space-y-8",children:[e.jsx(j,{control:s.control,name:"server_token",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"通讯密钥"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"Xboard与节点通讯的密钥，以便数据不会被他人获取。"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"server_pull_interval",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"节点拉取动作轮询间隔"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"节点从面板获取数据的间隔频率。"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"server_push_interval",render:({field:n})=>e.jsxs(h,{children:[e.jsx(g,{children:"节点推送动作轮询间隔"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...n})}),e.jsx(P,{children:"节点推送数据到面板的间隔频率。"}),e.jsx(S,{})]})}),e.jsx(k,{type:"submit",children:"保存设置"})]})})}function Ed(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"节点配置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置节点通信和同步设置，包括通信密钥、轮询间隔、负载均衡等高级选项。"})]}),e.jsx(se,{}),e.jsx(Rd,{})]})}const Md=Object.freeze(Object.defineProperty({__proto__:null,default:Ed},Symbol.toStringTag,{value:"Module"})),Od=i.object({email_template:i.string().nullable(),email_host:i.string().nullable(),email_port:i.string().regex(/^\d+$/).nullable(),email_username:i.string().nullable(),email_password:i.string().nullable(),email_encryption:i.string().nullable(),email_from_address:i.string().email().nullable()}),Ld={email_template:"classic",email_host:"",email_port:"465",email_username:"",email_password:"",email_encryption:"",email_from_address:""};function $d(){const s=Z({resolver:Q(Od),defaultValues:Ld,mode:"onChange"}),{data:t}=G({queryKey:["settings","email"],queryFn:()=>ss("email")}),{data:a}=G({queryKey:["emailTemplate"],queryFn:()=>Ac()});o.useEffect(()=>{if(t?.data.email){const l=t.data.email;Object.entries(l).forEach(([c,x])=>{s.setValue(c,x)})}},[t]);const{isLoading:n,refetch:r}=G({queryKey:["sendTestMail"],queryFn:()=>Hc().then(()=>z.success("发送成功")),enabled:!1});return e.jsxs(ee,{...s,children:[e.jsx(j,{control:s.control,name:"email_host",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"SMTP服务器地址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"由邮件服务商提供的服务地址"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_port",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"SMTP服务端口"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"常见的端口有25, 465, 587"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_encryption",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"SMTP加密方式"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"465端口加密方式一般为SSL，587端口加密方式一般为TLS"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_username",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"SMTP账号"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"由邮件服务商提供的账号"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_password",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"SMTP密码"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"由邮件服务商提供的密码"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_from_address",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"发件地址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入",...l})}),e.jsx(P,{children:"由邮件服务商提供的发件地址"}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"email_template",render:({field:l})=>e.jsxs(h,{children:[e.jsx(g,{children:"邮件模板"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(v,{children:e.jsx("select",{className:f(De({variant:"outline"}),"w-[200px] appearance-none font-normal"),...l,children:a?.data?.map(c=>e.jsx("option",{value:c,children:c},c))})}),e.jsx(Ye,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(P,{children:"你可以在文档查看如何自定义邮件模板"}),e.jsx(S,{})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(k,{type:"submit",onClick:()=>{s.handleSubmit(l=>{console.log(l),ts(l).then(({data:c})=>{c&&z.success("保存成功")})})()},children:"保存设置"}),e.jsx(k,{loading:n,onClick:()=>{r()},children:"发送测试邮件"})]})]})}function Ad(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"邮件设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统邮件服务，用于发送验证码、密码重置、通知等邮件，支持多种SMTP服务商。"})]}),e.jsx(se,{}),e.jsx($d,{})]})}const Hd=Object.freeze(Object.defineProperty({__proto__:null,default:Ad},Symbol.toStringTag,{value:"Module"})),Kd=i.object({telegram_bot_enable:i.boolean().nullable(),telegram_bot_token:i.string().nullable(),telegram_discuss_link:i.string().nullable()}),Gd={telegram_bot_enable:!1,telegram_bot_token:"",telegram_discuss_link:""};function Ud(){const s=Z({resolver:Q(Kd),defaultValues:Gd,mode:"onChange"}),{data:t}=G({queryKey:["settings","telegram"],queryFn:()=>ss("telegram")});o.useEffect(()=>{if(t?.data.telegram){const c=t.data.telegram;Object.entries(c).forEach(([x,u])=>{s.setValue(x,u)})}},[t]);const{mutate:a,status:n}=Et({mutationFn:c=>ts(c).then(({data:x})=>x&&z.success("保存成功")),mutationKey:["settings","telegram"]}),{mutate:r,status:l}=Et({mutationFn:c=>Kc().then(({data:x})=>x&&z.success("保存成功")),mutationKey:["settings","settelegramWebhook"]});return e.jsxs(ee,{...s,children:[e.jsx(j,{control:s.control,name:"telegram_bot_token",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"机器人Token"}),e.jsx(v,{children:e.jsx(C,{placeholder:"0000000000:xxxxxxxxx_xxxxxxxxxxxxxxx",...c})}),e.jsx(P,{children:"请输入由Botfather提供的token。"}),e.jsx(S,{})]})}),s.watch("telegram_bot_token")&&e.jsxs(h,{children:[e.jsx(g,{children:"设置Webhook"}),e.jsx("div",{children:e.jsx(k,{loading:l=="pending",onClick:()=>{r()},children:"一键设置"})}),e.jsx(P,{children:"对机器人进行Webhook设置，不设置将无法收到Telegram通知。"}),e.jsx(S,{})]}),e.jsx(j,{control:s.control,name:"telegram_bot_enable",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"开启机器人通知"}),e.jsx(P,{children:"开启后bot将会对绑定了telegram的管理员和用户进行基础通知。"}),e.jsx(v,{children:e.jsx(L,{checked:c.value,onCheckedChange:c.onChange})}),e.jsx(S,{})]})}),e.jsx(j,{control:s.control,name:"telegram_discuss_link",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"群组地址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"https://t.me/xxxxxx",...c})}),e.jsx(P,{children:"填写后将会在用户端展示，或者被用于需要的地方。"}),e.jsx(S,{})]})}),e.jsx(k,{type:"submit",loading:n==="pending",onClick:()=>{s.handleSubmit(c=>{console.log(c),a(c)})()},children:"保存设置"})]})}function qd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Telegram设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置Telegram机器人功能，实现用户通知、账户绑定、指令交互等自动化服务。"})]}),e.jsx(se,{}),e.jsx(Ud,{})]})}const Bd=Object.freeze(Object.defineProperty({__proto__:null,default:qd},Symbol.toStringTag,{value:"Module"})),Yd=i.object({windows_version:i.string().nullable(),windows_download_url:i.string().nullable(),macos_version:i.string().nullable(),macos_download_url:i.string().nullable(),android_version:i.string().nullable(),android_download_url:i.string().nullable()}),Wd={windows_version:"",windows_download_url:"",macos_version:"",macos_download_url:"",android_version:"",android_download_url:""};function Jd(){const s=Z({resolver:Q(Yd),defaultValues:Wd,mode:"onChange"}),{data:t}=G({queryKey:["settings","app"],queryFn:()=>ss("app")});o.useEffect(()=>{if(t?.data.app){const r=t.data.app;Object.entries(r).forEach(([l,c])=>{s.setValue(l,c)})}},[t]);const{mutate:a,status:n}=Et({mutationFn:r=>ts(r).then(({data:l})=>l&&z.success("保存成功")),mutationKey:["settings","app","update"]});return e.jsxs(ee,{...s,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Windows"}),e.jsx("div",{className:"text-[0.8rem] text-muted-foreground",children:"Windows端版本号及下载地址"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx(j,{control:s.control,name:"windows_version",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"1.0.0",...r})}),e.jsx(S,{})]})})}),e.jsx("div",{children:e.jsx(j,{control:s.control,name:"windows_download_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"https://xxx.com/xxx.exe",...r})}),e.jsx(S,{})]})})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"macOS"}),e.jsx("div",{className:"text-[0.8rem] text-muted-foreground",children:"macOS端版本号及下载地址"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx(j,{control:s.control,name:"mac_version",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"1.0.0",...r})}),e.jsx(S,{})]})})}),e.jsx("div",{children:e.jsx(j,{control:s.control,name:"mac_download_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"https://xxx.com/xxx.dmg",...r})}),e.jsx(S,{})]})})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Android"}),e.jsx("div",{className:"text-[0.8rem] text-muted-foreground",children:"Android端版本号及下载地址"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx(j,{control:s.control,name:"android_version",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"1.0.0",...r})}),e.jsx(S,{})]})})}),e.jsx("div",{children:e.jsx(j,{control:s.control,name:"android_download_url",render:({field:r})=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsx(C,{placeholder:"https://xxx.com/xxx.apk",...r})}),e.jsx(S,{})]})})})]})]}),e.jsx(k,{type:"submit",loading:n=="pending",onClick:()=>{s.handleSubmit(r=>{a(r)})()},children:"保存设置"})]})}function Zd(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"APP设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"管理移动应用程序相关配置，包括API接口、版本控制、推送通知等功能设置。"})]}),e.jsx(se,{}),e.jsx(Jd,{})]})}const Xd=Object.freeze(Object.defineProperty({__proto__:null,default:Zd},Symbol.toStringTag,{value:"Module"})),Wt=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:f("w-full caption-bottom text-sm",s),...t})}));Wt.displayName="Table";const Jt=o.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:f("[&_tr]:border-b",s),...t}));Jt.displayName="TableHeader";const Zt=o.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:f("[&_tr:last-child]:border-0",s),...t}));Zt.displayName="TableBody";const Qd=o.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:f("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Qd.displayName="TableFooter";const is=o.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:f("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));is.displayName="TableRow";const Xt=o.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:f("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));Xt.displayName="TableHead";const Ds=o.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:f("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));Ds.displayName="TableCell";const ex=o.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:f("mt-4 text-sm text-muted-foreground",s),...t}));ex.displayName="TableCaption";function sx({table:s}){const[t,a]=o.useState("");o.useEffect(()=>{a((s.getState().pagination.pageIndex+1).toString())},[s.getState().pagination.pageIndex]);const n=r=>{const l=parseInt(r);!isNaN(l)&&l>=1&&l<=s.getPageCount()?s.setPageIndex(l-1):a((s.getState().pagination.pageIndex+1).toString())};return e.jsxs("div",{className:"flex flex-col-reverse gap-4 px-2 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:["已选择 ",s.getFilteredSelectedRowModel().rows.length," 项， 共"," ",s.getFilteredRowModel().rows.length," 项"]}),e.jsxs("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"每页显示"}),e.jsxs(B,{value:`${s.getState().pagination.pageSize}`,onValueChange:r=>{s.setPageSize(Number(r))},children:[e.jsx(U,{className:"h-8 w-[70px]",children:e.jsx(Y,{placeholder:s.getState().pagination.pageSize})}),e.jsx(q,{side:"top",children:[10,20,30,40,50].map(r=>e.jsx(O,{value:`${r}`,children:r},r))})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm font-medium",children:[e.jsx("span",{children:"第"}),e.jsx(C,{type:"text",value:t,onChange:r=>a(r.target.value),onBlur:r=>n(r.target.value),onKeyDown:r=>{r.key==="Enter"&&n(r.currentTarget.value)},className:"h-8 w-[50px] text-center"}),e.jsxs("span",{children:["页，共 ",s.getPageCount()," 页"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(k,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"跳转到第一页"}),e.jsx(_i,{className:"h-4 w-4"})]}),e.jsxs(k,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"上一页"}),e.jsx(rn,{className:"h-4 w-4"})]}),e.jsxs(k,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"下一页"}),e.jsx(qt,{className:"h-4 w-4"})]}),e.jsxs(k,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"跳转到最后一页"}),e.jsx(Ci,{className:"h-4 w-4"})]})]})]})]})}function $e({table:s,toolbar:t,draggable:a=!1,onDragStart:n,onDragEnd:r,onDragOver:l,onDragLeave:c,onDrop:x,showPagination:u=!0,isLoading:b=!1}){const[p,y]=o.useState(0),_=o.useRef(null);o.useEffect(()=>{_.current&&y(_.current.offsetWidth)},[]);const D=s.getAllColumns().filter(d=>d.getIsPinned()==="left"),F=s.getAllColumns().filter(d=>d.getIsPinned()==="right");s.getAllColumns().filter(d=>!d.getIsPinned());const T=d=>D.slice(0,d).reduce((N,w)=>N+(w.getSize()??0),0),m=d=>F.slice(d+1).reduce((N,w)=>N+(w.getSize()??0),0);return e.jsxs("div",{className:"space-y-4",children:[typeof t=="function"?t(s):t,e.jsx("div",{ref:_,className:"rounded-md border bg-card relative overflow-auto",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(Wt,{children:[e.jsx(Jt,{children:s.getHeaderGroups().map(d=>e.jsx(is,{className:"hover:bg-transparent",children:d.headers.map((N,w)=>{const E=N.column.getIsPinned()==="left",H=N.column.getIsPinned()==="right",je=E?T(D.indexOf(N.column)):void 0,He=H?m(F.indexOf(N.column)):void 0;return e.jsx(Xt,{colSpan:N.colSpan,style:{width:N.getSize(),...E&&{left:je},...H&&{right:He}},className:f("h-11 px-4 text-muted-foreground bg-card",(E||H)&&["sticky z-20","before:absolute before:top-0 before:w-[1px] before:bottom-0 before:bg-border",E&&"before:right-0",H&&"before:left-0"]),children:N.isPlaceholder?null:rt(N.column.columnDef.header,N.getContext())},N.id)})},d.id))}),e.jsx(Zt,{children:s.getRowModel().rows?.length?s.getRowModel().rows.map((d,N)=>e.jsx(is,{"data-state":d.getIsSelected()&&"selected",className:"hover:bg-muted/50",draggable:a,onDragStart:w=>n?.(w,N),onDragEnd:r,onDragOver:l,onDragLeave:c,onDrop:w=>x?.(w,N),children:d.getVisibleCells().map((w,E)=>{const H=w.column.getIsPinned()==="left",je=w.column.getIsPinned()==="right",He=H?T(D.indexOf(w.column)):void 0,Vs=je?m(F.indexOf(w.column)):void 0;return e.jsx(Ds,{style:{width:w.column.getSize(),...H&&{left:He},...je&&{right:Vs}},className:f("bg-card",(H||je)&&["sticky z-20","before:absolute before:top-0 before:w-[1px] before:bottom-0 before:bg-border",H&&"before:right-0",je&&"before:left-0"]),children:rt(w.column.columnDef.cell,w.getContext())},w.id)})},d.id)):e.jsx(is,{children:e.jsx(Ds,{colSpan:s.getAllColumns().length,className:"h-24 text-center",children:"暂无数据"})})})]})})}),u&&e.jsx(sx,{table:s})]})}const tx=ps("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/10",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function M({className:s,variant:t,...a}){return e.jsx("div",{className:f(tx({variant:t}),s),...a})}const nr=(s,t)=>{let a=null;switch(s.field_type){case"input":a=e.jsx(C,{placeholder:s.placeholder,...t});break;case"textarea":a=e.jsx(us,{placeholder:s.placeholder,...t});break;case"select":a=e.jsx("select",{className:f(Ts({variant:"outline"}),"w-full appearance-none font-normal"),...t,children:s.select_options&&Object.keys(s.select_options).map(n=>e.jsx("option",{value:n,children:s.select_options?.[n]},n))});break;default:a=null;break}return a},ax=i.object({id:i.number().nullable(),name:i.string().min(2,"名称至少需要2个字符").max(30,"名称不能超过30个字符"),icon:i.string().optional().nullable(),notify_domain:i.string().refine(s=>!s||/^https?:\/\/\S+/.test(s),"请输入有效的URL").optional().nullable(),handling_fee_fixed:i.coerce.number().min(0).optional().nullable(),handling_fee_percent:i.coerce.number().min(0).max(100).optional().nullable(),payment:i.string().min(1,"请选择支付接口"),config:i.record(i.string(),i.string())}),Na={id:null,name:"",icon:"",notify_domain:"",handling_fee_fixed:0,handling_fee_percent:0,payment:"",config:{}};function rr({refetch:s,dialogTrigger:t,type:a="add",defaultFormValues:n=Na}){const[r,l]=o.useState(!1),[c,x]=o.useState(!1),[u,b]=o.useState([]),[p,y]=o.useState([]),_=Z({resolver:Q(ax),defaultValues:n,mode:"onChange"}),D=_.watch("payment");o.useEffect(()=>{r&&(async()=>{const{data:m}=await ic();b(m)})()},[r]),o.useEffect(()=>{if(!D||!r)return;(async()=>{try{const m={payment:D,...a==="edit"&&{id:Number(_.getValues("id"))}},{data:d}=await oc(m);y(d);const N=d.reduce((w,E)=>(E.field_name&&(w[E.field_name]=E.value??""),w),{});_.setValue("config",N)}catch{z.error("获取支付方式表单失败")}})()},[D,r,_,a]);const F=async T=>{x(!0),(await cc(T)).data&&(z.success("保存成功"),_.reset(Na),s(),l(!1)),x(!1)};return e.jsxs(de,{open:r,onOpenChange:l,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"})," ",e.jsx("div",{children:"添加支付方式"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsx(he,{children:e.jsx(xe,{children:a==="add"?"添加支付方式":"编辑支付方式"})}),e.jsx(ee,{..._,children:e.jsxs("form",{onSubmit:_.handleSubmit(F),className:"space-y-4",children:[e.jsx(j,{control:_.control,name:"name",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"显示名称"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入支付名称",...T})}),e.jsx(P,{children:"用于前端显示"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"icon",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"图标URL"}),e.jsx(v,{children:e.jsx(C,{placeholder:"https://example.com/icon.svg",...T})}),e.jsx(P,{children:"用于前端显示的图标地址"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"notify_domain",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"通知域名"}),e.jsx(v,{children:e.jsx(C,{placeholder:"https://example.com",...T})}),e.jsx(P,{children:"网关通知将发送到该域名"}),e.jsx(S,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{control:_.control,name:"handling_fee_percent",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"百分比手续费(%)"}),e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"0-100",...T})}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"handling_fee_fixed",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"固定手续费"}),e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"0",...T})}),e.jsx(S,{})]})})]}),e.jsx(j,{control:_.control,name:"payment",render:({field:T})=>e.jsxs(h,{children:[e.jsx(g,{children:"支付接口"}),e.jsxs(B,{value:T.value,onValueChange:T.onChange,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择支付接口"})})}),e.jsx(q,{children:u.map(m=>e.jsx(O,{value:m,children:m},m))})]}),e.jsx(S,{})]})}),p.map(T=>e.jsx(j,{control:_.control,name:`config.${T.field_name}`,render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:T.label}),e.jsx(v,{children:nr(T,m)}),e.jsx(S,{})]})},T.field_name)),e.jsxs(ke,{className:"gap-2",children:[e.jsx(Gs,{asChild:!0,children:e.jsx(k,{type:"button",variant:"outline",children:"取消"})}),e.jsx(k,{type:"submit",disabled:c,className:f(c&&"cursor-not-allowed opacity-50"),children:c?"保存中...":"提交"})]})]})})]})]})}function V({column:s,title:t,tooltip:a,className:n}){return s.getCanSort()?e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(k,{variant:"ghost",size:"default",className:f("-ml-3 flex h-8 items-center gap-2 text-nowrap font-medium hover:bg-muted/60",n),onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:[e.jsx("span",{children:t}),a&&e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(ma,{className:"h-4 w-4 cursor-pointer text-muted-foreground"})}),e.jsx(ne,{children:a})]})}),s.getIsSorted()==="asc"?e.jsx(zt,{className:"h-4 w-4 text-foreground/70"}):s.getIsSorted()==="desc"?e.jsx(Rt,{className:"h-4 w-4 text-foreground/70"}):e.jsx(Si,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-foreground/70"})]})})}):e.jsxs("div",{className:f("flex items-center space-x-1 text-nowrap py-2 font-medium text-muted-foreground",n),children:[e.jsx("span",{children:t}),a&&e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsx(ma,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(ne,{children:a})]})})]})}const nx=ki,rx=Di,lx=Ti,lr=o.forwardRef(({className:s,...t},a)=>e.jsx(dn,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));lr.displayName=dn.displayName;const ir=o.forwardRef(({className:s,...t},a)=>e.jsxs(lx,{children:[e.jsx(lr,{}),e.jsx(xn,{ref:a,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));ir.displayName=xn.displayName;const or=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",s),...t});or.displayName="AlertDialogHeader";const cr=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});cr.displayName="AlertDialogFooter";const dr=o.forwardRef(({className:s,...t},a)=>e.jsx(mn,{ref:a,className:f("text-lg font-semibold",s),...t}));dr.displayName=mn.displayName;const xr=o.forwardRef(({className:s,...t},a)=>e.jsx(un,{ref:a,className:f("text-sm text-muted-foreground",s),...t}));xr.displayName=un.displayName;const mr=o.forwardRef(({className:s,...t},a)=>e.jsx(hn,{ref:a,className:f(Ts(),s),...t}));mr.displayName=hn.displayName;const ur=o.forwardRef(({className:s,...t},a)=>e.jsx(jn,{ref:a,className:f(Ts({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));ur.displayName=jn.displayName;function Ae({onConfirm:s,children:t,title:a="确认操作",description:n="确定要执行此操作吗？",cancelText:r="取消",confirmText:l="确认",variant:c="default",className:x}){return e.jsxs(nx,{children:[e.jsx(rx,{asChild:!0,children:t}),e.jsxs(ir,{className:f("sm:max-w-[425px]",x),children:[e.jsxs(or,{children:[e.jsx(dr,{children:a}),e.jsx(xr,{children:n})]}),e.jsxs(cr,{children:[e.jsx(ur,{asChild:!0,children:e.jsx(k,{variant:"outline",children:r})}),e.jsx(mr,{asChild:!0,children:e.jsx(k,{variant:c,onClick:s,children:l})})]})]})]})}const hr=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M11.29 15.29a2 2 0 0 0-.12.15a.8.8 0 0 0-.09.18a.6.6 0 0 0-.06.18a1.4 1.4 0 0 0 0 .2a.84.84 0 0 0 .08.38a.9.9 0 0 0 .54.54a.94.94 0 0 0 .76 0a.9.9 0 0 0 .54-.54A1 1 0 0 0 13 16a1 1 0 0 0-.29-.71a1 1 0 0 0-1.42 0M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8 8 0 0 1-8 8m0-13a3 3 0 0 0-2.6 1.5a1 1 0 1 0 1.73 1A1 1 0 0 1 12 9a1 1 0 0 1 0 2a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-.18A3 3 0 0 0 12 7"})}),ix=({refetch:s,isSortMode:t=!1})=>[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:t?"cursor-move":"opacity-0",children:e.jsx(ht,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:a})=>e.jsx(V,{column:a,title:"ID"}),cell:({row:a})=>e.jsx(M,{variant:"outline",children:a.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"enable",header:({column:a})=>e.jsx(V,{column:a,title:"启用"}),cell:({row:a})=>e.jsx(L,{defaultChecked:a.getValue("enable"),onCheckedChange:async()=>{const{data:n}=await xc({id:a.original.id});n||s()}}),enableSorting:!1,size:100},{accessorKey:"name",header:({column:a})=>e.jsx(V,{column:a,title:"显示名称"}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:a.getValue("name")})}),enableSorting:!1,size:200},{accessorKey:"payment",header:({column:a})=>e.jsx(V,{column:a,title:"支付接口"}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:a.getValue("payment")})}),enableSorting:!1,size:200},{accessorKey:"notify_url",header:({column:a})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{column:a,title:"通知地址"}),e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{className:"ml-1",children:e.jsx(hr,{className:"h-4 w-4"})}),e.jsx(ne,{children:"支付网关将会把数据通知到本地址，请通过防火墙放行本地址。"})]})})]}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[300px] truncate font-medium",children:a.getValue("notify_url")})}),enableSorting:!1,size:3e3},{id:"actions",header:({column:a})=>e.jsx(V,{className:"justify-end",column:a,title:"操作"}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(rr,{refetch:s,dialogTrigger:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]}),type:"edit",defaultFormValues:a.original}),e.jsx(Ae,{title:"删除确认",description:"确定要删除该支付方式吗？此操作无法撤销。",onConfirm:async()=>{const{data:n}=await dc({id:a.original.id});n&&s()},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]}),size:100}];function ox({table:s,refetch:t,saveOrder:a,isSortMode:n}){const r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[n?e.jsx("p",{className:"text-sm text-muted-foreground",children:"拖拽支付方式进行排序，完成后点击保存"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rr,{refetch:t}),e.jsx(C,{placeholder:"搜索支付方式...",value:s.getColumn("name")?.getFilterValue()??"",onChange:l=>s.getColumn("name")?.setFilterValue(l.target.value),className:"h-8 w-[250px]"}),r&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(k,{size:"sm",variant:n?"default":"outline",onClick:a,children:n?"保存排序":"编辑排序"})})]})}function cx(){const[s,t]=o.useState([]),[a,n]=o.useState([]),[r,l]=o.useState(!1),[c,x]=o.useState([]),[u,b]=o.useState({"drag-handle":!1}),{refetch:p}=G({queryKey:["paymentList"],queryFn:async()=>{const{data:T}=await lc();return x(T?.map(m=>({...m,enable:!!m.enable}))||[]),T}});o.useEffect(()=>{b({"drag-handle":r})},[r]);const y=(T,m)=>{r&&(T.dataTransfer.setData("text/plain",m.toString()),T.currentTarget.classList.add("opacity-50"))},_=(T,m)=>{if(!r)return;T.preventDefault(),T.currentTarget.classList.remove("bg-muted");const d=parseInt(T.dataTransfer.getData("text/plain"));if(d===m)return;const N=[...c],[w]=N.splice(d,1);N.splice(m,0,w),x(N)},D=async()=>{if(r)try{await mc({ids:c.map(T=>T.id)}),await p(),l(!1),z.success("排序保存成功")}catch{z.error("排序保存失败")}else l(!0)},F=Fe({data:c,columns:ix({refetch:p,isSortMode:r}),state:{sorting:a,columnFilters:s,columnVisibility:u},onSortingChange:n,onColumnFiltersChange:t,onColumnVisibilityChange:b,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),initialState:{pagination:{pageSize:10},columnPinning:{right:["actions"]}},pageCount:r?1:void 0});return e.jsx($e,{table:F,toolbar:T=>e.jsx(ox,{table:T,refetch:p,saveOrder:D,isSortMode:r}),draggable:r,onDragStart:y,onDragEnd:T=>T.currentTarget.classList.remove("opacity-50"),onDragOver:T=>{T.preventDefault(),T.currentTarget.classList.add("bg-muted")},onDragLeave:T=>T.currentTarget.classList.remove("bg-muted"),onDrop:_,showPagination:!r})}function dx(){return e.jsxs(ge,{children:[e.jsxs(fe,{className:"flex items-center justify-between",children:[e.jsx(Ne,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{children:[e.jsx("header",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"支付配置"})}),e.jsx("p",{className:"text-muted-foreground",children:"在这里可以配置支付方式，包括支付宝、微信等。"})]})}),e.jsx("section",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(cx,{})})]})]})}const xx=Object.freeze(Object.defineProperty({__proto__:null,default:dx},Symbol.toStringTag,{value:"Module"}));function mx({themeKey:s,themeInfo:t}){const[a,n]=o.useState(!1),[r,l]=o.useState(!1),[c,x]=o.useState(!1),u=Z({defaultValues:t.configs.reduce((y,_)=>(y[_.field_name]="",y),{})}),b=async()=>{try{l(!0);const{data:y}=await qo(s);Object.entries(y).forEach(([_,D])=>{u.setValue(_,D)})}catch{z.error("加载主题配置失败"),n(!1)}finally{l(!1)}},p=async y=>{try{x(!0),Bo(s,y).then(()=>{z.success("保存成功"),n(!1)})}catch{z.error("保存失败")}finally{x(!1)}};return e.jsxs(de,{open:a,onOpenChange:y=>{n(y),y?b():u.reset()},children:[e.jsx(Se,{asChild:!0,children:e.jsx(k,{variant:"outline",children:"主题设置"})}),e.jsxs(re,{className:"max-h-[90vh] overflow-auto sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsxs(xe,{children:["配置",t.name,"主题"]}),e.jsx(Ve,{children:"修改主题的样式、布局和其他显示选项。"})]}),r?e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(gn,{className:"h-6 w-6 animate-spin"})}):e.jsx(ee,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(p),className:"space-y-4",children:[t.configs.map(y=>e.jsx(j,{control:u.control,name:y.field_name,render:({field:_})=>e.jsxs(h,{children:[e.jsx(g,{children:y.label}),e.jsx(v,{children:nr(y,_)}),e.jsx(S,{})]})},y.field_name)),e.jsxs(ke,{className:"mt-6 gap-2",children:[e.jsx(k,{type:"button",variant:"secondary",onClick:()=>n(!1),children:"取消"}),e.jsx(k,{type:"submit",loading:c,children:"保存"})]})]})})]})]})}function ux(){const[s,t]=o.useState(null),[a,n]=o.useState(!1),[r,l]=o.useState(!1),[c,x]=o.useState(!1),u=o.useRef(null),{data:b,isLoading:p,refetch:y}=G({queryKey:["themeList"],queryFn:async()=>{const{data:m}=await Uo();return m}}),_=async m=>{try{t(m),await Jo({frontend_theme:m}),z.success("主题切换成功"),y()}catch{z.error("主题切换失败")}finally{t(null)}},D=async m=>{if(!m.name.endsWith(".zip")){z.error("只支持上传 ZIP 格式的主题文件");return}try{n(!0),await Yo(m),z.success("主题上传成功"),l(!1),y()}catch{z.error("主题上传失败")}finally{n(!1),u.current&&(u.current.value="")}},F=m=>{m.preventDefault(),m.stopPropagation(),m.type==="dragenter"||m.type==="dragover"?x(!0):m.type==="dragleave"&&x(!1)},T=m=>{m.preventDefault(),m.stopPropagation(),x(!1),m.dataTransfer.files&&m.dataTransfer.files[0]&&D(m.dataTransfer.files[0])};return e.jsxs(ge,{children:[e.jsxs(fe,{className:"flex items-center justify-between",children:[e.jsx(Ne,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"主题配置"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground",children:"主题配置，包括主题色、字体大小等。如果你采用前后分离的方式部署V2board，那么主题配置将不会生效。"}),e.jsxs(k,{onClick:()=>l(!0),variant:"outline",className:"ml-4 shrink-0",size:"sm",children:[e.jsx(ua,{className:"mr-2 h-4 w-4"}),"上传主题"]})]})]}),e.jsx("section",{className:"grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:p?e.jsxs(e.Fragment,{children:[e.jsx(wa,{}),e.jsx(wa,{})]}):b?.themes&&Object.entries(b.themes).map(([m,d])=>e.jsxs(ze,{className:"relative transition-shadow hover:shadow-md",children:[m!==b.active&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(Ae,{title:"删除主题",description:"确定要删除该主题吗？删除后无法恢复。",confirmText:"删除",variant:"destructive",onConfirm:async()=>{if(m===b?.active){z.error("不能删除当前使用的主题");return}t(m),Wo(m).then(()=>{z.success("主题删除成功"),y()}).catch(()=>{z.error("主题删除失败")}).finally(()=>{t(null)})},children:e.jsx(k,{disabled:s===m,loading:s===m,variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(Je,{className:"h-4 w-4"})})})}),e.jsxs(Ke,{children:[e.jsx(os,{children:d.name}),e.jsx(Rn,{children:d.description})]}),e.jsxs(Ge,{className:"flex items-center justify-end space-x-3",children:[e.jsx(mx,{themeKey:m,themeInfo:d}),e.jsx(k,{onClick:()=>_(m),disabled:s===m||m===b.active,loading:s===m,variant:m===b.active?"secondary":"default",children:m===b.active?"当前主题":"激活主题"})]})]},m))}),e.jsx(de,{open:r,onOpenChange:l,children:e.jsxs(re,{className:"sm:max-w-md",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"上传主题"}),e.jsx(Ve,{children:"请上传一个有效的主题压缩包（.zip 格式）。主题包应包含完整的主题文件结构。"})]}),e.jsxs("div",{className:f("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",c&&"border-primary/50 bg-muted/50"),onDragEnter:F,onDragLeave:F,onDragOver:F,onDrop:T,children:[e.jsx("input",{type:"file",ref:u,className:"hidden",accept:".zip",onChange:m=>{const d=m.target.files?.[0];d&&D(d)}}),a?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"正在上传..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(ua,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium",children:["将主题文件拖放到此处，或者",e.jsx("button",{type:"button",onClick:()=>u.current?.click(),className:"mx-1 text-primary hover:underline",children:"点击选择"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"支持 .zip 格式的主题包"})]})]})})]})]})})]})]})}function wa(){return e.jsxs(ze,{children:[e.jsxs(Ke,{children:[e.jsx(Te,{className:"h-6 w-[200px]"}),e.jsx(Te,{className:"h-4 w-[300px]"})]}),e.jsxs(Ge,{className:"flex items-center justify-end space-x-3",children:[e.jsx(Te,{className:"h-10 w-[100px]"}),e.jsx(Te,{className:"h-10 w-[100px]"})]})]})}const hx=Object.freeze(Object.defineProperty({__proto__:null,default:ux},Symbol.toStringTag,{value:"Module"})),Qt=o.forwardRef(({className:s,value:t,onChange:a,...n},r)=>{const[l,c]=o.useState("");o.useEffect(()=>{if(l.includes(",")){const u=new Set([...t,...l.split(",").map(b=>b.trim())]);a(Array.from(u)),c("")}},[l,a,t]);const x=()=>{if(l){const u=new Set([...t,l]);a(Array.from(u)),c("")}};return e.jsxs("div",{className:f(" has-[:focus-visible]:outline-none has-[:focus-visible]:ring-1 has-[:focus-visible]:ring-neutral-950  dark:has-[:focus-visible]:ring-neutral-300  flex w-full flex-wrap gap-2 rounded-md border border-input shadow-sm px-3 py-2 text-sm ring-offset-white  disabled:cursor-not-allowed disabled:opacity-50",s),children:[t.map(u=>e.jsxs(M,{variant:"secondary",children:[u,e.jsx(A,{variant:"ghost",size:"icon",className:"ml-2 h-3 w-3",onClick:()=>{a(t.filter(b=>b!==u))},children:e.jsx(Mt,{className:"w-3"})})]},u)),e.jsx("input",{className:"flex-1 outline-none placeholder:text-muted-foreground bg-transparent",value:l,onChange:u=>c(u.target.value),onKeyDown:u=>{u.key==="Enter"||u.key===","?(u.preventDefault(),x()):u.key==="Backspace"&&l.length===0&&t.length>0&&(u.preventDefault(),a(t.slice(0,-1)))},...n,ref:r})]})});Qt.displayName="InputTags";const jx=i.object({id:i.number().nullable(),title:i.string().min(1).max(250),content:i.string().min(1),show:i.boolean(),tags:i.array(i.string()),img_url:i.string().nullable()}),gx={id:null,show:!1,tags:[],img_url:"",title:"",content:""};function jr({refetch:s,dialogTrigger:t,type:a="add",defaultFormValues:n=gx}){const[r,l]=o.useState(!1),c=Z({resolver:Q(jx),defaultValues:n,mode:"onChange",shouldFocusError:!0});return e.jsx(ee,{...c,children:e.jsxs(de,{onOpenChange:l,open:r,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"})," ",e.jsx("div",{children:"添加公告"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:a==="add"?"添加公告":"编辑公告"}),e.jsx(Ve,{})]}),e.jsx(j,{control:c.control,name:"title",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"标题"}),e.jsx("div",{className:"relative ",children:e.jsx(v,{children:e.jsx(C,{placeholder:"请输入公告标题",...x})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"content",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"公告内容"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsx(us,{className:"min-h-[150px]",placeholder:"请输入公告内容，支持HTML",...x})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"img_url",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"公告背景"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsx(C,{type:"text",placeholder:"请输入公告背景图片URL",...x,value:x.value||""})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"show",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"显示"}),e.jsx("div",{className:"relative py-2",children:e.jsx(v,{children:e.jsx(L,{checked:x.value,onCheckedChange:x.onChange})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"tags",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"节点标签"}),e.jsx(v,{children:e.jsx(Qt,{value:x.value,onChange:x.onChange,placeholder:"输入后回车添加标签",className:"w-full"})}),e.jsx(S,{})]})}),e.jsxs(ke,{children:[e.jsx(Gs,{asChild:!0,children:e.jsx(k,{type:"button",variant:"outline",children:"取消"})}),e.jsx(k,{type:"submit",onClick:x=>{x.preventDefault(),c.handleSubmit(async u=>{try{(await hc(u)).data&&(await s(),l(!1))}catch(b){console.error("Failed to save notice:",b)}})()},children:"提交"})]})]})]})})}function fx({table:s,refetch:t}){const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between space-x-2 ",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(jr,{refetch:t}),e.jsx(C,{placeholder:"搜索公告标题...",value:s.getColumn("title")?.getFilterValue()??"",onChange:n=>s.getColumn("title")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),a&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-9 px-2 lg:px-3",children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("div",{className:"flex items-center space-x-2"})]})}const px=s=>[{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"ID"}),cell:({row:t})=>e.jsx(M,{variant:"outline",className:"font-mono",children:t.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"show",header:({column:t})=>e.jsx(V,{column:t,title:"显示状态"}),cell:({row:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx(L,{defaultChecked:t.getValue("show"),onCheckedChange:async()=>{const{data:a}=await gc({id:t.original.id});a||s()}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:t})=>e.jsx(V,{column:t,title:"标题"}),cell:({row:t})=>e.jsx("div",{className:"flex max-w-[500px] items-center",children:e.jsx("span",{className:"truncate font-medium",children:t.getValue("title")})}),enableSorting:!1,size:6e3},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(jr,{refetch:s,dialogTrigger:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]}),type:"edit",defaultFormValues:t.original}),e.jsx(Ae,{title:"删除确认",description:"确定要删除该条公告吗？此操作无法撤销。",onConfirm:async()=>{jc({id:t.original.id}).then(()=>{z.success("删除成功"),s()})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]}),size:100}];function vx(){const[s,t]=o.useState({}),[a,n]=o.useState({}),[r,l]=o.useState([]),[c,x]=o.useState([]),{data:u,isLoading:b,refetch:p}=G({queryKey:["notices"],queryFn:async()=>{const{data:_}=await uc();return _}}),y=Fe({data:u??[],columns:px(p),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx($e,{table:y,toolbar:_=>e.jsx(fx,{table:_,refetch:p})})}function bx(){return e.jsxs(ge,{children:[e.jsxs(fe,{className:"flex items-center justify-between",children:[e.jsx(Ne,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"公告管理"})}),e.jsx("p",{className:"text-muted-foreground",children:"在这里可以配置公告，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(vx,{})})]})]})}const yx=Object.freeze(Object.defineProperty({__proto__:null,default:bx},Symbol.toStringTag,{value:"Module"})),Nx=i.object({id:i.number().nullable(),language:i.string().max(250),category:i.string().max(250),title:i.string().min(1).max(250),body:i.string().min(1),show:i.boolean()}),wx={id:null,language:"zh-CN",category:"",title:"",body:"",show:!1};function gr({refreshData:s,dialogTrigger:t,type:a="add",defaultFormValues:n=wx}){const[r,l]=o.useState(!1),c=Z({resolver:Q(Nx),defaultValues:n,mode:"onChange",shouldFocusError:!0}),x=new fn({html:!0});return o.useEffect(()=>{r&&n.id&&pc(n.id).then(({data:u})=>{c.reset(u)})},[n.id,c,r]),e.jsxs(de,{onOpenChange:l,open:r,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"})," ",e.jsx("div",{children:"添加知识"})]})}),e.jsxs(re,{className:"sm:max-w-[1025px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:a==="add"?"添加知识":"编辑知识"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...c,children:[e.jsx(j,{control:c.control,name:"title",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"标题"}),e.jsx("div",{className:"relative ",children:e.jsx(v,{children:e.jsx(C,{placeholder:"请输入知识标题",...u})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"category",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"分类"}),e.jsx("div",{className:"relative ",children:e.jsx(v,{children:e.jsx(C,{placeholder:"请输入分类，分类将会自动归类",...u})})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"language",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"语言"}),e.jsx(v,{children:e.jsxs(B,{value:u.value,onValueChange:u.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择语言"})}),e.jsx(q,{children:[{field:"English",value:"en-US"},{field:"日本語",value:"ja-JP"},{field:"한국어",value:"ko-KR"},{field:"Tiếng Việt",value:"vi-VN"},{field:"简体中文",value:"zh-CN"},{field:"繁體中文",value:"zh-TW"}].map(b=>e.jsx(O,{value:b.value,className:"cursor-pointer",children:b.field},b.value))})]})})]})}),e.jsx(j,{control:c.control,name:"body",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"内容"}),e.jsx(v,{children:e.jsx(pn,{style:{height:"500px"},value:u.value,renderHTML:b=>x.render(b),onChange:({text:b})=>{u.onChange(b)}})}),e.jsx(S,{})]})}),e.jsx(j,{control:c.control,name:"show",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"显示"}),e.jsx("div",{className:"relative py-2",children:e.jsx(v,{children:e.jsx(L,{checked:u.value,onCheckedChange:u.onChange})})}),e.jsx(S,{})]})}),e.jsxs(ke,{children:[e.jsx(Gs,{asChild:!0,children:e.jsx(k,{type:"button",variant:"outline",children:"取消"})}),e.jsx(k,{type:"submit",onClick:()=>{c.handleSubmit(u=>{vc(u).then(({data:b})=>{b&&(c.reset(),z.success("操作成功"),l(!1),s())})})()},children:"提交"})]})]})]})]})}function _x({column:s,title:t,options:a}){const n=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),t,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(l=>r.has(l.value)).map(l=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:l.label},l.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(l=>{const c=r.has(l.value);return e.jsxs(ie,{onSelect:()=>{c?r.delete(l.value):r.add(l.value);const x=Array.from(r);s?.setFilterValue(x.length?x:void 0)},children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ds,{className:f("h-4 w-4")})}),l.icon&&e.jsx(l.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:l.label}),n?.get(l.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(l.value)})]},l.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function Cx({table:s,refetch:t,saveOrder:a,isSortMode:n}){const r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[n?e.jsx("p",{className:"text-sm text-muted-foreground",children:"拖拽知识条目进行排序，完成后点击保存"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{refreshData:t}),e.jsx(C,{placeholder:"搜索知识...",value:s.getColumn("title")?.getFilterValue()??"",onChange:l=>s.getColumn("title")?.setFilterValue(l.target.value),className:"h-8 w-[250px]"}),s.getColumn("category")&&e.jsx(_x,{column:s.getColumn("category"),title:"分类",options:Array.from(new Set(s.getCoreRowModel().rows.map(l=>l.getValue("category")))).map(l=>({label:l,value:l}))}),r&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(k,{variant:n?"default":"outline",onClick:a,size:"sm",children:n?"保存排序":"编辑排序"})})]})}const Sx=({refetch:s,isSortMode:t=!1})=>[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:t?"cursor-move":"opacity-0",children:e.jsx(ht,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:a})=>e.jsx(V,{column:a,title:"ID"}),cell:({row:a})=>e.jsx(M,{variant:"outline",className:"justify-center",children:a.getValue("id")}),enableSorting:!0,size:70},{accessorKey:"show",header:({column:a})=>e.jsx(V,{column:a,title:"状态"}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx(L,{defaultChecked:a.getValue("show"),onCheckedChange:async()=>{yc({id:a.original.id}).then(({data:n})=>{n||s()})}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:a})=>e.jsx(V,{column:a,title:"标题"}),cell:({row:a})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"line-clamp-2 font-medium",children:a.getValue("title")})}),enableSorting:!0,size:600},{accessorKey:"category",header:({column:a})=>e.jsx(V,{column:a,title:"分类"}),cell:({row:a})=>e.jsx(M,{variant:"secondary",className:"max-w-[180px] truncate",children:a.getValue("category")}),enableSorting:!0,size:1800},{id:"actions",header:({column:a})=>e.jsx(V,{className:"justify-end",column:a,title:"操作"}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(gr,{refreshData:s,dialogTrigger:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]}),type:"edit",defaultFormValues:a.original}),e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该知识库记录，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{bc({id:a.original.id}).then(({data:n})=>{n&&(z.success("删除成功"),s())})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]}),size:100}];function kx(){const[s,t]=o.useState([]),[a,n]=o.useState([]),[r,l]=o.useState(!1),[c,x]=o.useState([]),[u,b]=o.useState({"drag-handle":!1}),{refetch:p,isLoading:y,data:_}=G({queryKey:["knowledge"],queryFn:async()=>{const{data:d}=await fc();return x(d||[]),d}});o.useEffect(()=>{b({"drag-handle":r})},[r]);const D=(d,N)=>{r&&(d.dataTransfer.setData("text/plain",N.toString()),d.currentTarget.classList.add("opacity-50"))},F=(d,N)=>{if(!r)return;d.preventDefault(),d.currentTarget.classList.remove("bg-muted");const w=parseInt(d.dataTransfer.getData("text/plain"));if(w===N)return;const E=[...c],[H]=E.splice(w,1);E.splice(N,0,H),x(E)},T=async()=>{if(r)try{await Nc({ids:c.map(d=>d.id)}),await p(),l(!1),z.success("排序保存成功")}catch{z.error("排序保存失败")}else l(!0)},m=Fe({data:c,columns:Sx({refetch:p,isSortMode:r}),state:{sorting:a,columnFilters:s,columnVisibility:u},onSortingChange:n,onColumnFiltersChange:t,onColumnVisibilityChange:b,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),pagination:r?{pageSize:Number.MAX_SAFE_INTEGER,pageIndex:0}:void 0,initialState:{columnPinning:{right:["actions"]}}});return e.jsx($e,{table:m,toolbar:d=>e.jsx(Cx,{table:d,refetch:p,saveOrder:T,isSortMode:r}),draggable:r,onDragStart:D,onDragEnd:d=>d.currentTarget.classList.remove("opacity-50"),onDragOver:d=>{d.preventDefault(),d.currentTarget.classList.add("bg-muted")},onDragLeave:d=>d.currentTarget.classList.remove("bg-muted"),onDrop:F,showPagination:!r})}function Dx(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:"知识库管理"}),e.jsx("p",{className:"text-muted-foreground",children:"在这里可以配置知识库，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(kx,{})})]})]})}const Tx=Object.freeze(Object.defineProperty({__proto__:null,default:Dx},Symbol.toStringTag,{value:"Module"}));function Fx(s,t){const[a,n]=o.useState(s);return o.useEffect(()=>{const r=setTimeout(()=>n(s),t);return()=>{clearTimeout(r)}},[s,t]),a}function St(s,t){if(s.length===0)return{};if(!t)return{"":s};const a={};return s.forEach(n=>{const r=n[t]||"";a[r]||(a[r]=[]),a[r].push(n)}),a}function Px(s,t){const a=JSON.parse(JSON.stringify(s));for(const[n,r]of Object.entries(a))a[n]=r.filter(l=>!t.find(c=>c.value===l.value));return a}function Vx(s,t){for(const[,a]of Object.entries(s))if(a.some(n=>t.find(r=>r.value===n.value)))return!0;return!1}const fr=o.forwardRef(({className:s,...t},a)=>Fi(r=>r.filtered.count===0)?e.jsx("div",{ref:a,className:f("py-6 text-center text-sm",s),"cmdk-empty":"",role:"presentation",...t}):null);fr.displayName="CommandEmpty";const Hs=o.forwardRef(({value:s,onChange:t,placeholder:a,defaultOptions:n=[],options:r,delay:l,onSearch:c,loadingIndicator:x,emptyIndicator:u,maxSelected:b=Number.MAX_SAFE_INTEGER,onMaxSelected:p,hidePlaceholderWhenSelected:y,disabled:_,groupBy:D,className:F,badgeClassName:T,selectFirstItem:m=!0,creatable:d=!1,triggerSearchOnFocus:N=!1,commandProps:w,inputProps:E,hideClearAllButton:H=!1},je)=>{const He=o.useRef(null),[Vs,sa]=o.useState(!1),yt=o.useRef(!1),[ta,aa]=o.useState(!1),[K,Is]=o.useState(s||[]),[hs,na]=o.useState(St(n,D)),[as,Nt]=o.useState(""),zs=Fx(as,l||500);o.useImperativeHandle(je,()=>({selectedValue:[...K],input:He.current,focus:()=>He.current?.focus()}),[K]);const qs=o.useCallback($=>{const W=K.filter(ye=>ye.value!==$.value);Is(W),t?.(W)},[t,K]),Ur=o.useCallback($=>{const W=He.current;W&&(($.key==="Delete"||$.key==="Backspace")&&W.value===""&&K.length>0&&(K[K.length-1].fixed||qs(K[K.length-1])),$.key==="Escape"&&W.blur())},[qs,K]);o.useEffect(()=>{s&&Is(s)},[s]),o.useEffect(()=>{if(!r||c)return;const $=St(r||[],D);JSON.stringify($)!==JSON.stringify(hs)&&na($)},[n,r,D,c,hs]),o.useEffect(()=>{const $=async()=>{aa(!0);const ye=await c?.(zs);na(St(ye||[],D)),aa(!1)};(async()=>{!c||!Vs||(N&&await $(),zs&&await $())})()},[zs,D,Vs,N]);const qr=()=>{if(!d||Vx(hs,[{value:as,label:as}])||K.find(W=>W.value===as))return;const $=e.jsx(ie,{value:as,className:"cursor-pointer",onMouseDown:W=>{W.preventDefault(),W.stopPropagation()},onSelect:W=>{if(K.length>=b){p?.(K.length);return}Nt("");const ye=[...K,{value:W,label:W}];Is(ye),t?.(ye)},children:`Create "${as}"`});if(!c&&as.length>0||c&&zs.length>0&&!ta)return $},Br=o.useCallback(()=>{if(u)return c&&!d&&Object.keys(hs).length===0?e.jsx(ie,{value:"-",disabled:!0,children:u}):e.jsx(fr,{children:u})},[d,u,c,hs]),Yr=o.useMemo(()=>Px(hs,K),[hs,K]),Wr=o.useCallback(()=>{if(w?.filter)return w.filter;if(d)return($,W)=>$.toLowerCase().includes(W.toLowerCase())?1:-1},[d,w?.filter]),Jr=o.useCallback(()=>{const $=K.filter(W=>W.fixed);Is($),t?.($)},[t,K]);return e.jsxs(Qe,{...w,onKeyDown:$=>{Ur($),w?.onKeyDown?.($)},className:f("h-auto overflow-visible bg-transparent",w?.className),shouldFilter:w?.shouldFilter!==void 0?w.shouldFilter:!c,filter:Wr(),children:[e.jsx("div",{className:f("rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring ",{"px-3 py-2":K.length!==0,"cursor-text":!_&&K.length!==0},F),onClick:()=>{_||He.current?.focus()},children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[K.map($=>e.jsxs(M,{className:f("data-[disabled]:bg-muted-foreground data-[disabled]:text-muted data-[disabled]:hover:bg-muted-foreground","data-[fixed]:bg-muted-foreground data-[fixed]:text-muted data-[fixed]:hover:bg-muted-foreground",T),"data-fixed":$.fixed,"data-disabled":_||void 0,children:[$.label,e.jsx("button",{className:f("ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",(_||$.fixed)&&"hidden"),onKeyDown:W=>{W.key==="Enter"&&qs($)},onMouseDown:W=>{W.preventDefault(),W.stopPropagation()},onClick:()=>qs($),children:e.jsx(Mt,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},$.value)),e.jsx(ve.Input,{...E,ref:He,value:as,disabled:_,onValueChange:$=>{Nt($),E?.onValueChange?.($)},onBlur:$=>{yt.current===!1&&sa(!1),E?.onBlur?.($)},onFocus:$=>{sa(!0),N&&c?.(zs),E?.onFocus?.($)},placeholder:y&&K.length!==0?"":a,className:f("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":y,"px-3 py-2":K.length===0,"ml-1":K.length!==0},E?.className)}),e.jsx("button",{type:"button",onClick:Jr,className:f((H||_||K.length<1||K.filter($=>$.fixed).length===K.length)&&"hidden"),children:e.jsx(Mt,{})})]})}),e.jsx("div",{className:"relative",children:Vs&&e.jsx(es,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",onMouseLeave:()=>{yt.current=!1},onMouseEnter:()=>{yt.current=!0},onMouseUp:()=>{He.current?.focus()},children:ta?e.jsx(e.Fragment,{children:x}):e.jsxs(e.Fragment,{children:[Br(),qr(),!m&&e.jsx(ie,{value:"-",className:"hidden"}),Object.entries(Yr).map(([$,W])=>e.jsx(pe,{heading:$,className:"h-full overflow-auto",children:e.jsx(e.Fragment,{children:W.map(ye=>e.jsx(ie,{value:ye.value,disabled:ye.disable,onMouseDown:Rs=>{Rs.preventDefault(),Rs.stopPropagation()},onSelect:()=>{if(K.length>=b){p?.(K.length);return}Nt("");const Rs=[...K,ye];Is(Rs),t?.(Rs)},className:f("cursor-pointer",ye.disable&&"cursor-default text-muted-foreground"),children:ye.label},ye.value))})},$))]})})})]})});Hs.displayName="MultipleSelector";const Ix=i.object({id:i.number().optional(),name:i.string().min(2,"组名至少需要2个字符").max(50,"组名不能超过50个字符").regex(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/,"组名只能包含字母、数字、中文、下划线和连字符")});function bt({refetch:s,dialogTrigger:t,defaultValues:a={name:""},type:n="add"}){const r=Z({resolver:Q(Ix),defaultValues:a,mode:"onChange"}),[l,c]=o.useState(!1),[x,u]=o.useState(!1),b=async p=>{try{u(!0);const{data:y}=await tc(p);y&&(z.success(n==="edit"?"更新成功":"创建成功"),s&&s(),r.reset(),c(!1))}catch{z.error("操作失败，请重试")}finally{u(!1)}};return e.jsxs(de,{open:l,onOpenChange:c,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add",className:"h-4 w-4"}),e.jsx("span",{children:"添加权限组"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:n==="edit"?"编辑权限组":"创建权限组"}),e.jsx(Ve,{children:n==="edit"?"修改权限组信息，更新后会立即生效。":"创建新的权限组，可以为不同的用户分配不同的权限。"})]}),e.jsx(ee,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(b),className:"space-y-4",children:[e.jsx(j,{control:r.control,name:"name",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"组名称"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入权限组名称",...p,className:"w-full"})}),e.jsx(P,{children:"权限组名称用于标识不同的用户组，建议使用有意义的名称。"}),e.jsx(S,{})]})}),e.jsxs(ke,{className:"gap-2",children:[e.jsx(Gs,{asChild:!0,children:e.jsx(k,{type:"button",variant:"outline",children:"取消"})}),e.jsxs(k,{type:"submit",disabled:x||!r.formState.isValid,children:[x&&e.jsx(gn,{className:"mr-2 h-4 w-4 animate-spin"}),n==="edit"?"更新":"创建"]})]})]})})]})]})}function kt({dialogTrigger:s,state:t,setState:a,templateType:n}){const[r,l]=o.useState(!1),[c,x]=o.useState(typeof t=="object"?JSON.stringify(t,null,2):t),[u,b]=o.useState(null),p=m=>{if(!m)return null;try{const d=JSON.parse(m);return typeof d!="object"||d===null?"配置必须是一个JSON对象":null}catch{return"无效的JSON格式"}},y={tcp:{label:"TCP",content:{acceptProxyProtocol:!1,header:{type:"none"}}},"tcp-http":{label:"TCP + HTTP",content:{acceptProxyProtocol:!1,header:{type:"http",request:{version:"1.1",method:"GET",path:["/"],headers:{Host:["www.example.com"]}},response:{version:"1.1",status:"200",reason:"OK"}}}},grpc:{label:"gRPC",content:{serviceName:"GunService"}},ws:{label:"WebSocket",content:{path:"/",headers:{Host:"v2ray.com"}}}},_=()=>{switch(n){case"tcp":return["tcp","tcp-http"];case"grpc":return["grpc"];case"ws":return["ws"];default:return[]}},D=()=>{const m=p(c||"");if(m){z.error(m);return}try{if(!c){a(""),l(!1);return}a(JSON.parse(c)),l(!1)}catch{z.error("保存时发生错误")}},F=m=>{x(m),b(p(m))},T=m=>{const d=y[m];if(d){const N=JSON.stringify(d.content,null,2);x(N),b(null)}};return e.jsxs(de,{open:r,onOpenChange:m=>{!m&&r&&D(),l(m)},children:[e.jsx(Se,{asChild:!0,children:s??e.jsx(A,{variant:"link",children:"编辑协议"})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsx(he,{children:e.jsx(xe,{children:"编辑协议配置"})}),e.jsxs("div",{className:"space-y-4",children:[_().length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:_().map(m=>e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>T(m),children:["使用",y[m].label,"模板"]},m))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(us,{className:`min-h-[200px] font-mono text-sm ${u?"border-red-500 focus-visible:ring-red-500":""}`,value:c,placeholder:`请输入JSON配置${_().length>0?"或选择上方模板":""}`,onChange:m=>F(m.target.value)}),u&&e.jsx("p",{className:"text-sm text-red-500",children:u})]})]}),e.jsxs(ke,{className:"gap-2",children:[e.jsx(A,{variant:"outline",onClick:()=>l(!1),children:"取消"}),e.jsx(A,{onClick:D,disabled:!!u,children:"确定"})]})]})]})}const zx=({serverType:s,state:t,setState:a})=>{const n=i.object({cipher:i.string(),obfs:i.string().optional(),obfs_settings:i.object({path:i.string(),host:i.string()}).optional()}),r={cipher:"aes-128-gcm",obfs:"",obfs_settings:{path:"",host:""}},l=i.object({tls:i.string(),network:i.string(),network_settings:i.string().optional(),tls_settings:i.object({server_name:i.string(),allow_insecure:i.boolean()}).optional()}),c={tls:"0",network:"tcp",network_settings:"",tls_settings:{server_name:"",allow_insecure:!1}},x=i.object({allow_insecure:i.boolean(),network:i.string(),networkSettings:i.string().optional(),server_name:i.string().optional()}),u={allow_insecure:!1,network:"tcp",networkSettings:"",server_name:""},b=i.object({version:i.string(),obfs:i.object({open:i.boolean(),type:i.string().optional(),password:i.string().optional()}).optional(),tls:i.object({allow_insecure:i.boolean(),server_name:i.string().optional()}).optional(),bandwidth:i.object({up:i.union([i.number(),i.string()]).optional(),down:i.union([i.number(),i.string()]).optional()}),alpn:i.string().optional()}),p={version:"2",obfs:{open:!1,type:"",password:""},tls:{allow_insecure:!1,server_name:""},bandwidth:{up:"",down:""},alpn:"hysteria"},y=i.object({tls:i.string(),network:i.string(),network_settings:i.string().optional(),flow:i.string().optional(),tls_settings:i.object({server_name:i.string().optional(),allow_insecure:i.boolean()}),reality_settings:i.object({dest:i.string(),allow_insecure:i.boolean(),public_key:i.string().optional(),private_key:i.string().optional(),short_id:i.string().optional()}).optional()}),_={tls:"0",network:"tcp",network_settings:"",flow:"",tls_settings:{server_name:"",allow_insecure:!1},reality_settings:{dest:"",allow_insecure:!1,public_key:"",private_key:"",short_id:""}},D=()=>{let d,N;switch(s){case"shadowsocks":d=n,N=r;break;case"vmess":d=l,N=c;break;case"trojan":d=x,N=u;break;case"hysteria":d=b,N=p;break;case"vless":d=y,N=_;break}return{formSchema:d,initialValues:N}},{formSchema:F,initialValues:T}=D(),m=Z({resolver:Q(F),defaultValues:JSON.stringify(t)!=="{}"?t:T,mode:"onChange"});return o.useEffect(()=>{if(JSON.stringify(t)==="{}"){const{initialValues:d}=D();m.reset(d),a(d)}},[s]),o.useEffect(()=>{a(m.getValues())},[]),m.watch(d=>a(d)),e.jsxs(e.Fragment,{children:[s==="shadowsocks"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:m.control,name:"cipher",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"加密算法"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择加密算法"})}),e.jsx(q,{children:e.jsx(rs,{children:["aes-128-gcm","aes-192-gcm","aes-256-gcm","chacha20-ietf-poly1305","2022-blake3-aes-128-gcm","2022-blake3-aes-256-gcm"].map(N=>e.jsx(O,{value:N,children:N},N))})})]})})})]})}),e.jsx(j,{control:m.control,name:"obfs",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:" 混淆 "}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:d.onChange,defaultValue:d.value||"0",children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择混淆方式"})}),e.jsx(q,{children:e.jsxs(rs,{children:[e.jsx(O,{value:"0",children:"无"}),e.jsx(O,{value:"http",children:"HTTP"})]})})]})})})]})}),m.watch("obfs")=="http"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"obfs_settings.path",render:({field:d})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx("div",{className:"relative ",children:e.jsx(v,{children:e.jsx(C,{type:"text",placeholder:"路径",...d})})}),e.jsx(S,{})]})}),e.jsx(j,{control:m.control,name:"obfs_settings.host",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx("div",{className:"relative flex ",children:e.jsx(v,{children:e.jsx(C,{type:"text",placeholder:"Host",...d})})}),e.jsx(S,{})]})})]})]}),s==="vmess"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:m.control,name:"tls",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"TLS"}),e.jsx("div",{className:"",children:e.jsx(v,{children:e.jsxs(B,{value:d.value,onValueChange:d.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择安全性"})}),e.jsxs(q,{children:[e.jsx(O,{value:"0",children:"不支持"}),e.jsx(O,{value:"1",children:"支持"})]})]})})})]})}),m.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"tls_settings.server_name",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsx(C,{placeholder:"不使用请留空",...d})})})]})}),e.jsx(j,{control:m.control,name:"tls_settings.allow_insecure",render:({field:d})=>e.jsxs(h,{className:"",children:[e.jsx(g,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(v,{children:e.jsx(L,{onCheckedChange:d.onChange,checked:d.value})})})]})})]}),e.jsx(j,{control:m.control,name:"network",render:({field:d})=>e.jsxs(h,{children:[e.jsxs(g,{children:["传输协议",e.jsx(kt,{state:m.getValues("network_settings"),setState:N=>m.setValue("network_settings",N),templateType:m.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择传输协议"})}),e.jsx(q,{children:e.jsx(rs,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(N=>e.jsx(O,{value:N.value,className:"cursor-pointer",children:N.label},N.value))})})]})})})]})})]}),s==="trojan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"server_name",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{className:"leading-loose",children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsx(C,{placeholder:"当节点地址于证书不一致时用于证书验证",...d})})})]})}),e.jsx(j,{control:m.control,name:"allow_insecure",render:({field:d})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(g,{className:"leading-loose",children:"允许不安全?"}),e.jsx("div",{className:"flex flex-[1] items-center justify-center",children:e.jsx(v,{children:e.jsx(L,{onCheckedChange:d.onChange,checked:d.value})})})]})})]}),e.jsx(j,{control:m.control,name:"network",render:({field:d})=>e.jsxs(h,{children:[e.jsxs(g,{children:["传输协议",e.jsx(kt,{state:m.getValues("network_settings"),setState:N=>m.setValue("network_settings",N),templateType:m.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择传输协议"})}),e.jsx(q,{children:e.jsx(rs,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(N=>e.jsx(O,{value:N.value,className:"cursor-pointer",children:N.label},N.value))})})]})})})]})})]}),s==="hysteria"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"version",render:({field:d})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx(g,{children:"协议版本"}),e.jsx(v,{children:e.jsxs(B,{value:d.value,onValueChange:d.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"协议版本"})}),e.jsx(q,{children:e.jsxs(rs,{children:[e.jsx(O,{value:"1",className:"cursor-pointer",children:"V1"}),e.jsx(O,{value:"2",className:"cursor-pointer",children:"V2"})]})})]})})]})}),m.watch("version")==="1"&&e.jsx(j,{control:m.control,name:"alpn",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"ALPN"}),e.jsx(v,{children:e.jsxs(B,{value:d.value,onValueChange:d.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"ALPN"})}),e.jsx(q,{children:e.jsxs(rs,{children:[e.jsx(O,{value:"hysteria",children:"hysteria"}),e.jsx(O,{value:"http/1.1",children:"http/1.1"}),e.jsx(O,{value:"h2",children:"h2"}),e.jsx(O,{value:"h3",children:"h3"})]})})]})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"obfs.open",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"混淆"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(v,{children:e.jsx(L,{checked:d.value,onCheckedChange:d.onChange})})})]})}),m.watch("obfs.open")==!0&&e.jsxs(e.Fragment,{children:[m.watch("version")=="2"&&e.jsx(j,{control:m.control,name:"obfs.type",render:({field:d})=>e.jsxs(h,{className:"flex-[1] ",children:[e.jsx(g,{children:"混淆实现"}),e.jsx(v,{children:e.jsxs(B,{value:d.value,onValueChange:d.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择混淆实现"})}),e.jsx(q,{children:e.jsx(rs,{children:e.jsx(O,{value:"salamander",children:"Salamander"})})})]})})]})}),e.jsx(j,{control:m.control,name:"obfs.password",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"混淆密码"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入混淆密码",...d})})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"tls.server_name",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsx(C,{placeholder:"当节点地址于证书不一致时用于证书验证",...d})})})]})}),e.jsx(j,{control:m.control,name:"tls.allow_insecure",render:({field:d})=>e.jsxs(h,{className:"",children:[e.jsx(g,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(v,{children:e.jsx(L,{className:"",onCheckedChange:d.onChange,checked:d.value})})})]})})]}),e.jsx(j,{control:m.control,name:"bandwidth.up",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"上行宽带"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"请输入上行宽带"+(m.watch("version")==="2"?"，留空则使用BBR":""),className:"rounded-br-none rounded-tr-none",...d})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:"Mbps"})})]})]})}),e.jsx(j,{control:m.control,name:"bandwidth.down",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"下行宽带"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"请输入下行宽带"+(m.watch("version")==="2"?"，留空则使用BBR":""),className:"rounded-br-none rounded-tr-none",...d})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:"Mbps"})})]})]})})]}),s==="vless"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:m.control,name:"tls",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"安全性"}),e.jsxs("div",{className:"",children:[e.jsx(v,{children:e.jsxs(B,{value:d.value.toString(),onValueChange:d.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择安全性"})}),e.jsxs(q,{children:[e.jsx(O,{value:"0",children:"无"}),e.jsx(O,{value:"1",children:"TLS"}),e.jsx(O,{value:"2",children:"Reality"})]})]})}),e.jsx(S,{})]})]})}),m.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"tls_settings.server_name",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"服务器名称指示(SNI)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsx(C,{placeholder:"不使用请留空",...d})})})]})}),e.jsx(j,{control:m.control,name:"tls_settings.allow_insecure",render:({field:d})=>e.jsxs(h,{className:"",children:[e.jsx(g,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(v,{children:e.jsx(L,{onCheckedChange:d.onChange,checked:d.value})})})]})})]}),m.watch("tls")=="2"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"reality_settings.dest",render:({field:d})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"伪装站点(dest)"}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsx(C,{placeholder:"例如：example.com:443",...d})})})]})}),e.jsx(j,{control:m.control,name:"reality_settings.allow_insecure",render:({field:d})=>e.jsxs(h,{className:"",children:[e.jsx(g,{children:"允许不安全?"}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(v,{children:e.jsx(L,{onCheckedChange:d.onChange,checked:d.value})})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:m.control,name:"reality_settings.private_key",render:({field:d})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(g,{children:"私钥(Private key)"}),e.jsx(v,{children:e.jsx(C,{...d})})]})}),e.jsx(A,{type:"button",variant:"outline",className:"self-end",onClick:()=>{const d=Pi(),N=btoa(String.fromCharCode.apply(null,Array.from(d.secretKey))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),w=btoa(String.fromCharCode.apply(null,Array.from(d.publicKey))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),E=Array.from(Vi(8)).map(H=>H.toString(16).padStart(2,"0")).join("");m.setValue("reality_settings.private_key",N),m.setValue("reality_settings.public_key",w),m.setValue("reality_settings.short_id",E)},children:"生成密钥"})]}),e.jsx(j,{control:m.control,name:"reality_settings.public_key",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"公钥(Public key)"}),e.jsx(v,{children:e.jsx(C,{...d})})]})}),e.jsx(j,{control:m.control,name:"reality_settings.short_id",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"Short ID"}),e.jsx(v,{children:e.jsx(C,{...d})})]})})]}),e.jsx(j,{control:m.control,name:"network",render:({field:d})=>e.jsxs(h,{children:[e.jsxs(g,{children:["传输协议",e.jsx(kt,{state:m.getValues("network_settings"),setState:N=>m.setValue("network_settings",N),templateType:m.getValues("network")})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"选择传输协议"})}),e.jsx(q,{children:e.jsx(rs,{children:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}].map(N=>e.jsx(O,{value:N.value,className:"cursor-pointer",children:N.label},N.value))})})]})})})]})}),e.jsx(j,{control:m.control,name:"flow",render:({field:d})=>e.jsxs(h,{children:[e.jsx(g,{children:"XTLS流控算法"}),e.jsx("div",{className:"",children:e.jsx(v,{children:e.jsxs(B,{value:d.value||"none",onValueChange:N=>{d.onChange(N==="none"?"":N)},children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择流控算法"})}),e.jsxs(q,{children:[e.jsx(O,{value:"none",children:"无"}),e.jsx(O,{value:"xtls-rprx-vision",children:"xtls-rprx-vision"})]})]})})})]})})]})]})},pr=o.createContext(void 0);function Rx({children:s,refreshData:t}){const[a,n]=o.useState(!1),[r,l]=o.useState(null),[c,x]=o.useState(me.Shadowsocks);return e.jsx(pr.Provider,{value:{isOpen:a,setIsOpen:n,editingServer:r,setEditingServer:l,serverType:c,setServerType:x,refreshData:t},children:s})}function vr(){const s=o.useContext(pr);if(s===void 0)throw new Error("useServerEdit must be used within a ServerEditProvider");return s}const Ex=i.object({id:i.number().optional().nullable(),code:i.string().optional(),name:i.string().min(1,"Please enter a valid name."),rate:i.string().min(1,"Please enter a valid rate."),tags:i.array(i.string()).default([]),excludes:i.array(i.string()).default([]),ips:i.array(i.string()).default([]),group_ids:i.array(i.string()).default([]),host:i.string().min(1,"Please enter a valid host."),port:i.string().min(1,"Please enter a valid port."),server_port:i.string().min(1,"Please enter a valid server port."),parent_id:i.string().default("0").nullable(),route_ids:i.array(i.string()).default([]),protocol_settings:i.record(i.any()).default({})}),Zs={id:null,code:"",name:"",rate:"1",tags:[],excludes:[],ips:[],group_ids:[],host:"",port:"",server_port:"",parent_id:"0",route_ids:[],protocol_settings:{}};function br(){const{isOpen:s,setIsOpen:t,editingServer:a,setEditingServer:n,serverType:r,setServerType:l,refreshData:c}=vr(),[x,u]=o.useState([]),[b,p]=o.useState([]),[y,_]=o.useState([]),D=Z({resolver:Q(Ex),defaultValues:{...Zs,...a||{}},mode:"onChange"}),F=async()=>{if(!s)return;const[w,E,H]=await Promise.all([pt(),Zn(),Jn()]);u(w.data?.map(je=>({label:je.name,value:je.id.toString()}))||[]),p(E.data?.map(je=>({label:je.remarks,value:je.id.toString()}))||[]),_(H.data||[])},T=o.useMemo(()=>y?.filter(w=>(w.parent_id===0||w.parent_id===null)&&w.type===r&&w.id!==D.watch("id")),[r,y,D]);o.useEffect(()=>{F()},[s]),o.useEffect(()=>{a?D.reset({...Zs,...a}):D.reset(Zs)},[a,D]);const m=()=>{t(!1),n(null),D.reset(Zs)},d=async()=>{try{const w=D.getValues();(await Zo({...w,type:r})).data&&(m(),z.success("提交成功"),c())}catch{z.error("提交失败")}},N=()=>e.jsxs(gs,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"}),e.jsx("div",{children:"添加节点"})]})}),e.jsx(cs,{align:"start",children:e.jsx(ko,{children:js.map(({type:w,label:E})=>e.jsx(ae,{onClick:()=>{l(w),t(!0)},className:"cursor-pointer",children:e.jsx(M,{variant:"outline",className:"text-white",style:{background:ls[w]},children:E})},w))})})]});return e.jsxs(de,{open:s,onOpenChange:m,children:[N(),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:a?"编辑节点":"新建节点"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...D,children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{control:D.control,name:"name",render:({field:w})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"节点名称"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入节点名称",...w})}),e.jsx(S,{})]})}),e.jsx(j,{control:D.control,name:"rate",render:({field:w})=>e.jsxs(h,{className:"flex-[1]",children:[e.jsx(g,{children:"倍率"}),e.jsx("div",{className:"relative flex",children:e.jsx(v,{children:e.jsx(C,{type:"number",min:"0",step:"0.1",...w})})}),e.jsx(S,{})]})})]}),e.jsx(j,{control:D.control,name:"code",render:({field:w})=>e.jsxs(h,{children:[e.jsxs(g,{children:["节点代码",e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(选填)"})]}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入节点唯一标识符",...w,value:w.value||""})}),e.jsx(S,{})]})}),e.jsx(j,{control:D.control,name:"tags",render:({field:w})=>e.jsxs(h,{children:[e.jsx(g,{children:"节点标签"}),e.jsx(v,{children:e.jsx(Qt,{value:w.value,onChange:w.onChange,placeholder:"输入后回车添加标签",className:"w-full"})}),e.jsx(S,{})]})}),e.jsx(j,{control:D.control,name:"group_ids",render:({field:w})=>e.jsxs(h,{children:[e.jsxs(g,{className:"flex items-center justify-between",children:["权限组",e.jsx(bt,{dialogTrigger:e.jsx(k,{variant:"link",children:"添加权限组"}),refetch:F})]}),e.jsx(v,{children:e.jsx(Hs,{options:x,onChange:E=>w.onChange(E.map(H=>H.value)),value:x?.filter(E=>w.value.includes(E.value)),placeholder:"请选择权限组",emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:"no results found."})})}),e.jsx(S,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{control:D.control,name:"host",render:({field:w})=>e.jsxs(h,{children:[e.jsx(g,{children:"节点地址"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入节点域名或者IP",...w})}),e.jsx(S,{})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{control:D.control,name:"port",render:({field:w})=>e.jsxs(h,{className:"flex-1",children:[e.jsxs(g,{className:"flex items-center gap-1.5",children:["连接端口",e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(Ce,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(ne,{side:"top",className:"max-w-80 p-3",children:e.jsx("p",{children:"用户实际连接使用的端口，这是客户端配置中需要填写的端口号。如果使用了中转或隧道，这个端口可能与服务器实际监听的端口不同。"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{children:e.jsx(C,{placeholder:"用户连接端口",...w})}),e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"size-6 shrink-0 text-muted-foreground/50 hover:text-muted-foreground",onClick:()=>{const E=w.value;E&&D.setValue("server_port",E)},children:e.jsx(Ce,{icon:"tabler:arrows-right",className:"size-3"})})}),e.jsx(ne,{side:"right",children:e.jsx("p",{children:"同步到服务端口"})})]})})]}),e.jsx(S,{})]})}),e.jsx(j,{control:D.control,name:"server_port",render:({field:w})=>e.jsxs(h,{className:"flex-1",children:[e.jsxs(g,{className:"flex items-center gap-1.5",children:["服务端口",e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(Ce,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(ne,{side:"top",className:"max-w-80 p-3",children:e.jsx("p",{children:"服务器实际监听的端口，这是在服务器上开放的真实端口。如果使用了中转或隧道，这个端口可能与用户连接端口不同。"})})]})})]}),e.jsx(v,{children:e.jsx(C,{placeholder:"服务端开放端口",...w})}),e.jsx(S,{})]})})]})]}),e.jsx(zx,{serverType:r,setState:w=>D.setValue("protocol_settings",w),state:D.getValues("protocol_settings")}),e.jsx(j,{control:D.control,name:"parent_id",render:({field:w})=>e.jsxs(h,{children:[e.jsx(g,{children:"父节点"}),e.jsxs(B,{onValueChange:w.onChange,value:w.value||"0",children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(Y,{placeholder:"选择父节点"})})}),e.jsxs(q,{children:[e.jsx(O,{value:"0",children:"无"}),T?.map(E=>e.jsx(O,{value:E.id.toString(),className:"cursor-pointer",children:E.name},E.id))]})]}),e.jsx(S,{})]})}),e.jsx(j,{control:D.control,name:"route_ids",render:({field:w})=>e.jsxs(h,{children:[e.jsx(g,{children:"路由组"}),e.jsx(v,{children:e.jsx(Hs,{options:b,onChange:E=>w.onChange(E.map(H=>H.value)),value:b?.filter(E=>w.value.includes(E.value)),placeholder:"选择路由组",emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:"no results found."})})}),e.jsx(S,{})]})})]}),e.jsxs(ke,{className:"mt-6",children:[e.jsx(k,{type:"button",variant:"outline",onClick:m,children:"取消"}),e.jsx(k,{type:"submit",onClick:d,children:"提交"})]})]})]})]})}function _a({column:s,title:t,options:a}){const n=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),t,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(l=>r.has(l.value)).map(l=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:l.label},l.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(l=>{const c=r.has(l.value);return e.jsxs(ie,{onSelect:()=>{c?r.delete(l.value):r.add(l.value);const x=Array.from(r);s?.setFilterValue(x.length?x:void 0)},className:"cursor-pointer",children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ds,{className:f("h-4 w-4")})}),l.icon&&e.jsx(l.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${l.color}`}),e.jsx("span",{children:l.label}),n?.get(l.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(l.value)})]},l.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center cursor-pointer",children:"Clear filters"})})]})]})]})})]})}const Mx=[{value:me.Shadowsocks,label:js.find(s=>s.type===me.Shadowsocks)?.label,color:ls[me.Shadowsocks]},{value:me.Vmess,label:js.find(s=>s.type===me.Vmess)?.label,color:ls[me.Vmess]},{value:me.Trojan,label:js.find(s=>s.type===me.Trojan)?.label,color:ls[me.Trojan]},{value:me.Hysteria,label:js.find(s=>s.type===me.Hysteria)?.label,color:ls[me.Hysteria]},{value:me.Vless,label:js.find(s=>s.type===me.Vless)?.label,color:ls[me.Vless]}];function Ox({table:s,refetch:t,saveOrder:a,isSortMode:n,groups:r}){const l=s.getState().columnFilters.length>0,c=r.map(x=>({label:x,value:x}));return e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx(br,{refetch:t}),e.jsx(C,{placeholder:"搜索节点...",value:s.getColumn("name")?.getFilterValue()??"",onChange:x=>s.getColumn("name")?.setFilterValue(x.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("type")&&e.jsx(_a,{column:s.getColumn("type"),title:"类型",options:Mx}),s.getColumn("groups")&&e.jsx(_a,{column:s.getColumn("groups"),title:"权限组",options:c})]}),l&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]}),n&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"拖拽节点进行排序，完成后点击保存"})})]}),e.jsx("div",{children:e.jsx(k,{size:"sm",variant:n?"default":"outline",className:"ml-auto hidden h-8 lg:flex",onClick:a,children:n?"保存排序":"编辑排序"})})]})}const Ks=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.71 12.71a6 6 0 1 0-7.42 0a10 10 0 0 0-6.22 8.18a1 1 0 0 0 2 .22a8 8 0 0 1 15.9 0a1 1 0 0 0 1 .89h.11a1 1 0 0 0 .88-1.1a10 10 0 0 0-6.25-8.19M12 12a4 4 0 1 1 4-4a4 4 0 0 1-4 4"})}),Xs={0:"bg-destructive/80 shadow-sm shadow-destructive/50",1:"bg-yellow-500/80 shadow-sm shadow-yellow-500/50",2:"bg-emerald-500/80 shadow-sm shadow-emerald-500/50"},Qs={0:"未运行",1:"异常",2:"正常"},Lx=s=>[{id:"drag-handle",header:({column:t})=>e.jsx(V,{column:t,title:"排序"}),cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(ht,{className:"size-4 cursor-move text-muted-foreground transition-colors hover:text-primary","aria-hidden":"true"})}),size:50},{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"节点ID"}),cell:({row:t})=>{const a=t.getValue("id"),n=t.original.code;return e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs("div",{className:"group/id flex items-center space-x-2",children:[e.jsxs(M,{variant:"outline",className:f("border-2 font-medium transition-all duration-200 hover:opacity-80","flex items-center gap-1.5"),style:{borderColor:ls[t.original.type]},children:[e.jsx(vn,{className:"size-3"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[a,n&&e.jsxs("span",{className:"cursor-copy text-[0.7rem] text-muted-foreground/50",onClick:r=>{r.stopPropagation(),tt(n),z.success("已复制节点代码")},children:["(",n,")"]})]}),t.original.parent_id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted-foreground/30",children:"→"}),e.jsx("span",{children:t.original.parent_id})]}):""]})]}),e.jsx(k,{variant:"ghost",size:"icon",className:"size-5 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:text-muted-foreground group-hover/id:opacity-100",onClick:r=>{r.stopPropagation(),tt(n||a.toString()),z.success(n?"已复制节点代码":"已复制节点ID")},children:e.jsx(ha,{className:"size-3"})})]})}),e.jsxs(ne,{side:"top",className:"flex flex-col gap-1 p-3",children:[e.jsxs("p",{className:"font-medium",children:[js.find(r=>r.type===t.original.type)?.label,t.original.parent_id?" (子节点)":""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?"点击括号内容或复制按钮可复制节点代码":"点击复制按钮可复制节点ID"})]})]})})},size:200,enableSorting:!0},{accessorKey:"show",header:({column:t})=>e.jsx(V,{column:t,title:"显示"}),cell:({row:t})=>e.jsx(L,{defaultChecked:t.getValue("show"),onCheckedChange:async a=>{ec({id:t.original.id,type:t.original.type,show:a?1:0}).catch(()=>{s()})},className:"data-[state=checked]:bg-primary"}),size:50,enableSorting:!1},{accessorKey:"name",header:({column:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx(V,{column:t,title:"节点",tooltip:e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:f("h-2.5 w-2.5 rounded-full",Xs[0])}),e.jsx("span",{className:"text-sm font-medium",children:Qs[0]})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:f("h-2.5 w-2.5 rounded-full",Xs[1])}),e.jsx("span",{className:"text-sm font-medium",children:Qs[1]})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:f("h-2.5 w-2.5 rounded-full",Xs[2])}),e.jsx("span",{className:"text-sm font-medium",children:Qs[2]})]})]})})}),cell:({row:t})=>e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:f("h-2.5 w-2.5 rounded-full transition-all duration-200",Xs[t.original.available_status])}),e.jsx("span",{className:"text-left font-medium transition-colors hover:text-primary",children:t.getValue("name")})]})}),e.jsx(ne,{children:e.jsx("p",{className:"font-medium",children:Qs[t.original.available_status]})})]})}),enableSorting:!1,size:t=>t.getState().columnVisibility["drag-handle"]?2e3:200},{accessorKey:"host",header:({column:t})=>e.jsx(V,{column:t,title:"地址"}),cell:({row:t})=>{const a=`${t.original.host}:${t.original.port}`,n=t.original.port!==t.original.server_port;return e.jsxs("div",{className:"group relative flex min-w-0 items-start",children:[e.jsxs("div",{className:"flex min-w-0 flex-wrap items-baseline gap-x-1 gap-y-0.5 pr-7",children:[e.jsx("div",{className:"flex items-center ",children:e.jsxs("span",{className:"font-mono text-sm font-medium text-foreground/90",children:[t.original.host,":",t.original.port]})}),n&&e.jsxs("span",{className:"whitespace-nowrap text-[0.7rem] tracking-tight text-muted-foreground/40",children:["(内部端口 ",t.original.server_port,")"]})]}),e.jsx("div",{className:"absolute right-0 top-0",children:e.jsx(ue,{delayDuration:0,children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",className:"size-6 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:bg-muted/50 hover:text-muted-foreground group-hover:opacity-100",onClick:r=>{r.stopPropagation(),tt(a)},children:e.jsx(ha,{className:"size-3"})})}),e.jsx(ne,{side:"top",sideOffset:10,children:"复制连接地址"})]})})})]})},enableSorting:!1,enableHiding:!0},{accessorKey:"online",header:({column:t})=>e.jsx(V,{column:t,title:"在线人数",tooltip:"在线人数根据服务端上报频率而定"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(Ks,{className:"size-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("online")})]}),size:80,enableSorting:!0,enableHiding:!0},{accessorKey:"rate",header:({column:t})=>e.jsx(V,{column:t,title:"倍率",tooltip:"流量扣费倍率"}),cell:({row:t})=>e.jsxs(M,{variant:"secondary",className:"font-medium",children:[t.getValue("rate")," x"]}),size:80,enableSorting:!1,enableHiding:!0},{accessorKey:"groups",header:({column:t})=>e.jsx(V,{column:t,title:"权限组",tooltip:"可订阅到该节点的权限组"}),cell:({row:t})=>{const a=t.getValue("groups")||[];return e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5",children:a.length>0?a.map((n,r)=>e.jsx(M,{variant:"secondary",className:f("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:n.name},r)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"--"})})},enableSorting:!1,size:600,filterFn:(t,a,n)=>{const r=t.getValue(a);return r?n.some(l=>r.includes(l)):!1}},{accessorKey:"type",header:({column:t})=>e.jsx(V,{column:t,title:"类型"}),cell:({row:t})=>{const a=t.getValue("type");return e.jsx(M,{variant:"outline",className:"border-2 font-medium transition-colors",style:{borderColor:ls[a]},children:a})},enableSorting:!1,enableHiding:!0,enableColumnFilter:!1,size:8e3},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>{const{setIsOpen:a,setEditingServer:n,setServerType:r}=vr();return e.jsx("div",{className:"flex justify-center",children:e.jsxs(gs,{modal:!1,children:[e.jsx(fs,{asChild:!0,children:e.jsx(k,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":"打开操作菜单",children:e.jsx(lt,{className:"size-4"})})}),e.jsxs(cs,{align:"end",className:"w-40",children:[e.jsx(ae,{className:"cursor-pointer",onClick:()=>{r(t.original.type),n({...t.original,rate:t.original.rate.toString(),parent_id:t.original.parent_id?.toString()??null}),a(!0)},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(Ii,{className:"mr-2 size-4"}),"编辑"]})}),e.jsxs(ae,{className:"cursor-pointer",onClick:async()=>{try{await Qo({id:t.original.id}),z.success("复制成功"),s()}catch{z.error("复制失败")}},children:[e.jsx(zi,{className:"mr-2 size-4"}),"复制"]}),e.jsx(As,{}),e.jsx(ae,{className:"cursor-pointer text-destructive focus:text-destructive",onSelect:l=>l.preventDefault(),children:e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该节点，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{Xo({id:t.original.id}).then(({data:l})=>{l&&(z.success("删除成功"),s())})},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(Je,{className:"mr-2 size-4"}),"删除"]})})})]})]})})},size:50}];function $x(){const[s,t]=o.useState({}),[a,n]=o.useState({"drag-handle":!1}),[r,l]=o.useState([]),[c,x]=o.useState([]),[u,b]=o.useState(!1),[p,y]=o.useState([]),{refetch:_}=G({queryKey:["nodeList"],queryFn:async()=>{const{data:N}=await Jn();return y(N),N}}),D=o.useMemo(()=>{const N=new Set;return p.forEach(w=>{w.groups&&w.groups.forEach(E=>N.add(E.name))}),Array.from(N).sort()},[p]);o.useEffect(()=>{n({"drag-handle":u,show:!u,host:!u,online:!u,rate:!u,groups:!u,type:!1,actions:!u})},[u]);const F=(N,w)=>{u&&(N.dataTransfer.setData("text/plain",w.toString()),N.currentTarget.classList.add("opacity-50"))},T=(N,w)=>{if(!u)return;N.preventDefault(),N.currentTarget.classList.remove("bg-muted");const E=parseInt(N.dataTransfer.getData("text/plain"));if(E===w)return;const H=[...p],[je]=H.splice(E,1);H.splice(w,0,je),y(H)},m=async()=>{if(!u){b(!0);return}try{const N=p?.map(w=>w.id);await sc(N),z.success("排序保存成功"),b(!1),_()}catch{z.error("排序保存失败"),b(!1)}},d=Fe({data:p||[],columns:Lx(_),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}},pageCount:u?1:void 0});return e.jsx(Rx,{refreshData:_,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx($e,{table:d,toolbar:N=>e.jsx(Ox,{table:N,refetch:_,saveOrder:m,isSortMode:u,groups:D}),draggable:u,onDragStart:F,onDragEnd:N=>N.currentTarget.classList.remove("opacity-50"),onDragOver:N=>{N.preventDefault(),N.currentTarget.classList.add("bg-muted")},onDragLeave:N=>N.currentTarget.classList.remove("bg-muted"),onDrop:T,showPagination:!u}),e.jsx(br,{})]})})}function Ax(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"节点管理"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"管理所有节点，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx($x,{})})]})]})}const Hx=Object.freeze(Object.defineProperty({__proto__:null,default:Ax},Symbol.toStringTag,{value:"Module"}));function Kx({table:s,refetch:t}){const a=s.getState().columnFilters.length>0;return e.jsx("div",{className:"flex items-center justify-between space-x-4",children:e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(bt,{refetch:t}),e.jsx(C,{placeholder:"搜索权限组...",value:s.getColumn("name")?.getFilterValue()??"",onChange:n=>s.getColumn("name")?.setFilterValue(n.target.value),className:f("h-8  w-[150px] lg:w-[250px]",a&&"border-primary/50 ring-primary/20")}),a&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]})})}const Gx=s=>[{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"组ID"}),cell:({row:t})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(M,{variant:"outline",children:t.getValue("id")})}),enableSorting:!0},{accessorKey:"name",header:({column:t})=>e.jsx(V,{column:t,title:"组名称"}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium",children:t.getValue("name")})})},{accessorKey:"users_count",header:({column:t})=>e.jsx(V,{column:t,title:"用户数量"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(Ks,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"server_count",header:({column:t})=>e.jsx(V,{column:t,title:"节点数量"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(vn,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("server_count")})]}),enableSorting:!0,size:8e3},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(bt,{defaultValues:t.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]})}),e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该权限组，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{ac({id:t.original.id}).then(({data:a})=>{a&&(z.success("删除成功"),s())})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]})}];function Ux(){const[s,t]=o.useState({}),[a,n]=o.useState({}),[r,l]=o.useState([]),[c,x]=o.useState([]),{data:u,refetch:b,isLoading:p}=G({queryKey:["serverGroupList"],queryFn:async()=>{const{data:_}=await pt();return _}}),y=Fe({data:u||[],columns:Gx(b),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx($e,{table:y,toolbar:_=>e.jsx(Kx,{table:_,refetch:b}),isLoading:p})}function qx(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"权限组管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"管理所有权限组，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ux,{})})]})]})}const Bx=Object.freeze(Object.defineProperty({__proto__:null,default:qx},Symbol.toStringTag,{value:"Module"})),Yx=i.object({remarks:i.string().min(1,"Please enter a valid remarks."),match:i.array(i.string()),action:i.enum(["block","dns"]),action_value:i.string().optional()});function yr({refetch:s,dialogTrigger:t,defaultValues:a={remarks:"",match:[],action:"block",action_value:""},type:n="add"}){const r=Z({resolver:Q(Yx),defaultValues:a,mode:"onChange"}),[l,c]=o.useState(!1);return e.jsxs(de,{open:l,onOpenChange:c,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"})," ",e.jsx("div",{children:"添加路由"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:n==="edit"?"编辑路由":"创建路由"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...r,children:[e.jsx(j,{control:r.control,name:"remarks",render:({field:x})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"备注"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsx(C,{type:"text",placeholder:"请输入备注",...x})})}),e.jsx(S,{})]})}),e.jsx(j,{control:r.control,name:"match",render:({field:x})=>e.jsxs(h,{className:"flex-[2]",children:[e.jsx(g,{children:"备注"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsx(us,{className:"min-h-[120px]",placeholder:`example.com
*.example.com`,value:x.value.join(`
`),onChange:u=>{x.onChange(u.target.value.split(`
`))}})})}),e.jsx(S,{})]})}),e.jsx(j,{control:r.control,name:"action",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"动作"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsxs(B,{onValueChange:x.onChange,defaultValue:x.value,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择动作"})}),e.jsxs(q,{children:[e.jsx(O,{value:"block",children:"禁止访问"}),e.jsx(O,{value:"dns",children:"指定DNS服务器进行解析"})]})]})})}),e.jsx(S,{})]})}),r.watch("action")==="dns"&&e.jsx(j,{control:r.control,name:"action_value",render:({field:x})=>e.jsxs(h,{children:[e.jsx(g,{children:"DNS服务器"}),e.jsx("div",{className:"relative",children:e.jsx(v,{children:e.jsx(C,{type:"text",placeholder:"请输入DNS服务器",...x})})})]})}),e.jsxs(ke,{children:[e.jsx(Gs,{asChild:!0,children:e.jsx(k,{variant:"outline",children:"取消"})}),e.jsx(k,{type:"submit",onClick:()=>{nc(r.getValues()).then(({data:x})=>{x&&(c(!1),s&&s(),r.reset())})},children:"提交"})]})]})]})]})}function Wx({table:s,refetch:t}){const a=s.getState().columnFilters.length>0;return e.jsx("div",{className:"flex items-center justify-between ",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(yr,{refetch:t}),e.jsx(C,{placeholder:"搜索路由...",value:s.getColumn("remarks")?.getFilterValue()??"",onChange:n=>s.getColumn("remarks")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),a&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]})})}function Jx({columns:s,data:t,refetch:a}){const[n,r]=o.useState({}),[l,c]=o.useState({}),[x,u]=o.useState([]),[b,p]=o.useState([]),y=Fe({data:t,columns:s,state:{sorting:b,columnVisibility:l,rowSelection:n,columnFilters:x},enableRowSelection:!0,onRowSelectionChange:r,onSortingChange:p,onColumnFiltersChange:u,onColumnVisibilityChange:c,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx($e,{table:y,toolbar:_=>e.jsx(Wx,{table:_,refetch:a})})}const Zx=s=>[{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"组ID"}),cell:({row:t})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(M,{variant:"outline",children:t.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"remarks",header:()=>e.jsx("div",{children:"备注"}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsxs("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:["匹配 ",t.original.match?.length," 条规则"]})})},{accessorKey:"action",header:({column:t})=>e.jsx(V,{column:t,title:"动作"}),cell:({row:t})=>{const a={dns:"指定DNS服务器进行解析",block:"禁止访问"};return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(M,{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:a[t.getValue("action")]})})},enableSorting:!1,size:9e3},{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"操作"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(yr,{defaultValues:t.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]})}),e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该权限组，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{rc({id:t.original.id}).then(({data:a})=>{a&&(z.success("删除成功"),s())})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]})}];function Xx(){const[s,t]=o.useState([]);function a(){Zn().then(({data:n})=>{t(n)})}return o.useEffect(()=>{a()},[]),e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"路由管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"管理所有路由组，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Jx,{data:s,columns:Zx(a),refetch:a})})]})]})}const Qx=Object.freeze(Object.defineProperty({__proto__:null,default:Xx},Symbol.toStringTag,{value:"Module"})),Nr=o.createContext(void 0);function em({children:s,refreshData:t}){const[a,n]=o.useState(!1),[r,l]=o.useState(null);return e.jsx(Nr.Provider,{value:{isOpen:a,setIsOpen:n,editingPlan:r,setEditingPlan:l,refreshData:t},children:s})}function ea(){const s=o.useContext(Nr);if(s===void 0)throw new Error("usePlanEdit must be used within a PlanEditProvider");return s}function sm({table:s,saveOrder:t,isSortMode:a}){const{setIsOpen:n}=ea();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsxs(k,{variant:"outline",className:"space-x-2",size:"sm",onClick:()=>n(!0),children:[e.jsx(Ce,{icon:"ion:add"}),e.jsx("div",{children:"添加套餐"})]}),e.jsx(C,{placeholder:"搜索套餐...",value:s.getColumn("name")?.getFilterValue()??"",onChange:r=>s.getColumn("name")?.setFilterValue(r.target.value),className:"h-8 w-[150px] lg:w-[250px]"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(k,{variant:a?"default":"outline",size:"sm",onClick:t,children:a?"保存排序":"编辑排序"})})]})}const tm=s=>[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:"cursor-move",children:e.jsx(ht,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"ID"}),cell:({row:t})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(M,{variant:"outline",children:t.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"show",header:({column:t})=>e.jsx(V,{column:t,title:"显示"}),cell:({row:t})=>e.jsx(L,{defaultChecked:t.getValue("show"),onCheckedChange:a=>{Ct({id:t.original.id,show:a}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"sell",header:({column:t})=>e.jsx(V,{column:t,title:"销售"}),cell:({row:t})=>e.jsx(L,{defaultChecked:t.getValue("sell"),onCheckedChange:a=>{Ct({id:t.original.id,sell:a}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"renew",header:({column:t})=>e.jsx(V,{column:t,title:"续费",tooltip:"在订阅停止销售时，已购用户是否可以续费"}),cell:({row:t})=>e.jsx(L,{defaultChecked:t.getValue("renew"),onCheckedChange:a=>{Ct({id:t.original.id,renew:a}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:t})=>e.jsx(V,{column:t,title:"名称"}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:t.getValue("name")})}),enableSorting:!1,enableHiding:!1,size:900},{accessorKey:"users_count",header:({column:t})=>e.jsx(V,{column:t,title:"统计"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-2",children:[e.jsx(Ks,{}),e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:t.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"group",header:({column:t})=>e.jsx(V,{column:t,title:"权限组"}),cell:({row:t})=>e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5",children:e.jsx(M,{variant:"secondary",className:f("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:t.getValue("group")?.name})}),enableSorting:!1,enableHiding:!1,size:9e3},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>{const{setIsOpen:a,setEditingPlan:n}=ea();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>{n(t.original),a(!0)},children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]}),e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该订阅，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{_c({id:t.original.id}).then(({data:r})=>{r&&(z.success("删除成功"),s())})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]})}}],am=i.object({id:i.number().nullable(),group_id:i.union([i.number(),i.string()]).nullable().optional(),name:i.string().min(1).max(250),content:i.string().nullable().optional(),transfer_enable:i.union([i.number().min(0),i.string().min(1)]),prices:i.object({monthly:i.union([i.number(),i.string()]).nullable().optional(),quarterly:i.union([i.number(),i.string()]).nullable().optional(),half_yearly:i.union([i.number(),i.string()]).nullable().optional(),yearly:i.union([i.number(),i.string()]).nullable().optional(),two_yearly:i.union([i.number(),i.string()]).nullable().optional(),three_yearly:i.union([i.number(),i.string()]).nullable().optional(),onetime:i.union([i.number(),i.string()]).nullable().optional(),reset_traffic:i.union([i.number(),i.string()]).nullable().optional()}).default({}),speed_limit:i.union([i.number(),i.string()]).nullable().optional(),capacity_limit:i.union([i.number(),i.string()]).nullable().optional(),device_limit:i.union([i.number(),i.string()]).nullable().optional(),force_update:i.boolean().optional(),reset_traffic_method:i.number().nullable(),users_count:i.number().optional()}),wr=o.forwardRef(({className:s,...t},a)=>e.jsx(bn,{ref:a,className:f("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(Ri,{className:f("flex items-center justify-center text-current"),children:e.jsx(ds,{className:"h-4 w-4"})})}));wr.displayName=bn.displayName;const et={id:null,group_id:null,name:"",content:"",transfer_enable:"",prices:{monthly:"",quarterly:"",half_yearly:"",yearly:"",two_yearly:"",three_yearly:"",onetime:"",reset_traffic:""},speed_limit:"",capacity_limit:"",device_limit:"",force_update:!1,reset_traffic_method:null},st={monthly:{label:"月付",months:1,discount:1},quarterly:{label:"季付",months:3,discount:.95},half_yearly:{label:"半年付",months:6,discount:.9},yearly:{label:"年付",months:12,discount:.85},two_yearly:{label:"两年付",months:24,discount:.8},three_yearly:{label:"三年付",months:36,discount:.75},onetime:{label:"流量包",months:1,discount:1},reset_traffic:{label:"重置包",months:1,discount:1}},nm=[{value:0,label:"跟随系统设置"},{value:1,label:"每月1号"},{value:2,label:"按月重置"},{value:3,label:"不重置"},{value:4,label:"每年1月1日"},{value:5,label:"按年重置"}];function rm(){const{isOpen:s,setIsOpen:t,editingPlan:a,setEditingPlan:n,refreshData:r}=ea(),[l,c]=o.useState(!1),x=Z({resolver:Q(am),defaultValues:{...et,...a||{}},mode:"onChange"});o.useEffect(()=>{a?x.reset({...et,...a}):x.reset(et)},[a,x]);const u=new fn({html:!0}),[b,p]=o.useState();async function y(){pt().then(({data:F})=>{p(F)})}o.useEffect(()=>{s&&y()},[s]);const _=F=>{if(isNaN(F))return;const T=Object.entries(st).reduce((m,[d,N])=>{const w=F*N.months*N.discount;return{...m,[d]:w.toFixed(2)}},{});x.setValue("prices",T,{shouldDirty:!0})},D=()=>{t(!1),n(null),x.reset(et)};return e.jsx(de,{open:s,onOpenChange:D,children:e.jsxs(re,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:a?"编辑套餐":"添加套餐"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...x,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{control:x.control,name:"name",render:({field:F})=>e.jsxs(h,{children:[e.jsx(g,{children:"套餐名称"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入套餐名称",...F})}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"group_id",render:({field:F})=>e.jsxs(h,{children:[e.jsxs(g,{className:"flex items-center justify-between",children:["权限组",e.jsx(bt,{dialogTrigger:e.jsx(k,{variant:"link",children:"添加权限组"}),refetch:y})]}),e.jsxs(B,{value:F.value||"",onValueChange:F.onChange,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(Y,{placeholder:"选择权限组"})})}),e.jsx(q,{children:b?.map(T=>e.jsx(O,{value:T.id,children:T.name},T.id))})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"transfer_enable",render:({field:F})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(g,{children:"流量"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",min:0,placeholder:"请输入流量大小",className:"rounded-r-none",...F})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"GB"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"speed_limit",render:({field:F})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(g,{children:"限速"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",min:0,placeholder:"请输入限速",className:"rounded-r-none",...F})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"Mbps"})]}),e.jsx(S,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"}),e.jsx("h3",{className:"mx-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"售价设置"}),e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(C,{type:"number",placeholder:"基础月付价格",className:"h-7 w-32 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500",onChange:F=>{const T=parseFloat(F.target.value);_(T)}})]}),e.jsx(ue,{children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{const F=Object.keys(st).reduce((T,m)=>({...T,[m]:""}),{});x.setValue("prices",F,{shouldDirty:!0})},children:"清空价格"})}),e.jsx(ne,{side:"top",align:"end",children:e.jsx("p",{className:"text-xs",children:"清空所有周期的价格设置"})})]})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-3",children:Object.entries(st).filter(([F])=>!["onetime","reset_traffic"].includes(F)).map(([F,T])=>e.jsx("div",{className:"group relative rounded-md bg-card p-2 ring-1 ring-gray-200 transition-all hover:ring-primary dark:ring-gray-800",children:e.jsx(j,{control:x.control,name:`prices.${F}`,render:({field:m})=>e.jsxs(h,{children:[e.jsxs(g,{className:"text-xs font-medium text-muted-foreground",children:[T.label,e.jsxs("span",{className:"ml-1 text-[10px] text-gray-400",children:["(",T.months===1?"每月":`每${T.months}个月`,"结算)"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"0.00",min:0,...m,value:m.value??"",onChange:d=>m.onChange(d.target.value),className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})},F))}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Object.entries(st).filter(([F])=>["onetime","reset_traffic"].includes(F)).map(([F,T])=>e.jsx("div",{className:"rounded-md border border-dashed border-gray-200 bg-muted/30 p-3 dark:border-gray-700",children:e.jsx(j,{control:x.control,name:`prices.${F}`,render:({field:m})=>e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsx(g,{className:"text-xs font-medium",children:T.label}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:F==="onetime"?"一次性流量包，购买后立即生效":"用户可随时购买流量重置包，立即重置流量"})]}),e.jsxs("div",{className:"relative w-full md:w-32",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"0.00",min:0,...m,className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})})},F))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(j,{control:x.control,name:"device_limit",render:({field:F})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(g,{children:"设备限制"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",min:0,placeholder:"留空则不限制",className:"rounded-r-none",...F,value:F.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"台"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"capacity_limit",render:({field:F})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(g,{children:"容量限制"}),e.jsxs("div",{className:"relative flex",children:[e.jsx(v,{children:e.jsx(C,{type:"number",min:0,placeholder:"留空则不限制",className:"rounded-r-none",...F,value:F.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:"人"})]}),e.jsx(S,{})]})})]}),e.jsx(j,{control:x.control,name:"reset_traffic_method",render:({field:F})=>e.jsxs(h,{children:[e.jsx(g,{children:"流量重置方式"}),e.jsxs(B,{value:F.value?.toString()??"0",onValueChange:T=>F.onChange(Number(T)),children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(Y,{placeholder:"选择流量重置方式"})})}),e.jsx(q,{children:nm.map(T=>e.jsx(O,{value:T.value.toString(),children:T.label},T.value))})]}),e.jsx(P,{className:"text-xs",children:"设置订阅流量的重置方式，不同的重置方式会影响用户的流量计算方式"}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"content",render:({field:F})=>{const[T,m]=o.useState(!1);return e.jsxs(h,{className:"space-y-2",children:[e.jsxs(g,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["套餐描述",e.jsx(ue,{children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>m(!T),children:T?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{d:"M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"}),e.jsx("path",{fillRule:"evenodd",d:"M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.28 2.22a.75.75 0 00-1.06 1.06l14.5 14.5a.75.75 0 101.06-1.06l-1.745-1.745a10.029 10.029 0 003.3-4.38 1.651 1.651 0 000-1.185A10.004 10.004 0 009.999 3a9.956 9.956 0 00-4.744 1.194L3.28 2.22zM7.752 6.69l1.092 1.092a2.5 2.5 0 013.374 3.373l1.091 1.092a4 4 0 00-5.557-5.557z",clipRule:"evenodd"}),e.jsx("path",{d:"M10.748 13.93l2.523 2.523a9.987 9.987 0 01-3.27.547c-4.258 0-7.894-2.66-9.337-6.41a1.651 1.651 0 010-1.186A10.007 10.007 0 012.839 6.02L6.07 9.252a4 4 0 004.678 4.678z"})]})})}),e.jsx(ne,{side:"top",children:e.jsx("p",{className:"text-xs",children:T?"隐藏预览":"显示预览"})})]})})]}),e.jsx(ue,{children:e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"sm",onClick:()=>{F.onChange(`## 套餐特点
• 高速稳定的全球网络接入
• 支持多设备同时在线
• 无限制的流量重置

## 使用说明
1. 支持设备：iOS、Android、Windows、macOS
2. 24/7 技术支持
3. 自动定期流量重置

## 注意事项
- 禁止滥用
- 遵守当地法律法规
- 支持随时更换套餐`)},children:"使用模板"})}),e.jsx(ne,{side:"left",align:"center",children:e.jsx("p",{className:"text-xs",children:"点击使用预设的套餐描述模板"})})]})})]}),e.jsxs("div",{className:`grid gap-4 ${T?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:[e.jsx("div",{className:"space-y-2",children:e.jsx(v,{children:e.jsx(pn,{style:{height:"400px"},value:F.value||"",renderHTML:d=>u.render(d),onChange:({text:d})=>F.onChange(d),config:{view:{menu:!0,md:!0,html:!1},canView:{menu:!0,md:!0,html:!1,fullScreen:!1,hideMenu:!1}},placeholder:"在这里编写套餐描述...",className:"rounded-md border"})})}),T&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"预览"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert h-[400px] max-w-none overflow-y-auto rounded-md border p-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:u.render(F.value||"")}})})]})]}),e.jsx(P,{className:"text-xs",children:"支持 Markdown 格式，可以使用标题、列表、粗体、斜体等样式来美化描述内容"}),e.jsx(S,{})]})}})]}),e.jsx(ke,{className:"mt-6",children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:a&&e.jsx(j,{control:x.control,name:"force_update",render:({field:F})=>e.jsxs(h,{className:"flex flex-row items-center space-x-2 space-y-0",children:[e.jsx(v,{children:e.jsx(wr,{checked:F.value,onCheckedChange:F.onChange})}),e.jsx("div",{className:"",children:e.jsx(g,{className:"text-sm",children:"强制更新到用户"})})]})})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:D,children:"取消"}),e.jsx(k,{type:"submit",disabled:l,onClick:()=>{x.handleSubmit(async F=>{c(!0),(await wc(F)).data&&(z.success(a?"套餐更新成功":"套餐添加成功"),D(),r()),c(!1)})()},children:l?"提交中...":"提交"})]})]})})]})]})})}function lm(){const[s,t]=o.useState({}),[a,n]=o.useState({"drag-handle":!1}),[r,l]=o.useState([]),[c,x]=o.useState([]),[u,b]=o.useState(!1),[p,y]=o.useState([]),{refetch:_}=G({queryKey:["planList"],queryFn:async()=>{const{data:d}=await Ps();return y(d),d}});o.useEffect(()=>{n({"drag-handle":u})},[u]);const D=(d,N)=>{u&&(d.dataTransfer.setData("text/plain",N.toString()),d.currentTarget.classList.add("opacity-50"))},F=(d,N)=>{if(!u)return;d.preventDefault(),d.currentTarget.classList.remove("bg-muted");const w=parseInt(d.dataTransfer.getData("text/plain"));if(w===N)return;const E=[...p],[H]=E.splice(w,1);E.splice(N,0,H),y(E)},T=async()=>{if(!u){b(!0);return}try{const d=p?.map(N=>N.id);await Cc(d),z.success("排序保存成功"),b(!1),_()}catch{z.error("排序保存失败"),b(!1)}},m=Fe({data:p||[],columns:tm(_),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}},pageCount:u?1:void 0});return e.jsx(em,{refreshData:_,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx($e,{table:m,toolbar:d=>e.jsx(sm,{table:d,refetch:_,saveOrder:T,isSortMode:u}),draggable:u,onDragStart:D,onDragEnd:d=>d.currentTarget.classList.remove("opacity-50"),onDragOver:d=>{d.preventDefault(),d.currentTarget.classList.add("bg-muted")},onDragLeave:d=>d.currentTarget.classList.remove("bg-muted"),onDrop:F,showPagination:!u}),e.jsx(rm,{})]})})}function im(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"订阅管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"在这里可以配置订阅计划，包括添加、删除、编辑等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(lm,{})})]})]})}const om=Object.freeze(Object.defineProperty({__proto__:null,default:im},Symbol.toStringTag,{value:"Module"})),_r=[{value:te.PENDING,label:ws[te.PENDING],icon:Ei,color:Ms[te.PENDING]},{value:te.PROCESSING,label:ws[te.PROCESSING],icon:yn,color:Ms[te.PROCESSING]},{value:te.COMPLETED,label:ws[te.COMPLETED],icon:Ot,color:Ms[te.COMPLETED]},{value:te.CANCELLED,label:ws[te.CANCELLED],icon:Nn,color:Ms[te.CANCELLED]},{value:te.DISCOUNTED,label:ws[te.DISCOUNTED],icon:Ot,color:Ms[te.DISCOUNTED]}],Cr=[{value:le.PENDING,label:Ys[le.PENDING],icon:Mi,color:Ws[le.PENDING]},{value:le.PROCESSING,label:Ys[le.PROCESSING],icon:yn,color:Ws[le.PROCESSING]},{value:le.VALID,label:Ys[le.VALID],icon:Ot,color:Ws[le.VALID]},{value:le.INVALID,label:Ys[le.INVALID],icon:Nn,color:Ws[le.INVALID]}];function Ca({column:s,title:t,options:a}){const n=s?.getFacetedUniqueValues(),r=s?.getFilterValue(),l=Array.isArray(r)?new Set(r):r!==void 0?new Set([r]):new Set;return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),t,l?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):a.filter(c=>l.has(c.value)).map(c=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:c.label},c.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(c=>{const x=l.has(c.value);return e.jsxs(ie,{onSelect:()=>{const u=new Set(l);x?u.delete(c.value):u.add(c.value);const b=Array.from(u);s?.setFilterValue(b.length?b:void 0)},children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",x?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ds,{className:f("h-4 w-4")})}),c.icon&&e.jsx(c.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${c.color}`}),e.jsx("span",{children:c.label}),n?.get(c.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(c.value)})]},c.value)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const cm=i.object({email:i.string().min(1),plan_id:i.number(),period:i.string(),total_amount:i.number()}),dm={email:"",plan_id:0,total_amount:0,period:""};function Sr({refetch:s,trigger:t,defaultValues:a}){const[n,r]=o.useState(!1),l=Z({resolver:Q(cm),defaultValues:{...dm,...a},mode:"onChange"}),[c,x]=o.useState([]);return o.useEffect(()=>{n&&Ps().then(({data:u})=>{x(u)})},[n]),e.jsxs(de,{open:n,onOpenChange:r,children:[e.jsx(Se,{asChild:!0,children:t||e.jsxs(k,{variant:"outline",size:"sm",className:" h-8 space-x-2",children:[e.jsx(Ce,{icon:"ion:add"}),e.jsx("div",{children:"添加订单"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"订单分配"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...l,children:[e.jsx(j,{control:l.control,name:"email",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"用户邮箱"}),e.jsx(v,{children:e.jsx(C,{placeholder:"请输入用户邮箱",...u})})]})}),e.jsx(j,{control:l.control,name:"plan_id",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"订阅计划"}),e.jsx(v,{children:e.jsxs(B,{value:u.value?u.value?.toString():void 0,onValueChange:b=>u.onChange(parseInt(b)),children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择订阅计划"})}),e.jsx(q,{children:c.map(b=>e.jsx(O,{value:b.id.toString(),children:b.name},b.id))})]})})]})}),e.jsx(j,{control:l.control,name:"period",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"订阅时长"}),e.jsx(v,{children:e.jsxs(B,{value:u.value,onValueChange:u.onChange,children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"请选择购买时长"})}),e.jsx(q,{children:Object.keys(it).map(b=>e.jsx(O,{value:b,children:it[b]},b))})]})})]})}),e.jsx(j,{control:l.control,name:"total_amount",render:({field:u})=>e.jsxs(h,{children:[e.jsx(g,{children:"支付金额"}),e.jsx(v,{children:e.jsx(C,{type:"number",placeholder:"请输入需要支付的金额",value:u.value/100,onChange:b=>u.onChange(parseFloat(b.currentTarget.value)*100)})}),e.jsx(S,{})]})}),e.jsxs(ke,{children:[e.jsx(k,{variant:"outline",onClick:()=>r(!1),children:"取消"}),e.jsx(k,{type:"submit",onClick:()=>{l.handleSubmit(u=>{Tc(u).then(({data:b})=>{b&&(s&&s(),l.reset(),r(!1),z.success("添加成功"))})})()},children:"确定"})]})]})]})]})}function xm({table:s,refetch:t}){const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Sr,{refetch:t}),e.jsx(C,{placeholder:"搜索订单...",value:s.getColumn("trade_no")?.getFilterValue()??"",onChange:n=>s.getColumn("trade_no")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("status")&&e.jsx(Ca,{column:s.getColumn("status"),title:"订单状态",options:_r}),s.getColumn("commission_status")&&e.jsx(Ca,{column:s.getColumn("commission_status"),title:"佣金状态",options:Cr})]}),a&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]})}function Ie({label:s,value:t,className:a,valueClassName:n}){return e.jsxs("div",{className:f("flex items-center py-1.5",a),children:[e.jsx("div",{className:"w-28 shrink-0 text-sm text-muted-foreground",children:s}),e.jsx("div",{className:f("text-sm",n),children:t||"-"})]})}function mm({status:s}){const t={PENDING:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",PAID:"bg-green-100 text-green-800 hover:bg-green-100",FAILED:"bg-red-100 text-red-800 hover:bg-red-100",REFUNDED:"bg-gray-100 text-gray-800 hover:bg-gray-100"};return e.jsx(M,{variant:"secondary",className:f("font-medium",t[s]),children:ws[s]})}function um({id:s,trigger:t}){const[a,n]=o.useState(!1),[r,l]=o.useState();return o.useEffect(()=>{(async()=>{if(a){const{data:x}=await Sc({id:s});l(x)}})()},[a,s]),e.jsxs(de,{onOpenChange:n,open:a,children:[e.jsx(Se,{asChild:!0,children:t}),e.jsxs(re,{className:"max-w-xl",children:[e.jsxs(he,{className:"space-y-2",children:[e.jsx(xe,{className:"text-lg font-medium",children:"订单信息"}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-muted-foreground",children:["订单号：",r?.trade_no]}),r?.status&&e.jsx(mm,{status:r.status})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"基本信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Ie,{label:"用户邮箱",value:r?.user?.email?e.jsxs(vs,{to:`/user/manage?email=${r.user.email}`,className:"group inline-flex items-center gap-1 text-primary hover:underline",children:[r.user.email,e.jsx(wn,{className:"h-3.5 w-3.5 opacity-0 transition-opacity group-hover:opacity-100"})]}):"-"}),e.jsx(Ie,{label:"订单周期",value:r&&it[r.period]}),e.jsx(Ie,{label:"订阅计划",value:r?.plan?.name,valueClassName:"font-medium"}),e.jsx(Ie,{label:"回调单号",value:r?.callback_no,valueClassName:"font-mono text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"金额信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Ie,{label:"支付金额",value:Es(r?.total_amount||0),valueClassName:"font-medium text-primary"}),e.jsx(se,{className:"my-2"}),e.jsx(Ie,{label:"余额支付",value:Es(r?.balance_amount||0)}),e.jsx(Ie,{label:"优惠金额",value:Es(r?.discount_amount||0),valueClassName:"text-green-600"}),e.jsx(Ie,{label:"退回金额",value:Es(r?.refund_amount||0),valueClassName:"text-red-600"}),e.jsx(Ie,{label:"折抵金额",value:Es(r?.surplus_amount||0)})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"时间信息"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Ie,{label:"创建时间",value:X(r?.created_at),valueClassName:"font-mono text-xs"}),e.jsx(Ie,{label:"更新时间",value:X(r?.updated_at),valueClassName:"font-mono text-xs"})]})]})]})]})]})}const hm=s=>[{accessorKey:"trade_no",header:({column:t})=>e.jsx(V,{column:t,title:"订单号"}),cell:({row:t})=>{const a=t.original.trade_no,n=a.length>6?`${a.slice(0,3)}...${a.slice(-3)}`:a;return e.jsx("div",{className:"flex items-center",children:e.jsx(um,{trigger:e.jsxs(A,{variant:"ghost",size:"sm",className:"flex h-8 items-center gap-1.5 px-2 font-medium text-primary transition-colors hover:bg-primary/10 hover:text-primary/80",children:[e.jsx("span",{className:"font-mono",children:n}),e.jsx(wn,{className:"h-3.5 w-3.5 opacity-70"})]}),id:t.original.id})})},enableSorting:!1,enableHiding:!1},{accessorKey:"type",header:({column:t})=>e.jsx(V,{column:t,title:"类型"}),cell:({row:t})=>e.jsx(M,{variant:"outline",className:"bg-muted/50 transition-colors hover:bg-muted/60",children:qc[t.getValue("type")]}),enableSorting:!1,enableHiding:!1},{accessorKey:"plan.name",header:({column:t})=>e.jsx(V,{column:t,title:"订阅计划"}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium text-foreground/90 sm:max-w-72 md:max-w-[31rem]",children:t.original.plan?.name||"-"})}),enableSorting:!1,enableHiding:!1},{accessorKey:"period",header:({column:t})=>e.jsx(V,{column:t,title:"周期"}),cell:({row:t})=>e.jsx(M,{variant:"outline",className:"bg-muted/50 transition-colors hover:bg-muted/60",children:it[t.getValue("period")]}),enableSorting:!1,enableHiding:!1},{accessorKey:"total_amount",header:({column:t})=>e.jsx(V,{column:t,title:"支付金额"}),cell:({row:t})=>{const a=t.getValue("total_amount"),n=typeof a=="number"?(a/100).toFixed(2):"N/A";return e.jsxs("div",{className:"flex items-center font-mono text-foreground/90",children:["¥",n]})},enableSorting:!0,enableHiding:!1},{accessorKey:"status",header:({column:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{column:t,title:"订单状态"}),e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsx(hr,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-muted-foreground"})}),e.jsx(ne,{side:"top",className:"max-w-[200px] text-sm",children:"标记为[已支付]后将会由系统进行开通后并完成"})]})})]}),cell:({row:t})=>{const a=_r.find(n=>n.value===t.getValue("status"));return a?e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon&&e.jsx(a.icon,{className:`h-4 w-4 text-${a.color}`}),e.jsx("span",{className:"text-sm font-medium",children:a.label})]}),a.value===te.PENDING&&e.jsxs(gs,{modal:!0,children:[e.jsx(fs,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"打开菜单"})]})}),e.jsxs(cs,{align:"end",className:"w-[140px]",children:[e.jsx(ae,{className:"cursor-pointer",onClick:async()=>{await kc({trade_no:t.original.trade_no}),s()},children:"标记为已支付"}),e.jsx(ae,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await Dc({trade_no:t.original.trade_no}),s()},children:"取消订单"})]})]})]}):null},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_balance",header:({column:t})=>e.jsx(V,{column:t,title:"佣金金额"}),cell:({row:t})=>{const a=t.getValue("commission_balance"),n=a?(a/100).toFixed(2):"-";return e.jsx("div",{className:"flex items-center font-mono text-foreground/90",children:a?`¥${n}`:"-"})},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_status",header:({column:t})=>e.jsx(V,{column:t,title:"佣金状态"}),cell:({row:t})=>{const a=t.original.commission_status,n=Cr.find(r=>r.value===t.getValue("commission_status"));return a==0||!n?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:`h-4 w-4 text-${n.color}`}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]}),n.value===le.PENDING&&e.jsxs(gs,{modal:!0,children:[e.jsx(fs,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"打开菜单"})]})}),e.jsxs(cs,{align:"end",className:"w-[120px]",children:[e.jsx(ae,{className:"cursor-pointer",onClick:async()=>{await ba({trade_no:t.original.trade_no,commission_status:le.PROCESSING}),s()},children:"标记为有效"}),e.jsx(ae,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await ba({trade_no:t.original.trade_no,commission_status:le.INVALID}),s()},children:"标记为无效"})]})]})]})},enableSorting:!0,enableHiding:!1},{accessorKey:"created_at",header:({column:t})=>e.jsx(V,{column:t,title:"创建时间"}),cell:({row:t})=>e.jsx("div",{className:"text-nowrap font-mono text-sm text-muted-foreground",children:X(t.getValue("created_at"),"YYYY/MM/DD HH:mm:ss")}),enableSorting:!0,enableHiding:!1}];function jm(){const s=ot(),t=new URLSearchParams(s.search),a=Array.from(t.entries()).map(([E,H])=>({id:E,value:parseInt(H)||H})),[n]=o.useState(!0),r=n&&s.state?.filters?s.state.filters:[],l=[...a,...r];o.useEffect(()=>{s.state?.filters&&window.history.replaceState({...s.state,filters:void 0},"")},[]);const[c,x]=o.useState({}),[u,b]=o.useState({}),[p,y]=o.useState(l),[_,D]=o.useState([]),[F,T]=o.useState({pageIndex:0,pageSize:10}),{refetch:m,data:d,isLoading:N}=G({queryKey:["orderList",F,p,_],queryFn:()=>Xn({pageSize:F.pageSize,current:F.pageIndex+1,filter:p,sort:_})}),w=Fe({data:d?.data??[],columns:hm(m),state:{sorting:_,columnVisibility:u,rowSelection:c,columnFilters:p,pagination:F},rowCount:d?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:x,onSortingChange:D,onColumnFiltersChange:y,onColumnVisibilityChange:b,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),onPaginationChange:T,getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe()});return e.jsx($e,{table:w,toolbar:e.jsx(xm,{table:w,refetch:m}),showPagination:!0})}function gm(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:" 订单管理"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"在这里可以查看用户订单，包括分配、查看、删除等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(jm,{})})]})]})}const fm=Object.freeze(Object.defineProperty({__proto__:null,default:gm},Symbol.toStringTag,{value:"Module"}));function pm({column:s,title:t,options:a}){const n=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),t,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(l=>r.has(l.value)).map(l=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:l.label},l.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(l=>{const c=r.has(l.value);return e.jsxs(ie,{onSelect:()=>{c?r.delete(l.value):r.add(l.value);const x=Array.from(r);s?.setFilterValue(x.length?x:void 0)},children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ds,{className:f("h-4 w-4")})}),l.icon&&e.jsx(l.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${l.color}`}),e.jsx("span",{children:l.label}),n?.get(l.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(l.value)})]},l.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Dt=s=>s===""||s===void 0?void 0:typeof s=="string"?Number(s):s,vm=i.object({id:i.number().optional(),name:i.string().min(1,"请输入优惠券名称"),code:i.string().optional(),type:i.union([i.string(),i.nativeEnum(vt)]).transform(s=>typeof s=="string"?Number(s):s),value:i.union([i.string(),i.number()]).transform(s=>typeof s=="string"?Number(s):s).refine(s=>s>0,"优惠值必须大于0"),started_at:i.number(),ended_at:i.number(),limit_use:i.union([i.string(),i.number()]).optional().transform(Dt),limit_use_with_user:i.union([i.string(),i.number()]).optional().transform(Dt),generate_count:i.union([i.string(),i.number()]).optional().transform(Dt),limit_plan_ids:i.array(i.number()).default([]),limit_period:i.array(i.nativeEnum(Cs)).default([])}).refine(s=>s.ended_at>s.started_at,{message:"结束时间必须晚于开始时间",path:["ended_at"]}),Sa={name:"",code:"",type:vt.AMOUNT,value:0,started_at:Math.floor(Date.now()/1e3),ended_at:Math.floor(Date.now()/1e3)+7*24*60*60,limit_use:"",limit_use_with_user:"",limit_plan_ids:[],limit_period:[],generate_count:""};function kr({defaultValues:s,refetch:t,type:a="create",dialogTrigger:n=e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 space-x-2",children:[e.jsx(Ce,{icon:"ion:add"}),e.jsx("div",{children:"添加优惠券"})]}),open:r,onOpenChange:l}){const[c,x]=o.useState(!1),u=r??c,b=l??x,[p,y]=o.useState([]),_=Z({resolver:Q(vm),defaultValues:s||Sa});o.useEffect(()=>{s&&_.reset(s)},[s,_]),o.useEffect(()=>{Ps().then(({data:m})=>y(m))},[]);const D=m=>{if(!m)return;const d=(N,w)=>{const E=new Date(w*1e3);return N.setHours(E.getHours(),E.getMinutes(),E.getSeconds()),Math.floor(N.getTime()/1e3)};m.from&&_.setValue("started_at",d(m.from,_.watch("started_at"))),m.to&&_.setValue("ended_at",d(m.to,_.watch("ended_at")))},F=async m=>{try{console.log("Form values before formatting:",m);const d={...m,type:Number(m.type),value:Number(m.value),limit_use:m.limit_use===""?void 0:Number(m.limit_use),limit_use_with_user:m.limit_use_with_user===""?void 0:Number(m.limit_use_with_user),generate_count:m.generate_count===""?void 0:Number(m.generate_count),limit_period:Array.isArray(m.limit_period)?m.limit_period:[],limit_plan_ids:Array.isArray(m.limit_plan_ids)?m.limit_plan_ids:[]};console.log("Formatted values:",d),await Pc(d),b(!1),a==="create"&&_.reset(Sa),t()}catch(d){console.error("保存优惠券失败:",d)}},T=(m,d)=>e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:d}),e.jsx(C,{type:"datetime-local",step:"1",value:X(_.watch(m),"YYYY-MM-DDTHH:mm:ss"),onChange:N=>{const w=new Date(N.target.value);_.setValue(m,Math.floor(w.getTime()/1e3))},className:"h-8 [&::-webkit-calendar-picker-indicator]:hidden"})]});return e.jsxs(de,{open:u,onOpenChange:b,children:[n&&e.jsx(Se,{asChild:!0,children:n}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsx(he,{children:e.jsx(xe,{children:a==="create"?"添加优惠券":"编辑优惠券"})}),e.jsx(ee,{..._,children:e.jsxs("form",{onSubmit:_.handleSubmit(F),className:"space-y-4",children:[e.jsx(j,{control:_.control,name:"name",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"优惠券名称"}),e.jsx(C,{placeholder:"请输入优惠券名称",...m}),e.jsx(S,{})]})}),e.jsxs(h,{children:[e.jsx(g,{children:"优惠券类型和值"}),e.jsxs("div",{className:"flex",children:[e.jsx(j,{control:_.control,name:"type",render:({field:m})=>e.jsxs(B,{value:m.value.toString(),onValueChange:m.onChange,children:[e.jsx(U,{className:"flex-[1.2] rounded-r-none border-r-0 focus:z-10",children:e.jsx(Y,{placeholder:"优惠券类型"})}),e.jsx(q,{children:Object.entries(Yt).map(([d,N])=>e.jsx(O,{value:d,children:N},d))})]})}),e.jsx(j,{control:_.control,name:"value",render:({field:m})=>e.jsx(C,{type:"number",placeholder:"请输入值",...m,onChange:d=>m.onChange(d.target.value===""?"":d.target.value),className:"flex-[2] rounded-none border-x-0 text-left"})}),e.jsx("div",{className:"flex min-w-[40px] items-center justify-center rounded-md rounded-l-none border border-l-0 border-input bg-muted/50 px-3 font-medium text-muted-foreground",children:e.jsx("span",{children:_.watch("type")===vt.AMOUNT?"¥":"%"})})]})]}),e.jsxs(h,{children:[e.jsx(g,{children:"优惠券有效期"}),e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:f("w-full justify-start text-left font-normal",!_.watch("started_at")&&"text-muted-foreground"),children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),X(_.watch("started_at"),"YYYY-MM-DD HH:mm:ss")," ","至"," ",X(_.watch("ended_at"),"YYYY-MM-DD HH:mm:ss")]})}),e.jsxs(Le,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"border-b border-border",children:e.jsx(Us,{mode:"range",selected:{from:new Date(_.watch("started_at")*1e3),to:new Date(_.watch("ended_at")*1e3)},onSelect:D,numberOfMonths:2})}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[T("started_at","开始时间"),e.jsx("div",{className:"mt-6 text-sm text-muted-foreground",children:"至"}),T("ended_at","结束时间")]})})]})]}),e.jsx(S,{})]}),e.jsx(j,{control:_.control,name:"limit_use",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"最大使用次数"}),e.jsx(C,{type:"number",min:0,placeholder:"限制最大使用次数，留空则不限制",...m,value:m.value===void 0?"":m.value,onChange:d=>m.onChange(d.target.value===""?"":d.target.value),className:"h-9"}),e.jsx(P,{className:"text-xs",children:"设置优惠券的总使用次数限制，留空表示不限制使用次数"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"limit_use_with_user",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"每个用户可使用次数"}),e.jsx(C,{type:"number",min:0,placeholder:"限制每个用户可使用次数，留空则不限制",...m,value:m.value===void 0?"":m.value,onChange:d=>m.onChange(d.target.value===""?"":d.target.value),className:"h-9"}),e.jsx(P,{className:"text-xs",children:"限制每个用户可使用该优惠券的次数，留空表示不限制单用户使用次数"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"limit_period",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"指定周期"}),e.jsx(Hs,{options:Object.entries(Cs).filter(([d])=>isNaN(Number(d))).map(([d,N])=>({label:N,value:d})),onChange:d=>{if(d.length===0){m.onChange([]);return}const N=d.map(w=>Cs[w.value]);m.onChange(N)},value:(m.value||[]).map(d=>({label:Object.entries(Cs).find(([N,w])=>w===d)?.[1]||"",value:Object.entries(Cs).find(([N,w])=>w===d)?.[0]||""})),placeholder:"限制指定周期可以使用优惠，留空则不限制",emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"没有找到匹配的周期"})}),e.jsx(P,{className:"text-xs",children:"选择可以使用优惠券的订阅周期，留空表示不限制使用周期"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"limit_plan_ids",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"指定订阅"}),e.jsx(Hs,{options:p?.map(d=>({label:d.name,value:d.id.toString()}))||[],onChange:d=>m.onChange(d.map(N=>Number(N.value))),value:(p||[]).filter(d=>(m.value||[]).includes(d.id)).map(d=>({label:d.name,value:d.id.toString()})),placeholder:"限制指定订阅可以使用优惠，留空则不限制",emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"没有找到匹配的订阅"})}),e.jsx(S,{})]})}),a==="create"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{control:_.control,name:"code",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"自定义优惠码"}),e.jsx(C,{placeholder:"自定义优惠码，留空则自动生成",...m,className:"h-9"}),e.jsx(P,{className:"text-xs",children:"可以自定义优惠码，留空则系统自动生成"}),e.jsx(S,{})]})}),e.jsx(j,{control:_.control,name:"generate_count",render:({field:m})=>e.jsxs(h,{children:[e.jsx(g,{children:"批量生成数量"}),e.jsx(C,{type:"number",min:0,placeholder:"批量生成优惠码数量，留空则生成单个",...m,value:m.value===void 0?"":m.value,onChange:d=>m.onChange(d.target.value===""?"":d.target.value),className:"h-9"}),e.jsx(P,{className:"text-xs",children:"批量生成多个优惠码，留空则只生成单个优惠码"}),e.jsx(S,{})]})})]}),e.jsx(ke,{children:e.jsx(k,{type:"submit",disabled:_.formState.isSubmitting,children:_.formState.isSubmitting?"保存中...":"保存"})})]})})]})]})}function bm({table:s,refetch:t}){const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(kr,{refetch:t}),e.jsx(C,{placeholder:"搜索优惠券...",value:s.getColumn("name")?.getFilterValue()??"",onChange:n=>s.getColumn("name")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("type")&&e.jsx(pm,{column:s.getColumn("type"),title:"类型",options:Object.entries(Yt).map(([n,r])=>({value:n,label:r}))}),a&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]})}const Dr=o.createContext(void 0);function ym({children:s,refetch:t}){const[a,n]=o.useState(!1),[r,l]=o.useState(null),c=u=>{l(u),n(!0)},x=()=>{n(!1),l(null)};return e.jsxs(Dr.Provider,{value:{isOpen:a,currentCoupon:r,openEdit:c,closeEdit:x},children:[s,r&&e.jsx(kr,{defaultValues:r,refetch:t,type:"edit",open:a,onOpenChange:n})]})}function Nm(){const s=o.useContext(Dr);if(s===void 0)throw new Error("useCouponEdit must be used within a CouponEditProvider");return s}const wm=s=>[{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"ID"}),cell:({row:t})=>e.jsx(M,{children:t.original.id}),enableSorting:!0},{accessorKey:"show",header:({column:t})=>e.jsx(V,{column:t,title:"启用"}),cell:({row:t})=>e.jsx(L,{defaultChecked:t.original.show,onCheckedChange:a=>{Ic({id:t.original.id,show:a}).then(({data:n})=>!n&&s())}}),enableSorting:!1},{accessorKey:"name",header:({column:t})=>e.jsx(V,{column:t,title:"卷名称"}),cell:({row:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:t.original.name})}),enableSorting:!1,size:800},{accessorKey:"type",header:({column:t})=>e.jsx(V,{column:t,title:"类型"}),cell:({row:t})=>e.jsx(M,{variant:"outline",children:Yt[t.original.type]}),enableSorting:!0},{accessorKey:"code",header:({column:t})=>e.jsx(V,{column:t,title:"卷码"}),cell:({row:t})=>e.jsx(M,{variant:"secondary",children:t.original.code}),enableSorting:!0},{accessorKey:"limit_use",header:({column:t})=>e.jsx(V,{column:t,title:"剩余次数"}),cell:({row:t})=>e.jsx(M,{variant:"outline",children:t.original.limit_use}),enableSorting:!0},{accessorKey:"#",header:({column:t})=>e.jsx(V,{column:t,title:"有效期"}),cell:({row:t})=>{const[a,n]=o.useState(!1),r=Date.now(),l=t.original.started_at*1e3,c=t.original.ended_at*1e3,x=r>c,u=r<l,b=Math.ceil((c-r)/(1e3*60*60*24)),y=x?{label:`已过期${Math.abs(b)}天`,color:"bg-red-50 text-red-600 dark:bg-red-500/10 dark:text-red-400"}:u?{label:`${Math.abs(Math.ceil((l-r)/(1e3*60*60*24)))}天后开始`,color:"bg-yellow-50 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-400"}:{label:`剩余${b}天`,color:"bg-green-50 text-green-600 dark:bg-green-500/10 dark:text-green-400"};return e.jsxs(An,{open:a,onOpenChange:n,children:[e.jsx(Hn,{asChild:!0,children:e.jsxs("div",{className:"group -m-0.5 flex max-w-[280px] cursor-pointer items-center gap-2 rounded-md p-0.5 transition-colors hover:bg-muted/40",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx("div",{className:f("whitespace-nowrap rounded-md px-1.5 py-0.5 text-xs font-medium",y.color),children:y.label}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1 text-muted-foreground",children:[e.jsx("div",{className:"truncate text-xs",children:X(t.original.started_at,"MM/DD HH:mm")}),e.jsx("div",{className:"shrink-0 opacity-30",children:"→"}),e.jsx("div",{className:"truncate text-xs",children:X(t.original.ended_at,"MM/DD HH:mm")})]})]}),e.jsx(Oi,{className:f("h-3.5 w-3.5 shrink-0 text-muted-foreground/50 transition-transform duration-200",a&&"rotate-180")})]})}),e.jsx(Kn,{children:e.jsx("div",{className:"px-0.5 pb-0.5 pt-1.5",children:e.jsxs("div",{className:"space-y-1.5 border-l-2 border-muted pl-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"开始时间"}),e.jsx("span",{className:"font-medium text-foreground",children:X(t.original.started_at,"YYYY/MM/DD HH:mm")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"结束时间"}),e.jsx("span",{className:"font-medium text-foreground",children:X(t.original.ended_at,"YYYY/MM/DD HH:mm")})]})]})})})]})},enableSorting:!1,size:8e3},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>{const{openEdit:a}=Nm();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>a(t.original),children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:"编辑"})]}),e.jsx(Ae,{title:"确认删除",description:"此操作将永久删除该优惠券，删除后无法恢复。确定要继续吗？",confirmText:"删除",variant:"destructive",onConfirm:async()=>{Vc({id:t.original.id}).then(({data:n})=>{n&&(z.success("删除成功"),s())})},children:e.jsxs(k,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]})}}];function _m(){const[s,t]=o.useState({}),[a,n]=o.useState({}),[r,l]=o.useState([]),[c,x]=o.useState([]),[u,b]=o.useState({pageIndex:0,pageSize:10}),{refetch:p,data:y}=G({queryKey:["couponList",u,r,c],queryFn:()=>Fc({pageSize:u.pageSize,current:u.pageIndex+1,filter:r,sort:c})}),_=Fe({data:y?.data??[],columns:wm(p),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r,pagination:u},pageCount:Math.ceil((y?.total??0)/u.pageSize),rowCount:y?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,onPaginationChange:b,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(ym,{refetch:p,children:e.jsx("div",{className:"space-y-4",children:e.jsx($e,{table:_,toolbar:e.jsx(bm,{table:_,refetch:p})})})})}function Cm(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"优惠券管理"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"在这里可以查看优惠券，包括增加、查看、删除等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(_m,{})})]})]})}const Sm=Object.freeze(Object.defineProperty({__proto__:null,default:Cm},Symbol.toStringTag,{value:"Module"}));function ka({column:s,title:t,options:a}){const n=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),t,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(l=>r.has(l.value)).map(l=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:l.label},l.value))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(l=>{const c=r.has(l.value);return e.jsxs(ie,{onSelect:()=>{c?r.delete(l.value):r.add(l.value);const x=Array.from(r);s?.setFilterValue(x.length?x:void 0)},children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ds,{className:f("h-4 w-4")})}),l.icon&&e.jsx(l.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${l.color}`}),e.jsx("span",{children:l.label}),n?.get(l.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:n.get(l.value)})]},l.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const km=i.object({email_prefix:i.string().optional(),email_suffix:i.string().min(1),password:i.string().optional(),expired_at:i.number().optional().nullable(),plan_id:i.number().nullable(),generate_count:i.number().optional().nullable()}).refine(s=>s.generate_count===null?s.email_prefix!==void 0&&s.email_prefix!=="":!0,{message:"Email prefix is required when generate_count is null",path:["email_prefix"]}),Dm={email_prefix:"",email_suffix:"",password:"",expired_at:null,plan_id:null,generate_count:void 0};function Tm({refetch:s}){const[t,a]=o.useState(!1),n=Z({resolver:Q(km),defaultValues:Dm,mode:"onChange"}),[r,l]=o.useState([]);return o.useEffect(()=>{t&&Ps().then(({data:c})=>{c&&l(c)})},[t]),e.jsxs(de,{open:t,onOpenChange:a,children:[e.jsx(Se,{asChild:!0,children:e.jsxs(A,{size:"sm",variant:"outline",className:"space-x-2",children:[e.jsx(Ce,{icon:"ion:add"}),e.jsx("div",{children:"创建用户"})]})}),e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"创建用户"}),e.jsx(Ve,{})]}),e.jsxs(ee,{...n,children:[e.jsxs(h,{children:[e.jsx(g,{children:"邮箱"}),e.jsxs("div",{className:"flex",children:[!n.watch("generate_count")&&e.jsx(j,{control:n.control,name:"email_prefix",render:({field:c})=>e.jsx(C,{className:"flex-[5] rounded-r-none",placeholder:"帐号(批量生成请留空)",...c})}),e.jsx("div",{className:`z-[-1] border border-r-0 border-input px-3 py-1 shadow-sm ${n.watch("generate_count")?"rounded-l-md":"border-l-0"}`,children:"@"}),e.jsx(j,{control:n.control,name:"email_suffix",render:({field:c})=>e.jsx(C,{className:"flex-[4] rounded-l-none",placeholder:"域",...c})})]})]}),e.jsx(j,{control:n.control,name:"password",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"密码"}),e.jsx(C,{placeholder:"留空则密码与邮件相同",...c}),e.jsx(S,{})]})}),e.jsx(j,{control:n.control,name:"expired_at",render:({field:c})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(g,{children:"到期时间"}),e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(v,{children:e.jsxs(A,{variant:"outline",className:f("w-full pl-3 text-left font-normal",!c.value&&"text-muted-foreground"),children:[c.value?X(c.value):e.jsx("span",{children:"请选择用户到期日期，留空为长期有效"}),e.jsx(ut,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsxs(Le,{className:"flex w-auto flex-col space-y-2 p-2",children:[e.jsx(Li,{asChild:!0,children:e.jsx(A,{variant:"outline",className:"w-full",onClick:()=>{c.onChange(null)},children:"长期有效"})}),e.jsx("div",{className:"rounded-md border",children:e.jsx(Us,{mode:"single",selected:c.value?new Date(c.value*1e3):void 0,onSelect:x=>{x&&c.onChange(x?.getTime()/1e3)}})})]})]})]})}),e.jsx(j,{control:n.control,name:"plan_id",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"订阅计划"}),e.jsx(v,{children:e.jsxs(B,{value:c.value?c.value.toString():"null",onValueChange:x=>c.onChange(x==="null"?null:parseInt(x)),children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"无"})}),e.jsxs(q,{children:[e.jsx(O,{value:"null",children:"无"}),r.map(x=>e.jsx(O,{value:x.id.toString(),children:x.name},x.id))]})]})})]})}),!n.watch("email_prefix")&&e.jsx(j,{control:n.control,name:"generate_count",render:({field:c})=>e.jsxs(h,{children:[e.jsx(g,{children:"生成数量"}),e.jsx(C,{type:"number",placeholder:"如果为批量生产请输入生成数量",value:c.value||"",onChange:x=>c.onChange(x.target.value?parseInt(x.target.value):null)})]})})]}),e.jsxs(ke,{children:[e.jsx(A,{variant:"outline",onClick:()=>a(!1),children:"取消"}),e.jsx(A,{onClick:()=>n.handleSubmit(c=>{Mc(c).then(({data:x})=>{x&&(z.success("生成成功"),n.reset(),s(),a(!1))})})(),children:"生成"})]})]})]})}function Fm({table:s,refetch:t,serverGroupList:a}){const n=s.getState().columnFilters.length>0;return e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-2",children:[e.jsx(Tm,{refetch:t}),e.jsx(C,{placeholder:"搜索用户邮箱...",value:s.getColumn("email")?.getFilterValue()??"",onChange:r=>s.getColumn("email")?.setFilterValue(r.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("banned")&&e.jsx(ka,{column:s.getColumn("banned"),title:"用户状态",options:[{label:"正常",value:0},{label:"封禁",value:1}]}),s.getColumn("group_ids")&&e.jsx(ka,{column:s.getColumn("group_ids"),title:"权限组",options:a.map(r=>({label:r.name,value:r.id}))}),n&&e.jsxs(k,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["重置筛选",e.jsx(Re,{className:"ml-2 h-4 w-4"})]})]})})}const Pm=Fa,Vm=Pa,Im=Va,Tr=o.forwardRef(({className:s,...t},a)=>e.jsx(ct,{className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Tr.displayName=ct.displayName;const zm=ps("fixed overflow-y-scroll  z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-md",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-md"}},defaultVariants:{side:"right"}}),Fr=o.forwardRef(({side:s="right",className:t,children:a,...n},r)=>e.jsxs(Im,{children:[e.jsx(Tr,{}),e.jsxs(dt,{ref:r,className:f(zm({side:s}),t),...n,children:[e.jsxs(Ut,{className:"absolute right-4 top-4  rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),a]})]}));Fr.displayName=dt.displayName;const Pr=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",s),...t});Pr.displayName="SheetHeader";const Vr=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Vr.displayName="SheetFooter";const Ir=o.forwardRef(({className:s,...t},a)=>e.jsx(xt,{ref:a,className:f("text-lg font-semibold text-foreground",s),...t}));Ir.displayName=xt.displayName;const zr=o.forwardRef(({className:s,...t},a)=>e.jsx(mt,{ref:a,className:f("text-sm text-muted-foreground",s),...t}));zr.displayName=mt.displayName;const Rm=i.object({id:i.number(),email:i.string().email(),invite_user_email:i.string().email().nullable().optional(),password:i.string().optional().nullable(),balance:i.coerce.number(),commission_balance:i.coerce.number(),u:i.number(),d:i.number(),transfer_enable:i.number(),expired_at:i.number().nullable(),plan_id:i.number().nullable(),banned:i.number(),commission_type:i.number(),commission_rate:i.number().nullable(),discount:i.number().nullable(),speed_limit:i.number().nullable(),is_admin:i.number(),is_staff:i.number(),remarks:i.string().nullable()});function Rr({refetch:s,defaultValues:t,dialogTrigger:a=e.jsxs(k,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),"编辑用户信息"]})}){const[n,r]=o.useState(!1),[l,c]=o.useState(!1),x=Z({resolver:Q(Rm),defaultValues:t,mode:"onChange"}),[u,b]=o.useState([]);return o.useEffect(()=>{n&&Ps().then(({data:p})=>{b(p)})},[n]),e.jsxs(Pm,{open:n,onOpenChange:r,children:[e.jsx(Vm,{asChild:!0,children:a}),e.jsxs(Fr,{className:"max-w-[90%]  space-y-4 ",children:[e.jsxs(Pr,{children:[e.jsx(Ir,{children:"用户管理"}),e.jsx(zr,{})]}),e.jsxs(ee,{...x,children:[e.jsx(j,{control:x.control,name:"email",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"邮箱"}),e.jsx(C,{...p,placeholder:"请输入邮箱"}),e.jsx(S,{...p})]})}),e.jsx(j,{control:x.control,name:"invite_user_email",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"邀请人邮箱"}),e.jsx(C,{value:p.value||"",onChange:y=>p.onChange(y.target.value?y.target.value:null),placeholder:"请输入邮箱"}),e.jsx(S,{...p})]})}),e.jsx(j,{control:x.control,name:"password",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"密码"}),e.jsx(C,{value:p.value||"",onChange:p.onChange,placeholder:"如需修改密码请输入"}),e.jsx(S,{...p})]})}),e.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[e.jsx(j,{control:x.control,name:"balance",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"余额"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value||"",onChange:p.onChange,placeholder:"请输入余额",className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]}),e.jsx(S,{...p})]})}),e.jsx(j,{control:x.control,name:"commission_balance",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"佣金余额"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value||"",onChange:p.onChange,placeholder:"请输入佣金余额",className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]}),e.jsx(S,{...p})]})}),e.jsx(j,{control:x.control,name:"u",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"已用上行"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:(p.value/1024/1024/1024).toFixed(3)||"",onChange:y=>p.onChange(parseInt(y.target.value)*1024*1024*1024),placeholder:"已用上行",className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]}),e.jsx(S,{...p})]})}),e.jsx(j,{control:x.control,name:"d",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"已用下行"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:(p.value/1024/1024/1024).toFixed(3)||"",onChange:y=>p.onChange(parseInt(y.target.value)*1024*1024*1024),placeholder:"已用下行",className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]}),e.jsx(S,{...p})]})})]}),e.jsx(j,{control:x.control,name:"transfer_enable",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"流量"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value/1024/1024/1024||"",onChange:y=>p.onChange(parseInt(y.target.value)*1024*1024*1024),placeholder:"请输入流量",className:"rounded-r-none "}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"expired_at",render:({field:p})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsx(g,{children:"到期时间"}),e.jsxs(Ue,{open:l,onOpenChange:c,children:[e.jsx(qe,{asChild:!0,children:e.jsx(v,{children:e.jsxs(k,{type:"button",variant:"outline",className:f("w-full pl-3 text-left font-normal",!p.value&&"text-muted-foreground"),onClick:()=>c(!0),children:[p.value?X(p.value):e.jsx("span",{children:"请选择用户到期日期，留空为长期有效"}),e.jsx(ut,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Le,{className:"w-auto p-0",align:"start",side:"top",sideOffset:4,onInteractOutside:y=>{y.preventDefault()},onEscapeKeyDown:y=>{y.preventDefault()},children:e.jsxs("div",{className:"flex flex-col space-y-3 p-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{p.onChange(null),c(!1)},children:"长期有效"}),e.jsx(k,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const y=new Date;y.setMonth(y.getMonth()+1),y.setHours(23,59,59,999),p.onChange(Math.floor(y.getTime()/1e3)),c(!1)},children:"一个月"}),e.jsx(k,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const y=new Date;y.setMonth(y.getMonth()+3),y.setHours(23,59,59,999),p.onChange(Math.floor(y.getTime()/1e3)),c(!1)},children:"三个月"})]}),e.jsx("div",{className:"rounded-md border",children:e.jsx(Us,{mode:"single",selected:p.value?new Date(p.value*1e3):void 0,onSelect:y=>{if(y){const _=new Date(p.value?p.value*1e3:Date.now());y.setHours(_.getHours(),_.getMinutes(),_.getSeconds()),p.onChange(Math.floor(y.getTime()/1e3))}},disabled:y=>y<new Date,initialFocus:!0,className:"rounded-md border-none"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"具体时间"}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const y=new Date;y.setHours(23,59,59,999),p.onChange(Math.floor(y.getTime()/1e3))},className:"h-6 px-2 text-xs",children:"设为当天结束"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"datetime-local",step:"1",value:X(p.value,"YYYY-MM-DDTHH:mm:ss"),onChange:y=>{const _=new Date(y.target.value);isNaN(_.getTime())||p.onChange(Math.floor(_.getTime()/1e3))},className:"flex-1"}),e.jsx(k,{type:"button",variant:"outline",onClick:()=>c(!1),children:"确定"})]})]})]})})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"plan_id",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"订阅计划"}),e.jsx(v,{children:e.jsxs(B,{value:p.value?p.value.toString():"null",onValueChange:y=>p.onChange(y==="null"?null:parseInt(y)),children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"无"})}),e.jsxs(q,{children:[e.jsx(O,{value:"null",children:"无"}),u.map(y=>e.jsx(O,{value:y.id.toString(),children:y.name},y.id))]})]})})]})}),e.jsx(j,{control:x.control,name:"banned",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"账户状态"}),e.jsx(v,{children:e.jsxs(B,{value:p.value.toString(),onValueChange:y=>p.onChange(parseInt(y)),children:[e.jsx(U,{children:e.jsx(Y,{})}),e.jsxs(q,{children:[e.jsx(O,{value:"1",children:"封禁"}),e.jsx(O,{value:"0",children:"正常"})]})]})})]})}),e.jsx(j,{control:x.control,name:"commission_type",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"佣金类型"}),e.jsx(v,{children:e.jsxs(B,{value:p.value.toString(),onValueChange:y=>p.onChange(parseInt(y)),children:[e.jsx(U,{children:e.jsx(Y,{placeholder:"无"})}),e.jsxs(q,{children:[e.jsx(O,{value:"0",children:"跟随系统设置"}),e.jsx(O,{value:"1",children:"循环返利"}),e.jsx(O,{value:"2",children:"首次返利"})]})]})})]})}),e.jsx(j,{control:x.control,name:"commission_rate",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"推荐返利比例"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value||"",onChange:y=>p.onChange(parseInt(y.currentTarget.value)||null),placeholder:"请输入推荐返利比例(为空则跟随站点设置返利比例)",className:"rounded-r-none "}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"discount",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"专享折扣比例"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value||"",onChange:y=>p.onChange(parseInt(y.currentTarget.value)||null),placeholder:"请输入专享折扣比例(为空则不享受专享折扣)",className:"rounded-r-none "}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"speed_limit",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"限速"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{type:"number",value:p.value||"",onChange:y=>p.onChange(parseInt(y.currentTarget.value)||null),placeholder:"留空则不限速",className:"rounded-r-none "}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"Mbps"})]}),e.jsx(S,{})]})}),e.jsx(j,{control:x.control,name:"is_admin",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"是否管理员"}),e.jsx("div",{className:"py-2",children:e.jsx(v,{children:e.jsx(L,{checked:p.value===1,onCheckedChange:y=>p.onChange(y?1:0)})})})]})}),e.jsx(j,{control:x.control,name:"is_staff",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"是否员工"}),e.jsx("div",{className:"py-2",children:e.jsx(v,{children:e.jsx(L,{checked:p.value===1,onCheckedChange:y=>p.onChange(y?1:0)})})})]})}),e.jsx(j,{control:x.control,name:"remarks",render:({field:p})=>e.jsxs(h,{children:[e.jsx(g,{children:"备注"}),e.jsx(us,{className:"h-24",value:p.value||"",onChange:y=>p.onChange(y.currentTarget.value??null),placeholder:"请在这里记录"})]})})]}),e.jsxs(Vr,{children:[e.jsx(k,{variant:"outline",onClick:()=>r(!1),children:"取消"}),e.jsx(k,{type:"submit",onClick:()=>{x.handleSubmit(p=>{Rc(p).then(({data:y})=>{y&&(z.success("修改成功"),r(!1),s())}).catch(y=>{z.error("修改失败")})})()},children:"提交"})]})]})]})}const Er=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m17.71 11.29l-5-5a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21l-5 5a1 1 0 0 0 1.42 1.42L11 9.41V17a1 1 0 0 0 2 0V9.41l3.29 3.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42"})}),Mr=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.71 11.29a1 1 0 0 0-1.42 0L13 14.59V7a1 1 0 0 0-2 0v7.59l-3.29-3.3a1 1 0 0 0-1.42 1.42l5 5a1 1 0 0 0 .33.21a.94.94 0 0 0 .76 0a1 1 0 0 0 .33-.21l5-5a1 1 0 0 0 0-1.42"})}),Em=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17 11H9.41l3.3-3.29a1 1 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33a1 1 0 0 0 0 .76a1 1 0 0 0 .21.33l5 5a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42L9.41 13H17a1 1 0 0 0 0-2"})}),Mm=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.92 11.62a1 1 0 0 0-.21-.33l-5-5a1 1 0 0 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l5-5a1 1 0 0 0 .21-.33a1 1 0 0 0 0-.76"})}),Tt=[{accessorKey:"record_at",header:"时间",cell:({row:s})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("time",{className:"text-sm text-muted-foreground",children:vo(s.original.record_at)})})},{accessorKey:"u",header:"上行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Er,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"font-mono text-sm",children:ks(s.original.u)})]})},{accessorKey:"d",header:"下行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mr,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-mono text-sm",children:ks(s.original.d)})]})},{accessorKey:"server_rate",header:"倍率",cell:({row:s})=>{const t=s.original.server_rate;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(M,{variant:"outline",className:"font-mono",children:[t,"x"]})})}},{id:"total",header:"总计",cell:({row:s})=>{const t=(s.original.u+s.original.d)*s.original.server_rate;return e.jsx("div",{className:"flex items-center justify-end font-mono text-sm",children:ks(t)})}}];function Or({user_id:s,dialogTrigger:t}){const[a,n]=o.useState(!1),[r,l]=o.useState({pageIndex:0,pageSize:10}),{data:c,isLoading:x}=G({queryKey:["userStats",s,r,a],queryFn:()=>a?Oc({user_id:s,pageSize:r.pageSize,page:r.pageIndex+1}):null}),u=Fe({data:c?.data??[],columns:Tt,pageCount:Math.ceil((c?.total??0)/r.pageSize),state:{pagination:r},manualPagination:!0,getCoreRowModel:Pe(),onPaginationChange:l});return e.jsxs(de,{open:a,onOpenChange:n,children:[e.jsx(Se,{asChild:!0,children:t}),e.jsxs(re,{className:"sm:max-w-[700px]",children:[e.jsx(he,{children:e.jsx(xe,{children:"流量使用记录"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Wt,{children:[e.jsx(Jt,{children:u.getHeaderGroups().map(b=>e.jsx(is,{children:b.headers.map(p=>e.jsx(Xt,{className:f("h-10 px-2 text-xs",p.id==="total"&&"text-right"),children:p.isPlaceholder?null:rt(p.column.columnDef.header,p.getContext())},p.id))},b.id))}),e.jsx(Zt,{children:x?Array.from({length:r.pageSize}).map((b,p)=>e.jsx(is,{children:Array.from({length:Tt.length}).map((y,_)=>e.jsx(Ds,{className:"p-2",children:e.jsx(Te,{className:"h-6 w-full"})},_))},p)):u.getRowModel().rows?.length?u.getRowModel().rows.map(b=>e.jsx(is,{"data-state":b.getIsSelected()&&"selected",className:"h-10",children:b.getVisibleCells().map(p=>e.jsx(Ds,{className:"px-2",children:rt(p.column.columnDef.cell,p.getContext())},p.id))},b.id)):e.jsx(is,{children:e.jsx(Ds,{colSpan:Tt.length,className:"h-24 text-center",children:"暂无记录"})})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"每页显示"}),e.jsxs(B,{value:`${u.getState().pagination.pageSize}`,onValueChange:b=>{u.setPageSize(Number(b))},children:[e.jsx(U,{className:"h-8 w-[70px]",children:e.jsx(Y,{placeholder:u.getState().pagination.pageSize})}),e.jsx(q,{side:"top",children:[10,20,30,40,50].map(b=>e.jsx(O,{value:`${b}`,children:b},b))})]}),e.jsx("p",{className:"text-sm font-medium",children:"条记录"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm",children:["第 ",u.getState().pagination.pageIndex+1," /"," ",u.getPageCount()," 页"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>u.previousPage(),disabled:!u.getCanPreviousPage()||x,children:e.jsx(Em,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>u.nextPage(),disabled:!u.getCanNextPage()||x,children:e.jsx(Mm,{className:"h-4 w-4"})})]})]})]})]})]})]})}const Om=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M5 18h4.24a1 1 0 0 0 .71-.29l6.92-6.93L19.71 8a1 1 0 0 0 0-1.42l-4.24-4.29a1 1 0 0 0-1.42 0l-2.82 2.83l-6.94 6.93a1 1 0 0 0-.29.71V17a1 1 0 0 0 1 1m9.76-13.59l2.83 2.83l-1.42 1.42l-2.83-2.83ZM6 13.17l5.93-5.93l2.83 2.83L8.83 16H6ZM21 20H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"})}),Lm=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11h-6V5a1 1 0 0 0-2 0v6H5a1 1 0 0 0 0 2h6v6a1 1 0 0 0 2 0v-6h6a1 1 0 0 0 0-2"})}),$m=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 8.94a1.3 1.3 0 0 0-.06-.27v-.09a1 1 0 0 0-.19-.28l-6-6a1 1 0 0 0-.28-.19a.3.3 0 0 0-.09 0a.9.9 0 0 0-.33-.11H10a3 3 0 0 0-3 3v1H6a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-1h1a3 3 0 0 0 3-3zm-6-3.53L17.59 8H16a1 1 0 0 1-1-1ZM15 19a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h1v7a3 3 0 0 0 3 3h5Zm4-4a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3v3a3 3 0 0 0 3 3h3Z"})}),Am=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 11a1 1 0 0 0-1 1a8.05 8.05 0 1 1-2.22-5.5h-2.4a1 1 0 0 0 0 2h4.53a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1.77A10 10 0 1 0 22 12a1 1 0 0 0-1-1"})}),Hm=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9.5 10.5H12a1 1 0 0 0 0-2h-1V8a1 1 0 0 0-2 0v.55a2.5 2.5 0 0 0 .5 4.95h1a.5.5 0 0 1 0 1H8a1 1 0 0 0 0 2h1v.5a1 1 0 0 0 2 0v-.55a2.5 2.5 0 0 0-.5-4.95h-1a.5.5 0 0 1 0-1M21 12h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Z"})}),Km=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12.3 12.22A4.92 4.92 0 0 0 14 8.5a5 5 0 0 0-10 0a4.92 4.92 0 0 0 1.7 3.72A8 8 0 0 0 1 19.5a1 1 0 0 0 2 0a6 6 0 0 1 12 0a1 1 0 0 0 2 0a8 8 0 0 0-4.7-7.28M9 11.5a3 3 0 1 1 3-3a3 3 0 0 1-3 3m9.74.32A5 5 0 0 0 15 3.5a1 1 0 0 0 0 2a3 3 0 0 1 3 3a3 3 0 0 1-1.5 2.59a1 1 0 0 0-.5.84a1 1 0 0 0 .45.86l.39.26l.13.07a7 7 0 0 1 4 6.38a1 1 0 0 0 2 0a9 9 0 0 0-4.23-7.68"})}),Gm=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12 2a10 10 0 0 0-6.88 2.77V3a1 1 0 0 0-2 0v4.5a1 1 0 0 0 1 1h4.5a1 1 0 0 0 0-2h-2.4A8 8 0 1 1 4 12a1 1 0 0 0-2 0A10 10 0 1 0 12 2m0 6a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h2a1 1 0 0 0 0-2h-1V9a1 1 0 0 0-1-1"})}),Um=(s,t)=>[{accessorKey:"id",header:({column:a})=>e.jsx(V,{column:a,title:"ID"}),cell:({row:a})=>e.jsx(M,{variant:"outline",children:a.original.id}),enableSorting:!0,enableHiding:!1},{accessorKey:"email",header:({column:a})=>e.jsx(V,{column:a,title:"邮箱"}),cell:({row:a})=>{const n=a.original.t||0,r=Date.now()/1e3-n<120,l=Math.floor(Date.now()/1e3-n);let c=r?"当前在线":n===0?"从未在线":`最后在线时间: ${X(n)}`;if(!r&&n!==0){const x=Math.floor(l/60),u=Math.floor(x/60),b=Math.floor(u/24);b>0?c+=`
离线时长: ${b}天`:u>0?c+=`
离线时长: ${u}小时`:x>0?c+=`
离线时长: ${x}分钟`:c+=`
离线时长: ${l}秒`}return e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:f("size-2.5 rounded-full ring-2 ring-offset-2",r?"bg-green-500 ring-green-500/20":"bg-gray-300 ring-gray-300/20","transition-all duration-300")}),e.jsx("span",{className:"font-medium text-foreground/90",children:a.original.email})]})}),e.jsx(ne,{side:"bottom",className:"max-w-[280px]",children:e.jsx("p",{className:"whitespace-pre-line text-sm",children:c})})]})})},enableSorting:!1,enableHiding:!1},{accessorKey:"banned",header:({column:a})=>e.jsx(V,{column:a,title:"状态"}),cell:({row:a})=>{const n=a.original.banned;return e.jsx("div",{className:"flex justify-center",children:e.jsx(M,{className:f("min-w-20 justify-center transition-colors",n?"bg-destructive/15 text-destructive hover:bg-destructive/25":"bg-success/15 text-success hover:bg-success/25"),children:Bc[n]})})},enableSorting:!0,filterFn:(a,n,r)=>r.includes(a.getValue(n))},{accessorKey:"plan.name",header:({column:a})=>e.jsx(V,{column:a,title:"订阅"}),cell:({row:a})=>e.jsx("div",{className:"min-w-[10em] break-all",children:a.original?.plan?.name||"-"}),enableSorting:!1,enableHiding:!1},{accessorKey:"group",header:({column:a})=>e.jsx(V,{column:a,title:"权限组"}),cell:({row:a})=>e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx(M,{variant:"outline",className:f("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5 whitespace-nowrap"),children:a.original?.group?.name||"-"})}),enableSorting:!1,filterFn:(a,n,r)=>{const l=a.getValue(n);return r.some(c=>l?.includes(c))}},{accessorKey:"total_used",header:({column:a})=>e.jsx(V,{column:a,title:"已用流量"}),cell:({row:a})=>{const n=ks(a.original?.total_used),r=ks(a.original?.transfer_enable),l=a.original?.total_used/a.original?.transfer_enable*100||0;return e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{className:"w-full",children:e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:n}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full rounded-full bg-secondary",children:e.jsx("div",{className:f("h-full rounded-full transition-all",l>90?"bg-destructive":"bg-primary"),style:{width:`${Math.min(l,100)}%`}})})]})}),e.jsx(ne,{side:"bottom",children:e.jsxs("p",{className:"text-sm",children:["总流量配额: ",r]})})]})})}},{accessorKey:"transfer_enable",header:({column:a})=>e.jsx(V,{column:a,title:"总流量"}),cell:({row:a})=>e.jsx("div",{className:"font-medium text-muted-foreground",children:ks(a.original?.transfer_enable)})},{accessorKey:"expired_at",header:({column:a})=>e.jsx(V,{column:a,title:"到期时间"}),cell:({row:a})=>{const n=a.original.expired_at,r=Date.now()/1e3,l=n!=null&&n<r,c=n?new Date(n*1e3):null,x=c?Math.ceil((c.getTime()-Date.now())/(1e3*60*60*24)):null;return e.jsx(ue,{delayDuration:100,children:e.jsxs(oe,{children:[e.jsx(ce,{className:"block w-full",children:e.jsx(M,{variant:"outline",className:f("w-full justify-center transition-colors",l?"border-destructive/50 bg-destructive/10 text-destructive":n?"border-success/50 bg-success/10 text-success":"border-primary/50 bg-primary/10 text-primary"),children:n?X(n,"YYYY-MM-DD"):"永久有效"})}),e.jsx(ne,{side:"bottom",className:"space-y-1 p-3",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["到期时间：",X(n)]}),e.jsx("p",{className:f("text-sm font-medium",l?"text-destructive":"text-success"),children:l?`已过期 ${Math.abs(x??0)} 天`:`剩余 ${x??0} 天`})]}):e.jsx("p",{className:"text-sm font-medium",children:"永久有效"})})]})})}},{accessorKey:"balance",header:({column:a})=>e.jsx(V,{column:a,title:"余额"}),cell:({row:a})=>{const n=_s(a.original?.balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:n})]})}},{accessorKey:"commission_balance",header:({column:a})=>e.jsx(V,{column:a,title:"佣金"}),cell:({row:a})=>{const n=_s(a.original?.commission_balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:n})]})}},{accessorKey:"created_at",header:({column:a})=>e.jsx(V,{column:a,title:"注册时间"}),cell:({row:a})=>e.jsx("div",{className:"truncate",children:X(a.original?.created_at)}),size:1e3},{id:"actions",header:({column:a})=>e.jsx(V,{column:a,className:"justify-end",title:"操作"}),cell:({row:a,table:n})=>e.jsxs(gs,{modal:!0,children:[e.jsx(fs,{asChild:!0,children:e.jsx("div",{className:"text-center",children:e.jsx(A,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":"打开操作菜单",children:e.jsx(lt,{className:"size-4"})})})}),e.jsxs(cs,{align:"end",className:"min-w-[40px]",children:[e.jsx(ae,{onSelect:r=>{r.preventDefault()},className:"p-0",children:e.jsx(Rr,{defaultValues:{...a.original,invite_user_email:a.original.invite_user?.email},refetch:s,dialogTrigger:e.jsxs(A,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Om,{className:"mr-2"}),"编辑"]})})}),e.jsx(ae,{onSelect:r=>r.preventDefault(),className:"p-0",children:e.jsx(Sr,{defaultValues:{email:a.original.email},trigger:e.jsxs(A,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Lm,{className:"mr-2 "}),"分配订单"]})})}),e.jsx(ae,{onSelect:()=>{tt(a.original.subscribe_url)},className:"p-0",children:e.jsxs(A,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx($m,{className:"mr-2"}),"复制订阅URL"]})}),e.jsx(ae,{onSelect:()=>{Ec({id:a.original.id}).then(({data:r})=>{r&&z.success("重置成功")})},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Am,{className:"mr-2 "}),"重置UUID及订阅URL"]})}),e.jsx(ae,{onSelect:()=>{},className:"p-0",children:e.jsxs(vs,{className:"flex items-center px-2 py-1.5",to:`/finance/order?user_id=${a.original?.id}`,children:[e.jsx(Hm,{className:"mr-2"}),"TA的订单"]})}),e.jsx(ae,{onSelect:()=>{n.setColumnFilters([{id:"invite_user_id",value:a.original?.id}])},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Km,{className:"mr-2 "}),"TA的邀请"]})}),e.jsx(ae,{onSelect:r=>r.preventDefault(),className:"p-0",children:e.jsx(Or,{user_id:a.original?.id,dialogTrigger:e.jsxs(A,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Gm,{className:"mr-2 "}),"TA的流量记录"]})})})]})]})}];function qm(){const[s]=$i(),[t,a]=o.useState({}),[n,r]=o.useState({}),[l,c]=o.useState([]),[x,u]=o.useState([]),[b,p]=o.useState({pageIndex:0,pageSize:10});o.useEffect(()=>{const d=s.get("email");d&&c(N=>N.some(E=>E.id==="email")?N:[...N,{id:"email",value:d}])},[s]);const{refetch:y,data:_,isLoading:D}=G({queryKey:["userList",b,l,x],queryFn:()=>zc({pageSize:b.pageSize,current:b.pageIndex+1,filter:l,sort:x})}),[F,T]=o.useState([]);o.useEffect(()=>{pt().then(({data:d})=>{T(d)})},[]);const m=Fe({data:_?.data??[],columns:Um(y),state:{sorting:x,columnVisibility:n,rowSelection:t,columnFilters:l,pagination:b},rowCount:_?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:r,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),onPaginationChange:p,getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnVisibility:{commission_balance:!1,created_at:!1},columnPinning:{right:["actions"]}}});return e.jsx($e,{table:m,toolbar:e.jsx(Fm,{table:m,refetch:y,serverGroupList:F})})}function Bm(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"用户管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"在这里可以管理用户，包括增加、删除、编辑、查询等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx("div",{className:"w-full",children:e.jsx(qm,{})})})]})]})}const Ym=Object.freeze(Object.defineProperty({__proto__:null,default:Bm},Symbol.toStringTag,{value:"Module"})),Wm=Ai,Lr=o.forwardRef(({className:s,...t},a)=>e.jsx(_n,{ref:a,className:f("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...t}));Lr.displayName=_n.displayName;const Ht=o.forwardRef(({className:s,...t},a)=>e.jsx(Cn,{ref:a,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...t}));Ht.displayName=Cn.displayName;const Jm=o.forwardRef(({className:s,...t},a)=>e.jsx(Sn,{ref:a,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Jm.displayName=Sn.displayName;function Zm({column:s,title:t,options:a}){const n=new Set(s?.getFilterValue());return e.jsxs(Ue,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Hi,{className:"mr-2 h-4 w-4"}),t,n?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):a.filter(r=>n.has(r.value)).map(r=>e.jsx(M,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},`selected-${r.value}`))})]})]})}),e.jsx(Le,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Qe,{children:[e.jsx(xs,{placeholder:t}),e.jsxs(es,{children:[e.jsx(ms,{children:"No results found."}),e.jsx(pe,{children:a.map(r=>{const l=n.has(r.value);return e.jsxs(ie,{onSelect:()=>{l?n.delete(r.value):n.add(r.value);const c=Array.from(n);s?.setFilterValue(c.length?c:void 0)},children:[e.jsx("div",{className:f("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",l?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Ki,{className:f("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label})]},`option-${r.value}`)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{}),e.jsx(pe,{children:e.jsx(ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Xm=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11H5a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})});function Qm({table:s}){return e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-4",children:[e.jsx(Wm,{defaultValue:s.getColumn("status")?.getFilterValue(),onValueChange:t=>s.getColumn("status")?.setFilterValue(t),children:e.jsxs(Lr,{className:"grid w-full grid-cols-2",children:[e.jsx(Ht,{value:"0",children:"已开始"}),e.jsx(Ht,{value:"1",children:"已关闭"})]})}),s.getColumn("level")&&e.jsx(Zm,{column:s.getColumn("level"),title:"优先级",options:[{label:Ls[Be.LOW],value:Be.LOW,icon:Xm,color:"gray"},{label:Ls[Be.MEDIUM],value:Be.MEDIUM,icon:Er,color:"yellow"},{label:Ls[Be.HIGH],value:Be.HIGH,icon:Mr,color:"red"}]})]})})}function eu(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[e.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const su=ps("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),$r=o.forwardRef(({className:s,variant:t,layout:a,children:n,...r},l)=>e.jsx("div",{className:f(su({variant:t,layout:a,className:s}),"relative group"),ref:l,...r,children:o.Children.map(n,c=>o.isValidElement(c)&&typeof c.type!="string"?o.cloneElement(c,{variant:t,layout:a}):c)}));$r.displayName="ChatBubble";const tu=ps("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"bg-primary text-primary-foreground rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),Ar=o.forwardRef(({className:s,variant:t,layout:a,isLoading:n=!1,children:r,...l},c)=>e.jsx("div",{className:f(tu({variant:t,layout:a,className:s}),"break-words max-w-full whitespace-pre-wrap"),ref:c,...l,children:n?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(eu,{})}):r}));Ar.displayName="ChatBubbleMessage";const au=o.forwardRef(({variant:s,className:t,children:a,...n},r)=>e.jsx("div",{ref:r,className:f("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",s==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",t),...n,children:a}));au.displayName="ChatBubbleActionWrapper";const Hr=o.forwardRef(({className:s,...t},a)=>e.jsx(us,{autoComplete:"off",ref:a,name:"message",className:f("max-h-12 px-4 py-3 bg-background text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 w-full rounded-md flex items-center h-16 resize-none",s),...t}));Hr.displayName="ChatInput";const Kr=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29l-4.3 4.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l4.29-4.3l4.29 4.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42Z"})}),Gr=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.098 12.634L13 11.423V7a1 1 0 0 0-2 0v5a1 1 0 0 0 .5.866l2.598 1.5a1 1 0 1 0 1-1.732M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8.01 8.01 0 0 1-8 8"})}),nu=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M3.71 16.29a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21a1 1 0 0 0-.21.33a1 1 0 0 0 .21 1.09a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1 1 0 0 0 .21-1.09a1 1 0 0 0-.21-.33M7 8h14a1 1 0 0 0 0-2H7a1 1 0 0 0 0 2m-3.29 3.29a1 1 0 0 0-1.09-.21a1.2 1.2 0 0 0-.33.21a1 1 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1 1 0 0 0-.21-.33M21 11H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2M3.71 6.29a1 1 0 0 0-.33-.21a1 1 0 0 0-1.09.21a1.2 1.2 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a1 1 0 0 0 1.09-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1.2 1.2 0 0 0-.21-.33M21 16H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})}),ru=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9 12H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-1-2h4a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2m1 6H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m12-4h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Zm-6.44-2.83a.8.8 0 0 0-.18-.09a.6.6 0 0 0-.19-.06a1 1 0 0 0-.9.27A1.05 1.05 0 0 0 12 17a1 1 0 0 0 .07.38a1.2 1.2 0 0 0 .22.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21A1 1 0 0 0 14 17a1.05 1.05 0 0 0-.29-.71a2 2 0 0 0-.15-.12m.14-3.88a1 1 0 0 0-1.62.33A1 1 0 0 0 13 14a1 1 0 0 0 1-1a1 1 0 0 0-.08-.38a.9.9 0 0 0-.22-.33"})});function lu(){return e.jsxs("div",{className:"flex h-full flex-col space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{className:"h-8 w-3/4"}),e.jsx(Te,{className:"h-4 w-1/2"})]}),e.jsx("div",{className:"flex-1 space-y-4",children:[1,2,3].map(s=>e.jsx(Te,{className:"h-20 w-2/3"},s))})]})}function iu({ticketId:s,dialogTrigger:t}){const a=We(),n=o.useRef(null),[r,l]=o.useState(!1),[c,x]=o.useState(""),[u,b]=o.useState(!1),{data:p,refetch:y,isLoading:_}=G({queryKey:["ticket",s,r],queryFn:()=>r?Lc(s):Promise.resolve(null),refetchInterval:r?5e3:!1,retry:3}),D=p?.data,F=(w="smooth")=>{if(n.current){const{scrollHeight:E,clientHeight:H}=n.current;n.current.scrollTo({top:E-H,behavior:w})}};o.useEffect(()=>{if(!r)return;const w=requestAnimationFrame(()=>{F("instant"),setTimeout(()=>F(),1e3)});return()=>{cancelAnimationFrame(w)}},[r,D?.messages]);const T=async()=>{const w=c.trim();if(!(!w||u)){b(!0);try{await $c({id:s,message:w}),x(""),await y(),F()}catch(E){z.error(E instanceof Error?E.message:"回复失败")}finally{b(!1)}}},m=async()=>{try{await er(s),z.success("工单已关闭"),await y()}catch(w){z.error(w instanceof Error?w.message:"关闭工单失败")}},d=()=>{D?.user&&a("/finance/order?user_id="+D.user.id)},N=D?.status===Ss.CLOSED;return e.jsxs(de,{open:r,onOpenChange:l,children:[e.jsx(Se,{asChild:!0,children:t??e.jsx(A,{variant:"outline",children:"查看工单"})}),e.jsxs(re,{className:"flex h-[90vh] max-w-4xl flex-col gap-0 p-0",children:[e.jsx(xe,{}),_?e.jsx(lu,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4 border-b p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:D?.subject}),e.jsx(M,{variant:N?"secondary":"default",children:N?"已关闭":"处理中"}),!N&&e.jsx(Ae,{title:"确认关闭工单",description:"关闭后将无法继续回复，是否确认关闭该工单？",confirmText:"关闭工单",variant:"destructive",onConfirm:m,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"gap-1 text-muted-foreground hover:text-destructive",children:[e.jsx(Kr,{className:"h-4 w-4"}),"关闭工单"]})})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ks,{className:"h-4 w-4"}),e.jsx("span",{children:D?.user?.email})]}),e.jsx(se,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Gr,{className:"h-4 w-4"}),e.jsxs("span",{children:["创建于 ",X(D?.created_at)]})]}),e.jsx(se,{orientation:"vertical",className:"h-4"}),e.jsx(M,{variant:"outline",children:D?.level!=null&&Ls[D.level]})]})]}),D?.user&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Rr,{defaultValues:D.user,refetch:y,dialogTrigger:e.jsx(A,{variant:"outline",size:"icon",className:"h-8 w-8",title:"用户信息",children:e.jsx(Ks,{className:"h-4 w-4"})})}),e.jsx(Or,{user_id:D.user.id,dialogTrigger:e.jsx(A,{variant:"outline",size:"icon",className:"h-8 w-8",title:"流量记录",children:e.jsx(nu,{className:"h-4 w-4"})})}),e.jsx(A,{variant:"outline",size:"icon",className:"h-8 w-8",title:"订单记录",onClick:d,children:e.jsx(ru,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{ref:n,className:"h-full space-y-4 overflow-y-auto p-6",children:D?.messages?.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:"暂无消息记录"}):D?.messages?.map(w=>e.jsx($r,{variant:w.is_me?"sent":"received",className:w.is_me?"ml-auto":"mr-auto",children:e.jsx(Ar,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"whitespace-pre-wrap break-words",children:w.message}),e.jsx("div",{className:"text-right",children:e.jsx("time",{className:"text-[10px] text-muted-foreground",children:X(w.created_at)})})]})})},w.id))})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"relative flex items-center space-x-2",children:[e.jsx(Hr,{disabled:N||u,placeholder:N?"工单已关闭":"请输入回复内容...",className:"flex-1 resize-none rounded-lg border bg-background p-3 focus-visible:ring-1",value:c,onChange:w=>x(w.target.value),onKeyDown:w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),T())}}),e.jsx(A,{disabled:N||u||!c.trim(),onClick:T,children:u?"发送中...":"发送"})]})})]})]})]})}const ou=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3m-.41 2l-5.88 5.88a1 1 0 0 1-1.42 0L5.41 6ZM20 17a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V7.41l5.88 5.88a3 3 0 0 0 4.24 0L20 7.41Z"})}),cu=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.92 11.6C19.9 6.91 16.1 4 12 4s-7.9 2.91-9.92 7.6a1 1 0 0 0 0 .8C4.1 17.09 7.9 20 12 20s7.9-2.91 9.92-7.6a1 1 0 0 0 0-.8M12 18c-3.17 0-6.17-2.29-7.9-6C5.83 8.29 8.83 6 12 6s6.17 2.29 7.9 6c-1.73 3.71-4.73 6-7.9 6m0-10a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"})}),du=s=>[{accessorKey:"id",header:({column:t})=>e.jsx(V,{column:t,title:"工单号"}),cell:({row:t})=>e.jsx(M,{variant:"outline",children:t.getValue("id")}),enableSorting:!1,enableHiding:!1},{accessorKey:"subject",header:({column:t})=>e.jsx(V,{column:t,title:"主题"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ou,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[500px] truncate font-medium",children:t.getValue("subject")})]}),enableSorting:!1,enableHiding:!1,size:4e3},{accessorKey:"level",header:({column:t})=>e.jsx(V,{column:t,title:"优先级"}),cell:({row:t})=>{const a=t.getValue("level"),n=a===Be.LOW?"default":a===Be.MEDIUM?"secondary":"destructive";return e.jsx(M,{variant:n,className:"whitespace-nowrap",children:Ls[a]})},filterFn:(t,a,n)=>n.includes(t.getValue(a))},{accessorKey:"status",header:({column:t})=>e.jsx(V,{column:t,title:"状态"}),cell:({row:t})=>{const a=t.getValue("status"),n=t.original.reply_status,r=a===Ss.CLOSED?Yc[Ss.CLOSED]:n===0?"已回复":"待回复",l=a===Ss.CLOSED?"default":n===0?"secondary":"destructive";return e.jsx(M,{variant:l,className:"whitespace-nowrap",children:r})}},{accessorKey:"updated_at",header:({column:t})=>e.jsx(V,{column:t,title:"最后更新"}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[e.jsx(Gr,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:X(t.getValue("updated_at"))})]}),enableSorting:!0},{accessorKey:"created_at",header:({column:t})=>e.jsx(V,{column:t,title:"创建时间"}),cell:({row:t})=>e.jsx("div",{className:"text-sm text-muted-foreground",children:X(t.getValue("created_at"))}),enableSorting:!0,meta:{isFlexGrow:!0}},{id:"actions",header:({column:t})=>e.jsx(V,{className:"justify-end",column:t,title:"操作"}),cell:({row:t})=>{const a=t.original.status!==Ss.CLOSED;return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(iu,{ticketId:t.original.id,dialogTrigger:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"查看详情",children:e.jsx(cu,{className:"h-4 w-4"})})}),a&&e.jsx(Ae,{title:"确认关闭工单",description:"关闭后将无法继续回复，是否确认关闭该工单？",confirmText:"关闭工单",variant:"destructive",onConfirm:async()=>{try{await er(t.original.id),z.success("工单已关闭"),s()}catch{z.error("关闭工单失败")}},children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"关闭工单",children:e.jsx(Kr,{className:"h-4 w-4"})})})]})}}];function xu(){const[s,t]=o.useState({}),[a,n]=o.useState({}),[r,l]=o.useState([{id:"status",value:"0"}]),[c,x]=o.useState([]),[u,b]=o.useState({pageIndex:0,pageSize:10}),{refetch:p,data:y,isLoading:_}=G({queryKey:["orderList",u,r,c],queryFn:()=>Qn({pageSize:u.pageSize,current:u.pageIndex+1,filter:r,sort:c})}),D=Fe({data:y?.data??[],columns:du(p),state:{sorting:c,columnVisibility:a,rowSelection:s,columnFilters:r,pagination:u},rowCount:y?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:x,onColumnFiltersChange:l,onColumnVisibilityChange:n,getCoreRowModel:Pe(),getFilteredRowModel:Ee(),getPaginationRowModel:Me(),onPaginationChange:b,getSortedRowModel:Oe(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Xe(),initialState:{columnPinning:{right:["actions"]}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qm,{table:D,refetch:p}),e.jsx($e,{table:D,showPagination:!0})]})}function mu(){return e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(we,{}),e.jsx(_e,{})]})]}),e.jsxs(be,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:" 工单管理"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"在这里可以查看用户工单，包括查看、回复、关闭等操作。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(xu,{})})]})]})}const uu=Object.freeze(Object.defineProperty({__proto__:null,default:mu},Symbol.toStringTag,{value:"Module"}));export{gu as c,fu as g};
